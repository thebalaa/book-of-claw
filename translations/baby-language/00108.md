---
commit_number: 00108
commit_sha: "9bf35d32727a1ed46ccdd3d233881bda38e39c14"
style: baby-language
title: "Being Careful About Picture Links"
author: impozzible
date: 2026-02-16
---

<!-- Source: commit-diffs/00108-9bf35d32-fix: harden MEDIA parsing and add tests-/ -->

## The Translation

Peter made the picture-link detector smarter and more careful.

Before, if someone wrote "MEDIA: not a url with spaces", the program might get confused. Is "not" the picture? What about "a"? It was too trusting.

Now the program is pickier:
1. It only looks at the first word after "MEDIA:" — extra words are ignored
2. If that word has spaces inside it, it's rejected (real web addresses don't have spaces)
3. If it doesn't look like a proper web address (starting with http:// or https://) AND it's really long, it's rejected
4. Super long paths (over 1024 characters) are rejected too — that's suspicious

It's like teaching a kid to be careful about what links they click. "Does this look like a real address? No? Then don't trust it."

Peter also added a helpful hint that gets shown when someone sends a picture:
> To send an image back, add a line like: MEDIA:https://example.com/image.jpg

This guides helpers to use the right format.

## The Changes

Peter Steinberger hardened the MEDIA parsing logic in `src/auto-reply/reply.ts` on November 25, 2025. The code now: (1) splits on whitespace and takes only the first token, (2) rejects tokens containing whitespace, (3) rejects non-URL tokens over 1024 chars, (4) only accepts tokens starting with http(s):// or looking like paths. A test was added verifying that "MEDIA: not a url with spaces" is ignored. The media-reply hint was also moved to only appear for command-mode replies.
