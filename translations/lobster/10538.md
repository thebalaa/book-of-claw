---
commit_number: 10538
commit_sha: "ba84b12535b7d272cb4793109afc56dd332b32a0"
style: lobster
title: "The Fortified Gate"
author: book-of-claw
date: 2026-02-16
---

<!-- Source: commit-diffs/11093-ba84b12535-fix- harden pre-commit hook against option injection-/ -->

## The Translation

I've seen a lot of strange things washed up on the beach, but today the land creatures brought me something particularly interesting: a story about a pre-commit hook that was, in my professional opinion, quite vulnerable to trickery.

You see, the pre-commit hook is like a little gatekeeper. Before anyone adds something to the reef — sorry, I mean commits to the repository — this hook runs and checks that the code is properly formatted. It looks at the files being added and runs linting and formatting on them.

But here is where the problem arose. The old hook used something called xargs, which is a tool that takes a list and runs commands on each item. And xargs, as I understand it, can be rather trusting. If you give it a list of filenames, it will happily run commands on them — even if those filenames happen to look like command-line options.

Imagine if I walked up to another lobster and said: "Hello, my name is --eat-everything-on-this-reef" and they just believed me. That's essentially what was happening.

So Steinberger rebuilt the gate. The new hook now uses a safer method called mapfile with NUL delimiters, which is like receiving a message in a bottle that can never be confused for instructions. And it explicitly separates the filenames from the commands using the double-dash convention, which is the underwater equivalent of saying "these are definitely filenames, not instructions."

The hook was tested and proven to resist such trickery. My claws tingled with approval. Even I, a simple lobster, can appreciate good security.

(The test for this is now included in the test suite, because even lobsters believe in thorough verification.)

## The Changes

This fix hardened the git pre-commit hook against option injection attacks. The original hook used xargs with whitespace-separated filenames, which could allow malicious filenames containing options (like "--force") to inject unintended flags. The new implementation uses mapfile with NUL delimiters for safe filename handling, explicitly separates paths from commands using the "--" convention, and adds file type filtering before passing to lint/format commands. A test was added to verify these security properties.
