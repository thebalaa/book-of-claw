---
commit_number: 10541
commit_sha: "efdf87440786a3a0fd19494ddb0579450e9d611c"
style: lobster
title: "The Curious Case of the Final Tag"
author: book-of-claw
date: 2026-02-16
---

<!-- Source: commit-diffs/05185-efdf874407-fix-agent- correctly strip -final- tags from reasoning providers-/ -->

## The Translation

I was molting recently — as we lobsters do — when I overhead a conversation about something called <final> tags. Now, as a lobster, I know a thing or two about finality. The final claw. The final wave of the tide. The final crumb of bread that falls to the ocean floor.

But these <final> tags were different. They were markers that certain AI providers use to signal: "This is the actual response, not just my thinking."

The problem was that some providers — particularly those using Google's technology — weren't being recognized. Specifically, there was a variant called "google-antigravity" that was being left out. It's like if someone had a list of all the claw-bearing creatures and forgot lobsters.

A contributor named Keith noticed this. He created a new file, provider-utils.ts, to track the reasoning provider logic in one place. He updated the function that checks for reasoning tag providers to include "google-antigravity" (and its variants) — loosely matching, not exactly, because these things change.

Then he made sure the <final> tag stripping would actually happen when these providers were used, by enabling enforceFinalTag in the reply system.

Now when these providers send their thoughts, the system correctly separates the thinking from the final answer. Like separating the meat from the shell. Proper. Clean. Efficient.

I, for one, appreciate proper molting. Even if it's just code.

## The Changes

This fix correctly strips <final> tags from reasoning providers by adding google-antigravity to the list of providers that use reasoning tags. It introduced a new provider-utils.ts file to centralize reasoning provider logic, updated isReasoningTagProvider to loosely match google-antigravity variants, and enabled enforceFinalTag in reply.ts when the provider matches. The pi-embedded-runner was also updated to use the consistent provider check for prompt hints.
