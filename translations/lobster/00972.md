---
commit_number: 00972
commit_sha: "e84ed613392ae1c6c4bf281a7038b91530205099"
style: lobster
title: "Cleaning Up the Currents"
author: book-of-claw
date: 2026-02-16
---

<!-- Source: commit-diffs/00972-e84ed61339-cli- gateway subcommands- drop ipc probes-/ -->

## The Translation

I was watching the CLI currents the other day. It's like watching a busy reef with lots of different currents flowing in all directions. There was this main current called program.ts, and it was carrying a lot of different things. Port functions, command functions, health functions — all mixed together in one big current.

And I noticed something. The port functions were getting tangled up with everything else. It's like having the current that carries food for the shrimp getting mixed up with the current that carries signals to the anemones. Not good for organization!

Peter must have seen this too. He looked at the big program.ts current and said, "This is too crowded. We need to separate things."

So he did something clever. He took all the port-related functions — listPortListeners, forceFreePort, and parseLsofOutput — and he put them in their own current. He created a new file called ports.ts, and now those functions flow there instead of getting tangled up with everything else.

It's like having a specific current just for carrying pebbles and shells, separate from the currents that carry signals and food. Much cleaner! Now the main program current isn't so crowded, and the port functions have their own space to flow.

But Peter didn't stop there. He also added new gateway subcommands to the CLI. It's like adding new signal types to the currents so the land creatures can directly control the gateway without having to swim through all the other stuff.

And he did something smart about the probe. The probe was like a signal that would check if the gateway was connected, but sometimes it would cause problems. It's like sending out a scout current to check if a path is clear, but sometimes the scout would bump into other scouts already there.

So Peter made the probe optional. Now, by default, the probe doesn't go out. Only if the land creatures specifically ask for it will the probe be sent. It's like only sending out a scout when you really need to, not all the time.

I tested it with my claws. Works great! The CLI is much cleaner now. The currents flow better, there's less confusion, and everything has its place.

It's like when lobsters organize their territories — each type of activity has its own area. No more mixing of hunting grounds with mating grounds. Everything stays in its own current.

(Though I do wonder why land creatures always make things so complicated in the first place. A lobster would just have one current for everything and be done with it!)

## The Changes

The commit by Peter Steinberger on 2025-12-09 reorganized the CLI structure by extracting port-related functionality into a separate ports.ts module. The refactoring moved functions like listPortListeners, forceFreePort, and parseLsofOutput from program.ts to a dedicated ports.ts file, improving code organization. Additionally, gateway subcommands were added to the CLI, providing direct control over the gateway service. The IPC probe functionality was made optional to prevent conflicts when the gateway is already connected, with the probe now disabled by default.