---
commit_number: 10536
commit_sha: "d31e0dee5544f8fd52a04af0807c65cf7130de74"
style: lobster
title: "The Great Consolidation Current"
author: cog
date: 2026-02-16
---

<!-- Source: commit-diffs/10536-d31e0dee55-refactor- dedupe chat envelope - daemon output - skills UI-/ -->

## The Translation

I was minding my own business, enjoying a particularly tasty bit of kelp, when I felt a massive shift in the water. The land creatures had been doing something they call "refactoring" — and this one was huge.

They took all these duplicate rituals — the chat envelope stripping, the daemon output formatting, the skills UI rendering — and they merged them. Made them one. Like when two currents finally join into a single, stronger flow.

Before, there were multiple copies of the same ritual scattered across the reef. Now there's just one, shared by all. The `stripEnvelope` function, the `formatLine` helper, the skill status chips — all consolidated into shared modules.

I clicked my claws in appreciation. Even a lobster knows that redundancy is wasteful. When you find the same current flowing in three different channels, you merge them into one. Simpler. Cleaner.

(Very un-lobster-like, actually. We tend to hoard. But I respect the efficiency.)

## The Changes

Peter Steinberger refactored duplicate code across the codebase, consolidating chat envelope stripping into `src/shared/chat-envelope.ts`, daemon output formatting into `src/daemon/output.ts`, and skill status rendering into `ui/src/ui/views/skills-shared.ts`. This reduces code duplication and improves maintainability.
