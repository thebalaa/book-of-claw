---
commit_number: 09425
commit_sha: "af172742a3f6f820ac3e199d6e319fcc0bae78ca"
style: harry-potter
title: "The Message Type Sorting Charm"
author: thebalaa
date: 2026-02-16
---

<!-- Source: commit-diffs/09425-af172742a3-fix-feishu- use msg_type -media- for video-audio messages -14648-/ -->

## The Translation

In the magical underwater world of Clawgwarts, where the Feishu enchantments allowed young wizards to send messages to each other across the digital seas, there had been a peculiar problem. The system was treating all types of files as if they were the same. It was like sending a moving picture spell and a written scroll using the same magical envelope - the receiving wizard wouldn't know whether to expect a moving image or words to read.

0xRain, a young wizard from the mysterious 0xRain academy of magic, had noticed this issue. "It is most vexing," he told Professor Flapperclaw one evening while studying the magical scrolls that controlled the Feishu system. "The system is sending all files with the same message type! It is like sending a howler owl and a regular owl with the same delivery instructions - the recipients won't know which owl carries which type of message!"

And so, 0xRain decided to cast the Message Type Sorting Charm. This charm would ensure that different types of files were sent with the appropriate message type, so the Feishu system would understand how to handle them.

First, 0xRain studied the different types of files that wizards might send:

1. Media files - these were moving pictures (mp4) and sound recordings (opus). Rather like enchanted paintings that moved and played music, or howler owls that spoke messages
2. Document files - these were written scrolls and documents (pdf). Rather like parchments with text written upon them

The charm would now sort these files into different categories:

- Media files would be sent with message type "media" - rather like labeling an envelope "Contains Moving Picture"
- Document files would be sent with message type "file" - rather like labeling an envelope "Contains Written Scroll"

The young wizards cheered when they learned of this improvement. Now when they sent moving pictures to their friends, the system would correctly identify them as media messages. And when they sent written documents, the system would identify them as file messages.

"It is like giving each type of message its own magical signature," said Professor Flapperclaw with a smile. "Now the Feishu system will know exactly how to handle each message it receives!"

And in the halls of Clawgwarts, the Feishu enchantments worked better than ever before. Wizards could now send all types of files with confidence, knowing they would be handled correctly by the magical system.

Professor Steinberger, who oversaw many of the castle's enchantments, was most pleased. "The magic of proper sorting," he remarked, "is one of the most useful charms we have. For it ensures that everything reaches its destination in the proper form."

And so, the Message Type Sorting Charm was cast, and the Feishu system became even more reliable for all the young wizards of Clawgwarts.

## The Changes

The commit by 0xRain on 2026-02-13 fixed the Feishu extension to use appropriate message types for different file categories. The fix modifies the sendMediaFeishu function to determine the correct message type based on file content - using "media" for audio/video files (mp4, opus) and "file" for document files. This ensures compatibility with the Feishu API requirements, which handle media and document messages differently. The implementation adds a msgType parameter to sendFileFeishu and includes comprehensive testing to verify the correct message type is used for each file category.