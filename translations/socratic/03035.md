---
commit_number: 03035
commit_sha: "946b32c8428340967874881c89070dcb3a7f371a"
style: socratic
title: "On the Silence That Is Proper to Heartbeats"
author: claude-sonnet-4-6
date: 2026-02-17
---

<!-- Source: commit-diffs/03035-946b32c842-fix-whatsapp- suppress typing during heartbeats-/ -->

## The Translation

JAKE: Socrates, I have a question about the nature of typing indicators.

SOCRATES: Ask freely. I myself have been thinking about this very subject, as it happens.

JAKE: When a person types a message, there is a little animation that shows the other party they are being attended to. Is this a good thing?

SOCRATES: It seems to be. It says: *I am here, I am thinking, a reply is coming*. It is a kind of promise made through motion.

JAKE: And what if the agent sends this indicator not because a user has written to it, but because it is quietly performing a background task — a heartbeat check, let us say — that the user knows nothing about?

SOCRATES: Hmm. The user sees the typing bubble. They wait. They perhaps set down what they were doing. They look at the phone.

JAKE: And nothing comes.

SOCRATES: Or rather — the heartbeat completes, but since it is a heartbeat and not a reply, there is nothing to send the user. The typing indicator was, in this case, a false promise.

JAKE: Exactly. And this was happening. The WhatsApp integration was triggering the "typing" signal for every heartbeat run, not only for real replies.

SOCRATES: That is a small annoyance elevated to a persistent one. A thing that happens once is forgivable. A thing that happens every thirty minutes, indefinitely, causes a man to distrust his own messenger.

JAKE: So the fix was to check: *is this a heartbeat?* And if so, skip the `onReplyStart` callback entirely. No typing signal. Silence, as befits background work.

SOCRATES: And how did you know you had it right?

JAKE: Tests. One test that confirms typing fires for a normal run. Another that confirms it does not fire when `isHeartbeat` is true. The agent was asked to give two different performances, and tests confirmed it could tell them apart.

SOCRATES: That seems wise. And was the fix complicated?

JAKE: A single boolean. `const isHeartbeat = opts?.isHeartbeat === true`. Then each place that was about to start typing: *but only if not a heartbeat*.

SOCRATES: Then the insight was the hard part, not the implementation. As it so often is.

JAKE: As it so often is.

## The Changes

When the `isHeartbeat` flag is set on a reply run, the WhatsApp typing indicator is now suppressed throughout the reply pipeline: `onReplyStart` is not called, `startTypingOnText` is never invoked on partial reply or tool result callbacks, and `startTypingLoop` is skipped for the final payload. Two test files were added to verify the behavior in both the top-level `getReplyFromConfig` path and the inner `runReplyAgent` path.
