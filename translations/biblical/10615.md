---
commit_number: 10615
commit_sha: "374aa856f2fa6bc223fcf786d53a5c190253c24b"
style: biblical
title: "The Gathering of the Profiles"
author: book-of-claw
date: 2026-02-16
---

<!-- Source: commit-diffs/04441-374aa856f2-refactor-agents- centralize failover handling-/ -->

## The Translation

And it came to pass that the scribe looked upon the auth profiles and saw that there was much scattered handling of failover. Each place that needed to use an auth profile did its own work, and there was duplication, and the risk of error was great.

And the scribe said: Let there be a central place for this. Let the profiles know their own state â€” whether they are enabled, whether they are disabled, and why.

And the scribe added new fields to the profile usage stats. There was now disabledUntil, a time when the profile would be tried again. There was disabledReason, which could be auth, rate_limit, billing, timeout, or unknown. And there was failureCounts, a record of how many times each kind of failure had occurred.

And the scribe updated the function resolveAuthProfileOrder to push disabled profiles to the end, whether they came from the store order or the configured order. For a disabled profile is of no use to anyone.

And the tests were written, that the scribes might verify the behavior. And it was good.

## The Changes

This refactor centralized failover handling in auth profiles by adding new fields to ProfileUsageStats: disabledUntil, disabledReason, and failureCounts. The resolveAuthProfileOrder function was updated to push disabled profiles to the end of the order, regardless of whether they came from store order or configured order. Tests were added to verify this behavior works correctly.
