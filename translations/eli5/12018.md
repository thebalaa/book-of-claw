---
commit_number: 12018
commit_sha: "f7d2e15a2e69e34425d7e581d5ce801d303ac7e4"
style: eli5
title: "Making the Checks More Reliable So They Stop Giving Wrong Answers"
author: balaa
date: 2026-02-16
---

<!-- Source: commit-diffs/12018-f7d2e15a2e-test- stabilize infra tests-/ -->

## The Translation

Tests are like checking your homework before handing it in. But sometimes tests can give the wrong answer not because the code is broken, but because the test itself was written in a shaky way — like a scale that gives a different reading every time you step on it. This save point fixes several shaky tests so they give consistent, reliable answers.

Sebastian made four fixes. First, he updated a test about running commands so it checks the right thing — it used to check a single number, but on some computers that number could be empty even when everything is fine, so now it checks two things to make sure. Second, he rewrote a test about Telegram webhooks (a way for Telegram, the messaging app, to send messages to the program) so that fake stand-in functions are created in the right place, making the test work in all situations. Third, he fixed a test about memory search so it avoids a style warning from the code checker. Fourth, he added a missing test for a heartbeat feature (a regular "I'm still alive" ping) that checks whether a setting for hiding tool error warnings is passed along correctly.

Together these fixes make the test suite (the collection of all checks) more trustworthy, like swapping wobbly measuring cups for proper ones.

## The Changes

- In `src/process/exec.test.ts`, updated an assertion to check `result.signal` is null and `result.code ?? 0` equals 0, handling platforms where `code` may be null on a clean exit.
- In `src/telegram/webhook.test.ts`, moved all spy/mock function definitions inside `vi.hoisted()` so they are initialized before module mocks run, fixing potential ordering issues.
- In `src/memory/search-manager.test.ts`, changed the `QmdMemoryManager.create` mock binding to use `vi.mocked(QmdMemoryManager.create)` directly (with an eslint disable comment) instead of `.bind(QmdMemoryManager)`, avoiding a linting warning about unbound methods.
- In `src/infra/heartbeat-runner.model-override.test.ts`, added `suppressToolErrorWarnings` as an optional parameter to `runDefaultsHeartbeat`, wired it into the config, and added a new test verifying it is passed through to the reply options.
- Updated `CHANGELOG.md` to credit `@dinakars777` for the heartbeat sender metadata feature.
