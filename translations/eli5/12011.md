---
commit_number: 12011
commit_sha: "826e62a3bce109ca899590c24c35b6bc913576cd"
style: eli5
title: "Taking Out the Very Old Trash"
author: balaa
date: 2026-02-16
---

<!-- Source: commit-diffs/12011-826e62a3bc-fix-sessions- purge deleted transcript archives-/ -->

## The Translation

Imagine every conversation you have gets written down in a notebook. When a conversation gets old and goes away, the program doesn't throw the notebook out right away â€” it marks it as deleted and sets it aside (like putting it in a special "trash pile" folder). That trash pile is good to keep for a little while, just in case. But if you never clean up the trash pile, it keeps growing forever and fills up your hard drive.

Before this fix, old notebooks were moved to the trash pile but never actually thrown out. They just sat there building up on disk. Sebastian fixed this by teaching the program to go through the trash pile after moving old notebooks, and throw away any that have been sitting there longer than the "prune window" (the number of days the program is set to keep things before deleting them). New trash is left alone; only the really old stuff gets thrown away.

He also added a test that checks all this: it creates some old trash files and some newer ones, runs the cleanup, and makes sure only the old ones are gone.

## The Changes

- Added a new function `cleanupArchivedSessionTranscripts` in `src/gateway/session-utils.fs.ts` that scans one or more folders for archived (`.deleted`) transcript files, reads the timestamp from each filename, and deletes files older than the configured prune window.
- Added helper functions `parseArchivedTimestamp` and `restoreArchiveTimestamp` to extract the date from archived filenames.
- Updated `src/config/sessions/store.ts` to call `cleanupArchivedSessionTranscripts` after archiving deleted session transcripts, passing in the directories where archives were written.
- Added a new end-to-end test in `src/config/sessions/store.pruning.e2e.test.ts` verifying that old `.deleted` archives are removed while recent ones and unrelated `.bak` files are preserved.
- Updated `CHANGELOG.md` to clarify that the purge targets `.deleted` archives specifically.
