---
commit_number: 12013
commit_sha: "1486eb66fd17c08e284cf819585511bafaf9d33e"
style: eli5
title: "Putting the Lock Back on Every Door, Not Just the Outdoor Ones"
author: balaa
date: 2026-02-16
---

<!-- Source: commit-diffs/12013-1486eb66fd-revert-gateway- restore loopback auth setup-/ -->

## The Translation

The gateway is like a front door between the program and whoever wants to talk to it. A "loopback" gateway is a special kind of door that only opens from inside the same computer — like a door that leads to a room in your own house. Someone had decided that this inside-only door doesn't need a lock, because only you can reach it anyway. So they changed the setup so that loopback gateways skip the whole "pick a lock type" question.

This save point undoes that decision. Sebastian put the lock-picking question back, so you get asked to choose a lock type (token, password, or trusted-proxy) even for loopback-only gateways. The idea is that it's better to always have a lock — even on the inside door — rather than leave things open by accident.

He updated the tests to match the new order of questions, and cleaned up the doctor tool (the health-checker) so it no longer has a special exception that skips checking the lock on loopback gateways.

## The Changes

- Reverted the gateway configuration prompt in `src/commands/configure.gateway.ts` so that the "Gateway auth" question is asked before the Tailscale (a networking tool) mode question, and applies to loopback-only gateways too. Removed the `loopbackOnlyGateway` exception that previously skipped auth setup and cleared the auth config.
- Updated `src/commands/doctor.ts` to remove the `requireGatewayAuth` check that previously skipped token warnings for loopback-only gateways. Now all gateways are warned if they lack a token.
- Updated tests in `src/commands/configure.gateway.e2e.test.ts` to reflect the new prompt order and expected behavior, replacing the "skips gateway auth for loopback" test with a "generates a token when prompt returns undefined" test.
