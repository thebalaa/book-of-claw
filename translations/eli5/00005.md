---
commit_number: 00005
commit_sha: "1526c238bd9ae1e3bc4c827826dfd579b1ba8a9d"
style: eli5
title: "Making the Code More Careful"
author: thebalaa
date: 2026-02-16
---

<!-- Source: commit-diffs/00005-1526c238bd-Tighten types- remove anys- validate funnel status- typed exec helpers-/ -->

## The Translation

Peter decided to make the code "pickier" - in a good way! Think of it like this: before, some parts of the code were like saying "I'll accept any toy, whatever you give me." Now it says "I need specifically a red ball, not just any toy."

In programming, this is called "types." Peter went through and told the code exactly what kind of information each piece should expect. For example:
- Instead of "any response from Tailscale is fine," now it says "I expect a text response that I can turn into a structured format"
- Instead of "run this command and I'll deal with whatever happens," now it says "run this command and give me back text in a specific format"

He also created a helper function (a recipe step) called `runExec` that makes running commands more predictable - like having a standard way to measure ingredients instead of eyeballing it every time.

Why? Because being specific helps catch mistakes early. It's like checking that you have flour before you start baking, instead of discovering halfway through that you're out.

## The Changes

This commit improved type safety throughout `src/index.ts` by:

- Replacing `any` types with specific types (Request, Response from Express)
- Creating a typed `ExecResult` type and `runExec()` wrapper function for consistent command execution
- Adding explicit type guards when parsing JSON responses from Tailscale commands
- Improving validation of config file parsing
- Converting `ensureBinary()` to properly typed promise chain

The changes eliminate approximately 6 uses of `any` type and add better null/undefined handling. No functionality changed - only type safety improved to catch potential errors at compile time rather than runtime.
