# Commit Reference: 00651–00700

A plain factual summary of every commit in the OpenClaw repository, from commit 651 through commit 700.

---

## 00651 — feat(macos): serve web chat over localhost to avoid cors
**SHA:** f3950a5a65 · **Date:** 2025-12-07 16:30
**Files changed:** apps/macos/Sources/Clawdis/WebChatServer.swift, apps/macos/Sources/Clawdis/WebChatWindow.swift
**Tags:** `core-feature`, `refactor`

Replaces file:// URL loading with a localhost HTTP server to avoid CORS restrictions in WKWebView. Adds WebChatServer class using Network framework to serve WebChat bundle assets over 127.0.0.1 with proper MIME types. Removes WebKit file access preferences that were previously required for cross-origin module imports.

---

## 00652 — voice wake: use clean PATH (no inherited junk)
**SHA:** 45398b7660 · **Date:** 2025-12-07 16:33
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeForwarder.swift, apps/macos/Tests/ClawdisIPCTests/VoiceWakeForwarderTests.swift
**Tags:** `bugfix`, `refactor`

Changes PATH construction in CLI lookup to use a clean deterministic list instead of appending to inherited $PATH. Removes `:$PATH` suffix to avoid breaking on remote shells with spaces or unusual PATH entries.

---

## 00653 — chore: format macOS sources
**SHA:** 040fe58693 · **Date:** 2025-12-07 16:35
**Files changed:** apps/macos/Sources/Clawdis/
**Tags:** `linting`

Runs Swift formatter across macOS source files. Changes include explicit self references in actors, consistent switch return statements, sorted imports, and adjusted line breaks for long function signatures.

---

## 00654 — voice wake: log full ssh command for debug
**SHA:** 8942e3e78d · **Date:** 2025-12-07 16:38
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeForwarder.swift
**Tags:** `verbosity`

Adds debug logging of the complete SSH command before execution. Constructs debugCmd by joining executable and arguments array for easier debugging of voice wake forwarding issues.

---

## 00655 — chore(webchat): wait for local server and add debug logging
**SHA:** 41a84cef23 · **Date:** 2025-12-07 16:39
**Files changed:** apps/macos/Sources/Clawdis/WebChatServer.swift, apps/macos/Sources/Clawdis/WebChatWindow.swift
**Tags:** `verbosity`, `bugfix`

Adds waitForWebChatServer method with 2-second timeout to ensure server is ready before loading. Adds debug logging for connection ready, receive errors, and request paths to diagnose module loading issues.

---

## 00656 — voice wake: log ssh command at info level
**SHA:** 9c07aab2d6 · **Date:** 2025-12-07 16:43
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeForwarder.swift
**Tags:** `verbosity`

Changes voice wake SSH command logging from debug to info level to make it visible in default logs. Single-line change to promote visibility of executed commands.

---

## 00657 — chore(webchat): add server logging and ensure buildable
**SHA:** 9dd9bb7092 · **Date:** 2025-12-07 16:49
**Files changed:** apps/macos/Sources/Clawdis/WebChatServer.swift
**Tags:** `verbosity`

Increases WebChatServer logging to track server lifecycle and HTTP request handling. Additional diagnostic output to understand why bundled modules might fail to load in WKWebView.

---

## 00658 — chore(webchat): increase server logging for module load debugging
**SHA:** fec49e1e28 · **Date:** 2025-12-07 16:55
**Files changed:** apps/macos/Sources/Clawdis/WebChatServer.swift
**Tags:** `verbosity`

Further increases WebChatServer logging verbosity specifically to debug ES module loading failures. Adds more detailed request/response tracking for troubleshooting.

---

## 00659 — VoiceWake: pipe transcript to ssh forwarder
**SHA:** 12f74de9b3 · **Date:** 2025-12-07 16:59
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeForwarder.swift
**Tags:** `refactor`, `bugfix`

Changes transcript delivery from stdin pipe to environment variable. Replaces ${text} placeholder with $CLAW_TEXT and sets CLAW_TEXT=$(cat) in shell command, allowing remote shell to read transcript without pipe complexity.

---

## 00660 — VoiceWake: include ssh cmd on failure
**SHA:** 16f9dbfe37 · **Date:** 2025-12-07 17:30
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeForwarder.swift
**Tags:** `verbosity`

Adds SSH command to error log output when voice wake forward fails. Appends debugCmd to the error message for easier troubleshooting of remote forwarding issues.

---

## 00661 — docs(mac): document privacy-off logging
**SHA:** 74e5e5e182 · **Date:** 2025-12-07 17:35
**Files changed:** apps/macos/README.md or documentation files
**Tags:** `documentation`

Documents privacy-off logging behavior for macOS app. Explains when and where privacy: .public is used in OSLog calls.

---

## 00662 — webchat: bundle assets with rolldown
**SHA:** 98651c2a14 · **Date:** 2025-12-07 17:44
**Files changed:** apps/macos/Sources/Clawdis/Resources/WebChat/bootstrap.js, apps/macos/Sources/Clawdis/Resources/WebChat/index.html
**Tags:** `core-feature`, `optimization`

Adds rolldown bundling for WebChat assets served by localhost server. Creates bootstrap.js entry point that loads agent modules, establishes NativeTransport for macOS bridge, and handles initialization messages. Replaces inline module script with single bundled JS file.

---

## 00663 — VoiceWake: send transcript via python/base64 instead of stdin
**SHA:** 71072f084e · **Date:** 2025-12-07 17:45
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeForwarder.swift
**Tags:** `refactor`

Replaces stdin piping with base64-encoded transcript embedded in shell command. Uses Python to decode base64 transcript and set CLAW_TEXT variable, avoiding stdin complexity and potential SSH tty issues.

---

## 00664 — macOS: fix health shell timeout race
**SHA:** 1f0ee9837b · **Date:** 2025-12-07 16:48
**Files changed:** apps/macos/Sources/Clawdis/
**Tags:** `bugfix`, `process-lifecycle`

Fixes race condition in health check shell command timeout logic. Ensures timeout handling works correctly when checking remote clawd status.

---

## 00665 — auto-reply: enrich chat status
**SHA:** e2c6546b61 · **Date:** 2025-12-07 16:53
**Files changed:** CHANGELOG.md, README.md, docs/health.md, docs/session.md, docs/troubleshooting.md, src/auto-reply/reply.triggers.test.ts
**Tags:** `auto-reply`, `documentation`

Adds /status command that reports agent readiness, session context usage, thinking/verbose options, and WhatsApp web credential age without invoking the agent. Updates documentation across multiple files to describe the new in-chat status feature.

---

## 00666 — webchat: hide model selector in embedded UI
**SHA:** bdf3d60148 · **Date:** 2025-12-07 17:52
**Files changed:** apps/macos/Sources/Clawdis/Resources/WebChat/
**Tags:** `ux`

Hides model selector UI when WebChat is embedded in macOS app. Simplifies interface since model selection is managed by the app, not the web UI.

---

## 00667 — webchat: bypass api key prompts in embedded mode
**SHA:** 4ff5004d7c · **Date:** 2025-12-07 17:53
**Files changed:** apps/macos/Sources/Clawdis/Resources/WebChat/
**Tags:** `ux`

Skips API key prompts when WebChat runs embedded in macOS app. API keys are managed by native app settings, so prompts are unnecessary and confusing in embedded context.

---

## 00668 — refactor(mac): split voice wake settings
**SHA:** df9f72134b · **Date:** 2025-12-07 17:54
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeSettings.swift
**Tags:** `refactor`, `ux`

Splits voice wake settings into separate sections for better organization. Separates recognition settings from forwarding configuration in the UI.

---

## 00669 — test(mac): cover voice wake helpers
**SHA:** f3ebb2e9ce · **Date:** 2025-12-07 17:56
**Files changed:** apps/macos/Tests/ClawdisIPCTests/VoiceWakeForwarderTests.swift
**Tags:** `testing`

Adds test coverage for voice wake helper functions. Tests CLI path resolution, command templating, and SSH argument construction.

---

## 00670 — VoiceWake: remove python hop; use escaped literal under /bin/sh
**SHA:** b837c68df8 · **Date:** 2025-12-07 18:03
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeForwarder.swift
**Tags:** `refactor`, `bugfix`

Removes Python base64 decoding dependency by using shell-escaped single-quoted literals instead. Uses shellEscape to safely embed transcript in command, avoiding both Python and stdin complexity. Changes sh to /bin/sh for explicit shell path.

---

## 00671 — macOS: merge status row and fix webchat bundle deps
**SHA:** c06f49cb3e · **Date:** 2025-12-07 17:20
**Files changed:** apps/macos/Sources/Clawdis/, apps/macos/Sources/Clawdis/Resources/WebChat/
**Tags:** `ux`, `bugfix`

Merges duplicate status display rows into single unified row. Fixes WebChat bundle dependencies to resolve module loading issues after rolldown bundling changes.

---

## 00672 — feat: add remote clawd toggle
**SHA:** 2a45455c80 · **Date:** 2025-12-07 18:19
**Files changed:** apps/macos/Sources/Clawdis/AppState.swift, apps/macos/Sources/Clawdis/Constants.swift, apps/macos/Sources/Clawdis/GeneralSettings.swift
**Tags:** `core-feature`, `ux`

Adds connection mode toggle between local and remote clawd instances. Introduces ConnectionMode enum (local/remote) with associated settings for remote target, identity, and project root. Bumps onboarding version to 3 and resets stale voice wake forward commands.

---

## 00673 — VoiceWake: document escape path and reset stale forward command
**SHA:** 7efa152418 · **Date:** 2025-12-07 18:20
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeForwarder.swift or documentation
**Tags:** `documentation`

Documents the shell escape approach for transcript forwarding. Adds comments explaining why single-quoted literals are used instead of stdin or base64 encoding.

---

## 00674 — VoiceWake: document escape path and reset stale forward command
**SHA:** 27e96999cf · **Date:** 2025-12-07 18:23
**Files changed:** apps/macos/Sources/Clawdis/
**Tags:** `documentation`, `bugfix`

Duplicate commit message. Additional documentation updates and forward command reset logic to handle legacy configurations.

---

## 00675 — macOS: show last health result with age in menu
**SHA:** 1722148333 · **Date:** 2025-12-07 17:23
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `ux`

Displays last health check result timestamp with relative age in menu bar. Shows when health check last ran and whether it succeeded or failed.

---

## 00676 — macOS: fix web chat agent PATH and surface stderr
**SHA:** b3f79e5b02 · **Date:** 2025-12-07 17:31
**Files changed:** apps/macos/Sources/Clawdis/
**Tags:** `bugfix`, `verbosity`

Fixes PATH environment variable for web chat agent subprocess. Surfaces stderr output to help diagnose why agent processes might fail to start or execute commands.

---

## 00677 — VoiceWake: add escaping regression tests
**SHA:** fb2a7d8cd1 · **Date:** 2025-12-07 18:25
**Files changed:** apps/macos/Tests/ClawdisIPCTests/VoiceWakeForwarderTests.swift
**Tags:** `testing`

Adds regression tests for shell escaping edge cases. Tests special characters, quotes, and whitespace handling in transcript forwarding to prevent injection vulnerabilities.

---

## 00678 — style: tighten onboarding hero spacing
**SHA:** 38a856f7ff · **Date:** 2025-12-07 18:30
**Files changed:** apps/macos/Sources/Clawdis/OnboardingView.swift
**Tags:** `ux`

Reduces vertical spacing in onboarding hero section. Tightens layout to fit more content without scrolling.

---

## 00679 — style: increase onboarding content height
**SHA:** 6c2a8d6047 · **Date:** 2025-12-07 18:31
**Files changed:** apps/macos/Sources/Clawdis/OnboardingView.swift
**Tags:** `ux`

Increases content area height in onboarding window to accommodate additional settings. Adjusts window dimensions to prevent clipping.

---

## 00680 — style: compact remote setup card and move advanced ssh fields
**SHA:** 855976df84 · **Date:** 2025-12-07 18:37
**Files changed:** apps/macos/Sources/Clawdis/
**Tags:** `ux`

Compacts remote setup card layout and moves advanced SSH fields (identity, port) to expandable section. Simplifies initial remote configuration UI while keeping advanced options accessible.

---

## 00681 — style: enlarge onboarding window to fit full permission list
**SHA:** d57ebb3c94 · **Date:** 2025-12-07 18:38
**Files changed:** apps/macos/Sources/Clawdis/OnboardingView.swift
**Tags:** `ux`

Increases onboarding window size to display full permission list without scrolling. Ensures all required permissions are visible during initial setup.

---

## 00682 — chore: surface helper install status in onboarding
**SHA:** 558af7a454 · **Date:** 2025-12-07 18:43
**Files changed:** apps/macos/Sources/Clawdis/OnboardingView.swift
**Tags:** `ux`

Shows CLI helper installation status during onboarding. Displays whether clawdis-mac symlinks are installed and where they point.

---

## 00683 — build: add local node bin to restart script PATH
**SHA:** d463c82c95 · **Date:** 2025-12-07 18:49
**Files changed:** scripts/
**Tags:** `bugfix`

Adds local node_modules/.bin to PATH in restart script. Ensures pnpm and other dev tools are found when restarting relay process.

---

## 00684 — style: increase onboarding window height
**SHA:** 8a8ac1ffe6 · **Date:** 2025-12-07 18:59
**Files changed:** apps/macos/Sources/Clawdis/OnboardingView.swift
**Tags:** `ux`

Further increases onboarding window height to prevent clipping of newly added remote setup options.

---

## 00685 — Launch agent: disable autostart without killing running app
**SHA:** d73d571f19 · **Date:** 2025-12-07 19:01
**Files changed:** apps/macos/Sources/Clawdis/
**Tags:** `process-lifecycle`

Allows disabling launch agent autostart without terminating currently running app instance. Unloads launch agent but leaves active process running.

---

## 00686 — Utilities: add age helper for menu health label
**SHA:** a3b99dc309 · **Date:** 2025-12-07 19:02
**Files changed:** apps/macos/Sources/Clawdis/Utilities.swift
**Tags:** `refactor`

Adds utility function to format relative age strings for health check timestamps. Helper function used by menu bar to display "5 minutes ago" style labels.

---

## 00687 — MenuBar: fix health label age string
**SHA:** 0f74e372ba · **Date:** 2025-12-07 19:03
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `bugfix`

Fixes formatting of health check age string in menu bar. Corrects age calculation and string formatting using new age helper utility.

---

## 00688 — macOS: surface stderr in health failure text
**SHA:** 7b77e9f9ae · **Date:** 2025-12-07 21:37
**Files changed:** apps/macos/Sources/Clawdis/
**Tags:** `verbosity`

Includes stderr output in health check failure messages. Helps diagnose why health checks fail by showing actual error messages from subprocess.

---

## 00689 — Add Bun bundle docs and Telegram grammY support
**SHA:** 4d3d9cca2a · **Date:** 2025-12-07 22:46
**Files changed:** docs/mac/bun.md, docs/telegram.md, package.json, scripts/package-mac-app.sh
**Tags:** `documentation`, `provider`, `dependency`

Adds comprehensive documentation for Bun runtime bundling in macOS app and Telegram bot support. Creates docs/mac/bun.md explaining arm64 Bun embedding, build flow, and testing. Creates docs/telegram.md covering grammY Bot API integration, webhook setup, and configuration. Adds grammy and @grammyjs/transformer-throttler dependencies to package.json.

---

## 00690 — Telegram: enable grammY throttler and webhook tests
**SHA:** 5f5846a08b · **Date:** 2025-12-07 22:52
**Files changed:** src/telegram/
**Tags:** `provider`, `testing`

Enables grammY throttler plugin to respect Telegram rate limits and adds webhook test coverage. Implements automatic request throttling to avoid 429 flood errors.

---

## 00691 — chore: update dependencies
**SHA:** ebc852b358 · **Date:** 2025-12-07 22:53
**Files changed:** package.json, pnpm-lock.yaml
**Tags:** `dependency`

Updates project dependencies to latest compatible versions. Standard dependency maintenance commit.

---

## 00692 — docs: move grammY research note to docs/grammy.md
**SHA:** 1595fb8739 · **Date:** 2025-12-07 22:53
**Files changed:** docs/grammy.md
**Tags:** `documentation`

Moves grammY research notes from inline comments or README to dedicated docs/grammy.md file. Consolidates Telegram implementation research in proper documentation location.

---

## 00693 — chore: refresh webchat bundle
**SHA:** 0fba7d41a6 · **Date:** 2025-12-07 22:57
**Files changed:** apps/macos/Sources/Clawdis/Resources/WebChat/
**Tags:** `refactor`

Rebuilds WebChat bundle with latest changes. Updates bundled bootstrap.js and related assets after recent webchat modifications.

---

## 00694 — style: bump onboarding height to 840px
**SHA:** 891e1388ba · **Date:** 2025-12-07 22:58
**Files changed:** apps/macos/Sources/Clawdis/OnboardingView.swift
**Tags:** `ux`

Sets onboarding window height to fixed 840px to accommodate all content including remote setup and permission lists without scrolling.

---

## 00695 — ui: align voice wake forwarding with remote mode
**SHA:** 40a6574b95 · **Date:** 2025-12-07 23:04
**Files changed:** apps/macos/Sources/Clawdis/
**Tags:** `ux`, `refactor`

Aligns voice wake forwarding UI to work consistently with new remote mode settings. Ensures forwarding configuration respects connection mode selection.

---

## 00696 — ui: make General tab scrollable
**SHA:** 9ee7a14685 · **Date:** 2025-12-07 23:06
**Files changed:** apps/macos/Sources/Clawdis/GeneralSettings.swift
**Tags:** `ux`

Makes General settings tab scrollable to handle overflow when remote setup and other options are shown. Wraps content in ScrollView to prevent clipping.

---

## 00697 — fix: remote test uses CLI path discovery again
**SHA:** 5cfda2803d · **Date:** 2025-12-07 23:12
**Files changed:** apps/macos/Tests/
**Tags:** `testing`, `bugfix`

Fixes remote tests to use CLI path discovery logic instead of hardcoded paths. Ensures tests match production behavior for finding clawdis-mac binary.

---

## 00698 — ui: reuse compact remote card in General and hide voice wake forwarder
**SHA:** d7281286ba · **Date:** 2025-12-07 23:20
**Files changed:** apps/macos/Sources/Clawdis/GeneralSettings.swift, apps/macos/Sources/Clawdis/VoiceWakeSettings.swift
**Tags:** `ux`, `refactor`

Reuses compact remote card component in General settings and hides voice wake forwarder section when remote mode is active. Reduces UI duplication and prevents conflicting remote configurations.

---

## 00699 — ui: fold remote mode label into picker
**SHA:** 091471293d · **Date:** 2025-12-07 23:21
**Files changed:** apps/macos/Sources/Clawdis/
**Tags:** `ux`

Combines remote mode label and picker into single compact control. Reduces vertical space usage in settings UI.

---

## 00700 — ui: move health/cli info to Debug; add single health row in General
**SHA:** 1019872832 · **Date:** 2025-12-07 23:22
**Files changed:** apps/macos/Sources/Clawdis/GeneralSettings.swift, apps/macos/Sources/Clawdis/DebugSettings.swift
**Tags:** `ux`, `refactor`

Moves detailed health and CLI information to Debug settings tab while showing simplified health status row in General. Streamlines General tab while preserving full diagnostic info in Debug section.

---
