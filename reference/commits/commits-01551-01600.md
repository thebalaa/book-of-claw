# Commit Reference: 01551–01600

A plain factual summary of every commit in the OpenClaw repository, from commit 1551 through commit 1600.

---

## 01551 — chore: ignore lit dist build output
**SHA:** e275ba8d2e · **Date:** 2025-12-17 19:13:40
**Files changed:** `.gitignore`, `vendor/a2ui/renderers/lit/dist/.tsbuildinfo`, `vendor/a2ui/renderers/lit/dist/src/0.8/core.d.ts`
**Tags:** `cleanup`

Added vendor/a2ui/renderers/lit/dist/ to .gitignore to prevent tracking of generated Lit renderer build artifacts. This reduces repository size and prevents unnecessary merge conflicts from auto-generated TypeScript declaration files.

---

## 01552 — test: avoid ENOTEMPTY cleanup race
**SHA:** a0c4b1e061 · **Date:** 2025-12-17 19:14:47
**Files changed:** `src/web/auto-reply.test.ts`
**Tags:** `testing`

Modified test cleanup logic to retry directory removal up to 10 times when encountering ENOTEMPTY, EBUSY, or EPERM errors. This addresses race conditions where async session-store writes can conflict with recursive directory deletion in tests.

---

## 01553 — feat: show Anthropic auth mode + OAuth connect
**SHA:** 1a4540d386 · **Date:** 2025-12-17 19:14:54
**Files changed:** `apps/macos/Sources/Views/SettingsView.swift`, `apps/macos/Sources/Gateway/AuthenticationView.swift`
**Tags:** `core-feature`

Added display of Anthropic authentication mode in macOS settings and implemented OAuth connection interface. Users can now see their current authentication method and connect via OAuth in the gateway authentication view.

---

## 01554 — chore: rebuild CanvasA2UI bundle
**SHA:** e9bfe34850 · **Date:** 2025-12-17 19:15:00
**Files changed:** `vendor/canvas-a2ui/dist/index.js`, `vendor/canvas-a2ui/dist/index.d.ts`
**Tags:** `cleanup`

Rebuilt the CanvasA2UI bundle to incorporate pending changes and updates. This ensures the bundled A2UI renderer for Canvas is current with source code modifications.

---

## 01555 — Discovery: wide-area bridge DNS-SD
**SHA:** 557ffdbe35 · **Date:** 2025-12-17 20:25:40
**Files changed:** `apps/ios/Sources/Bridge/BridgeDiscoveryModel.swift`, `src/cli/dns-cli.ts`, `src/discovery/bridge-discovery.ts`
**Tags:** `core-feature`

Extended discovery system to support wide-area DNS-SD for bridge connectivity. Added support for discovering bridges across network boundaries, enabling improved device discovery in distributed network topologies.

---

## 01556 — macOS: fold agent control into GatewayConnection
**SHA:** 17a27fd312 · **Date:** 2025-12-17 17:10:30
**Files changed:** `apps/macos/Sources/Gateway/GatewayConnection.swift`, `apps/macos/Sources/Gateway/AgentController.swift`
**Tags:** `refactor`

Consolidated agent control logic into the GatewayConnection class to reduce architectural complexity. Previously separate agent control responsibilities are now managed as part of the gateway connection lifecycle.

---

## 01557 — macOS: fix gateway strict-concurrency issues
**SHA:** c1985443fd · **Date:** 2025-12-17 17:22:44
**Files changed:** `apps/macos/Sources/Gateway/GatewayConnection.swift`, `apps/macos/Sources/Gateway/ThreadSafeQueueProvider.swift`
**Tags:** `bugfix`

Fixed thread-safety violations in gateway code to comply with strict concurrency requirements. Ensured proper actor isolation and MainActor annotations for UI-related gateway operations.

---

## 01558 — macOS: auto-start gateway for Canvas actions
**SHA:** 9c7d51429e · **Date:** 2025-12-17 17:36:40
**Files changed:** `apps/macos/Sources/Canvas/CanvasViewController.swift`, `apps/macos/Sources/Gateway/GatewayManager.swift`
**Tags:** `core-feature`

Implemented automatic gateway startup when Canvas actions are triggered. The gateway is now initialized proactively to ensure availability when users interact with Canvas features.

---

## 01559 — Canvas: fix A2UI click actions
**SHA:** 4fb3e0500a · **Date:** 2025-12-17 19:21:54
**Files changed:** `apps/macos/Sources/Canvas/A2UIClickHandler.swift`, `vendor/a2ui/renderers/canvas/index.ts`
**Tags:** `bugfix`

Fixed click event handling in Canvas A2UI renderer to properly forward user interactions. Resolved issues where some click actions were not being correctly propagated to the agent.

---

## 01560 — Menu: reopen canvas without reload
**SHA:** cf82e37c36 · **Date:** 2025-12-17 19:27:59
**Files changed:** `apps/macos/Sources/Menu/CanvasMenuHandler.swift`, `apps/macos/Sources/Canvas/CanvasViewController.swift`
**Tags:** `ux`

Modified canvas reopening behavior to skip full reload when menu action is triggered. Canvas now reopens more quickly by reusing existing window and connection state rather than reinitializing.

---

## 01561 — fix: improve canvas A2UI forwarding
**SHA:** e6a96bea47 · **Date:** 2025-12-17 19:45:27
**Files changed:** `apps/macos/Sources/Canvas/CanvasA2UIBridge.swift`
**Tags:** `bugfix`

Enhanced A2UI message forwarding to Canvas to improve reliability and message delivery. Fixed edge cases where complex A2UI messages were not being fully transmitted to the Canvas context.

---

## 01562 — Node pairing: avoid blocking main actor
**SHA:** 56d94e6974 · **Date:** 2025-12-17 19:55:41
**Files changed:** `apps/macos/Sources/Pairing/NodePairingManager.swift`
**Tags:** `bugfix`

Moved blocking node pairing operations off the main actor to prevent UI freezing. Node pairing now executes on background threads with proper result callbacks to the main actor.

---

## 01563 — Canvas: click progress + context-rich actions
**SHA:** 9051c5891e · **Date:** 2025-12-17 20:19:37
**Files changed:** `apps/macos/Sources/Canvas/CanvasClickHandler.swift`, `src/api/canvas-messages.ts`
**Tags:** `core-feature`

Added click progress indication and context information to Canvas click actions. Users can now see which elements they've clicked on, and the agent receives enriched context about the interaction.

---

## 01564 — Agents: fix pi-tools typing
**SHA:** 3e9310d6cd · **Date:** 2025-12-17 20:38:52
**Files changed:** `src/agents/tools/pi-tools.ts`, `src/types/agent-tools.d.ts`
**Tags:** `bugfix`

Corrected TypeScript type definitions for pi-tools in the agents module. Fixed type mismatches that were causing compilation warnings during agent tool initialization.

---

## 01565 — tools: add blucli
**SHA:** 249f97d1ed · **Date:** 2025-12-17 20:39:34
**Files changed:** `src/tools/blucli/index.ts`, `src/tools/blucli/blucli-wrapper.ts`
**Tags:** `core-feature`

Added blucli tool integration to the agents toolset. This enables agents to invoke blucli commands for Bluetooth device management and interaction.

---

## 01566 — Docs: require permission to switch branches
**SHA:** cc235fc312 · **Date:** 2025-12-17 20:43:04
**Files changed:** `docs/DEVELOPMENT.md`, `src/git/branch-switcher.ts`
**Tags:** `documentation`

Updated documentation and implementation to require explicit permission before switching git branches programmatically. Added safety checks to prevent unintended branch switches during automated operations.

---

## 01567 — feat: Swift chat parity (abort/sessions/stream)
**SHA:** 428a82e734 · **Date:** 2025-12-17 15:51:31
**Files changed:** `apps/macos/Sources/Chat/ChatManager.swift`, `apps/macos/Sources/Chat/StreamingChatController.swift`
**Tags:** `core-feature`

Implemented feature parity between web and Swift chat implementations for abort, session management, and streaming. Swift chat now supports message abortion, session switching, and server-sent event streaming.

---

## 01568 — fix: bonjour discovery parity
**SHA:** cc1d8060c4 · **Date:** 2025-12-17 20:57:04
**Files changed:** `apps/android/android/bridge/BonjourDiscoveryManager.kt`, `src/discovery/bonjour-handler.ts`
**Tags:** `bugfix`

Fixed parity between Android and web Bonjour discovery implementations. Android bridge now correctly discovers services with the same filtering and prioritization logic as the web implementation.

---

## 01569 — Mobile: prevent sleep setting
**SHA:** 7fe7c30b17 · **Date:** 2025-12-17 21:01:47
**Files changed:** `apps/android/android/core/WakeLockManager.kt`, `apps/ios/Sources/Core/ScreenKeepAliveController.swift`
**Tags:** `core-feature`

Added prevent-sleep functionality to both Android and iOS. When active, the application now keeps the device screen awake during important operations to prevent session interruption.

---

## 01570 — macOS: fix InstanceInfo device fields
**SHA:** 0677567cdd · **Date:** 2025-12-17 20:03:20
**Files changed:** `apps/macos/Sources/Models/InstanceInfo.swift`
**Tags:** `bugfix`

Fixed device field mappings in InstanceInfo model to correctly populate device identifiers and metadata. Previously incorrect field assignments are now properly synchronized with the device discovery response.

---

## 01571 — Bridge: advertise node capabilities
**SHA:** 079c1d8786 · **Date:** 2025-12-17 20:03:27
**Files changed:** `src/bridge/presence.ts`, `src/bridge/node-capabilities.ts`
**Tags:** `core-feature`

Implemented node capability advertisement in the bridge protocol. Bridge now communicates supported features and capabilities to connected nodes during discovery and handshake.

---

## 01572 — clawdis-mac: enrich node list output
**SHA:** c452f8c430 · **Date:** 2025-12-17 20:03:30
**Files changed:** `src/cli/clawdis-mac.ts`, `src/cli/output-formatters.ts`
**Tags:** `ux`

Enhanced clawdis-mac node list output with additional device information and formatting. Users now see more detailed information about available nodes including device models and capabilities.

---

## 01573 — Tests: cover clawdis-mac node list
**SHA:** 0321174519 · **Date:** 2025-12-17 20:03:37
**Files changed:** `src/cli/clawdis-mac.test.ts`
**Tags:** `testing`

Added comprehensive test coverage for clawdis-mac node list functionality. Tests verify proper formatting and information display for various node configurations.

---

## 01574 — macOS: include node hardware identifiers
**SHA:** fca6e466b1 · **Date:** 2025-12-17 20:10:50
**Files changed:** `apps/macos/Sources/Models/DeviceInfo.swift`, `apps/macos/Sources/Models/NodeInfo.swift`
**Tags:** `core-feature`

Extended node information to include hardware identifiers and model information. This allows the system to identify devices by their hardware characteristics for better UI presentation.

---

## 01575 — Android: advertise device model to bridge
**SHA:** df4e4534f4 · **Date:** 2025-12-17 20:10:58
**Files changed:** `apps/android/android/bridge/DeviceInfoProvider.kt`
**Tags:** `core-feature`

Modified Android device information provider to advertise device model and hardware details to the bridge. The bridge now receives complete device identity information from Android nodes.

---

## 01576 — clawdis-mac: show hardware model in node list
**SHA:** a40fc50e5e · **Date:** 2025-12-17 20:11:05
**Files changed:** `src/cli/clawdis-mac.ts`
**Tags:** `ux`

Updated clawdis-mac to display hardware model information in the node list output. Users can now see the model of each connected device alongside other node information.

---

## 01577 — Docs/tests: node list hardware fields
**SHA:** 9d29fbbf80 · **Date:** 2025-12-17 20:11:13
**Files changed:** `docs/API.md`, `src/cli/clawdis-mac.test.ts`
**Tags:** `documentation`

Documented hardware field additions to node list API and added corresponding test cases. Test coverage validates that hardware model and identifier fields are correctly populated.

---

## 01578 — Presence: add device identity fields
**SHA:** 51bdf01e2e · **Date:** 2025-12-17 21:17:51
**Files changed:** `src/models/presence.ts`, `src/types/device-info.ts`
**Tags:** `core-feature`

Extended presence information model to include device identity fields such as hardware model, device identifier, and device class. This enriches the presence data available to other nodes.

---

## 01579 — style: fix lint
**SHA:** 2b2376d4c0 · **Date:** 2025-12-17 21:50:54
**Files changed:** `apps/macos/Sources/Models/DeviceInfo.swift`
**Tags:** `cleanup`

Fixed Swift lint and formatting issues in device information models. Code now complies with project style guidelines.

---

## 01580 — fix: dedupe hello fields
**SHA:** d4b3d504e4 · **Date:** 2025-12-17 21:53:38
**Files changed:** `apps/android/android/bridge/HelloMessageBuilder.kt`
**Tags:** `bugfix`

Fixed duplicate field entries in Android bridge hello message construction. The hello message now contains unique field entries without redundant information.

---

## 01581 — feat: add status pill overlay
**SHA:** e6ba373d08 · **Date:** 2025-12-17 22:00:12
**Files changed:** `apps/android/android/ui/StatusPillView.kt`, `apps/android/android/canvas/CanvasStatusOverlay.kt`
**Tags:** `core-feature`

Added status pill overlay to Android Canvas interface. A visual indicator now shows connection status and operational state in the bottom corner of the canvas view.

---

## 01582 — feat: iOS canvas background
**SHA:** fce487669b · **Date:** 2025-12-17 22:03:11
**Files changed:** `apps/ios/Sources/Canvas/CanvasViewController.swift`, `apps/ios/Resources/CanvasBackground.xcassets`
**Tags:** `core-feature`

Implemented canvas background imagery for iOS Canvas interface. Canvas now displays a themed background that improves visual appearance when no content is shown.

---

## 01583 — fix: harden request handling
**SHA:** e0276ed4b4 · **Date:** 2025-12-17 22:04:22
**Files changed:** `src/gateway/request-handler.ts`, `src/gateway/error-handling.ts`
**Tags:** `bugfix`

Hardened gateway request handling with improved error detection and validation. Invalid requests are now caught earlier with better error messages and handling.

---

## 01584 — style: format bridge hello
**SHA:** fe6bf6966b · **Date:** 2025-12-17 22:04:51
**Files changed:** `apps/android/android/bridge/HelloMessageBuilder.kt`
**Tags:** `cleanup`

Applied code formatting fixes to Android bridge hello message builder. Code now conforms to project formatting standards.

---

## 01585 — test: stabilize chat abort
**SHA:** 35214b6dec · **Date:** 2025-12-17 22:04:54
**Files changed:** `src/gateway/chat.test.ts`
**Tags:** `testing`

Stabilized chat abort test to reduce flakiness and improve reliability. Test now properly waits for stream termination before assertions.

---

## 01586 — fix: stabilize chat.abort
**SHA:** 69daa24869 · **Date:** 2025-12-17 22:12:16
**Files changed:** `src/gateway/chat.ts`
**Tags:** `bugfix`

Fixed race condition in chat abortion that was causing test failures. Chat stream now properly terminates and cleans up resources when abort is called.

---

## 01587 — fix: fix AgentTool schema typing
**SHA:** 09819f8b2e · **Date:** 2025-12-17 22:12:19
**Files changed:** `src/agents/AgentTool.ts`, `src/types/agent-tools.d.ts`
**Tags:** `bugfix`

Corrected TypeScript schema type definitions for AgentTool. Fixed generic type parameters that were causing type checking failures.

---

## 01588 — macOS: show friendly device names in Instances
**SHA:** 7950a646c3 · **Date:** 2025-12-17 22:23:57
**Files changed:** `apps/macos/Sources/Models/InstanceInfo.swift`, `apps/macos/Sources/UI/InstanceList.swift`
**Tags:** `ux`

Modified instance display to show friendly device names instead of raw identifiers. Users now see human-readable device names like "iPhone 15" instead of technical identifiers.

---

## 01589 — fix: canvas idle background + tailscale DNS
**SHA:** 76ddfc4a9e · **Date:** 2025-12-17 22:27:16
**Files changed:** `apps/android/android/canvas/CanvasController.kt`, `src/discovery/tailscale-dns.ts`
**Tags:** `bugfix`

Fixed canvas idle state background rendering on Android and improved Tailscale DNS resolution. Canvas now correctly displays idle background and DNS queries work reliably through Tailscale.

---

## 01590 — macOS: load device model names from dataset
**SHA:** 888dbd7d11 · **Date:** 2025-12-17 22:55:50
**Files changed:** `apps/macos/Sources/Models/DeviceModelDatabase.swift`, `apps/macos/Resources/device-models.json`
**Tags:** `core-feature`

Implemented device model name database on macOS to display friendly names for various Apple devices. The application now looks up device models and displays human-readable names.

---

## 01591 — test: harden abort/stream + hide session switching
**SHA:** 44365f2e27 · **Date:** 2025-12-17 16:21:08
**Files changed:** `src/gateway/chat.test.ts`, `src/models/session.ts`
**Tags:** `testing`

Hardened chat abort and streaming tests and removed session switching visibility during certain operations. Tests now properly wait for async operations and UI no longer exposes incomplete session transitions.

---

## 01592 — ui: move connection pill into composer
**SHA:** cdea744725 · **Date:** 2025-12-17 17:28:26
**Files changed:** `apps/macos/Sources/Chat/ChatComposer.swift`
**Tags:** `ui`

Moved connection status pill from the chat header into the message composer. The status indicator is now positioned within the composer area for better visual organization.

---

## 01593 — ui: tighten padding + keep status in composer
**SHA:** 5b9e51bfaa · **Date:** 2025-12-17 17:46:37
**Files changed:** `apps/macos/Sources/Chat/ChatComposer.swift`
**Tags:** `ui`

Reduced padding in chat composer and ensured status pill remains visible. Layout is now more compact while maintaining status visibility.

---

## 01594 — ui: align status pill with send
**SHA:** 9fe04f5659 · **Date:** 2025-12-17 17:53:17
**Files changed:** `apps/macos/Sources/Chat/ChatComposer.swift`
**Tags:** `ui`

Aligned status pill vertically and horizontally with the send button. Visual alignment is now consistent and aesthetically pleasing.

---

## 01595 — ui: reduce padding
**SHA:** 6652b1f4f3 · **Date:** 2025-12-17 17:59:01
**Files changed:** `apps/macos/Sources/Chat/ChatComposer.swift`
**Tags:** `ui`

Further reduced padding in the chat composer area. Layout is now more efficient with better use of available space.

---

## 01596 — ChatUI: swiftformat fixes
**SHA:** ca85d217ec · **Date:** 2025-12-17 22:43:15
**Files changed:** `apps/macos/Sources/Chat/ChatUI.swift`, `apps/ios/Sources/Chat/ChatUI.swift`
**Tags:** `cleanup`

Applied swiftformat code formatting to ChatUI files across platforms. Code now follows consistent formatting standards.

---

## 01597 — refactor: SwiftUI-only WebChat UI
**SHA:** 875cf9a054 · **Date:** 2025-12-17 23:05:28
**Files changed:** `apps/macos/Sources/Chat/WebChatController.swift`, `apps/macos/Package.swift`
**Tags:** `refactor`

Refactored WebChat UI implementation to use SwiftUI exclusively, removing dependency on legacy UIKit components. Codebase is now modernized with a uniform SwiftUI approach.

---

## 01598 — nodes: better default display names
**SHA:** b3e466ccb6 · **Date:** 2025-12-17 23:15:15
**Files changed:** `src/models/node.ts`, `src/display/node-formatter.ts`
**Tags:** `ux`

Improved node display name generation with better default naming logic. Nodes now show more informative names based on device type and local hostname when friendly names aren't available.

---

## 01599 — chore: remove legacy bundled web assets
**SHA:** 3ed33c5856 · **Date:** 2025-12-17 23:08:54
**Files changed:** `apps/macos/Resources/webchat-bundle/`, `build/webchat-assets.ts`
**Tags:** `cleanup`

Removed legacy bundled web chat assets from the macOS build. WebChat now loads assets dynamically rather than packaging them at build time, reducing binary size.

---

## 01600 — style: satisfy biome
**SHA:** 0844fa38a8 · **Date:** 2025-12-17 23:12:45
**Files changed:** `src/gateway/request-handler.ts`, `src/gateway/response-formatter.ts`
**Tags:** `cleanup`

Applied Biome code formatting and linting fixes to gateway code. Code now passes all linting checks and follows standardized formatting rules.

---
