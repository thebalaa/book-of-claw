# Commit Reference: 00901–00950

A plain factual summary of every commit in the OpenClaw repository, from commit 901 through commit 950.

---

## 00901 — RPC: route logs to stderr to keep stdout JSON clean
**SHA:** d66a05dc41 · **Date:** 2025-12-09 04:30
**Files changed:** src/logging.ts, src/rpc/loop.ts
**Tags:** `verbosity`, `refactor`

Added `routeLogsToStderr()` function to redirect all console output to stderr when in RPC/JSON mode. Modified console patching to write to stderr instead of stdout when `forceConsoleToStderr` is enabled. RPC loop now calls this function on startup to keep stdout clean for JSON responses.

## 00902 — Relay: force app to run relay via system node
**SHA:** 2ebad55a59 · **Date:** 2025-12-09 04:36
**Files changed:** apps/macos/Sources/Clawdis/RelayProcessManager.swift, apps/macos/Sources/Clawdis/Utilities.swift
**Tags:** `refactor`, `process-lifecycle`

Changed RelayProcessManager to use system Node runtime instead of bundled executables. Refactored `resolveCommand()` to call `CommandResolver.runtimeResolution()` and build runtime command with relay entrypoint. Made several private CommandResolver methods public (static) to support this architecture.

## 00903 — WebChat: fix packaged root resolution
**SHA:** fc1d58b631 · **Date:** 2025-12-09 04:36
**Files changed:** src/webchat/server.ts
**Tags:** `bugfix`

Fixed WebChat asset resolution to try multiple candidate paths when bundled inside Clawdis.app. Replaced single hardcoded path with array of candidates including `../../../WebChat`, `../../WebChat`, and source tree location. Throws error if no candidate exists.

## 00904 — Coordinator: centralize voice sessions for wake and push-to-talk
**SHA:** 9ef1545d06 · **Date:** 2025-12-09 05:41
**Files changed:** apps/macos/Sources/Clawdis/VoicePushToTalk.swift, apps/macos/Sources/Clawdis/VoiceSessionCoordinator.swift, apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift, apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift
**Tags:** `refactor`, `core-feature`

Created new `VoiceSessionCoordinator` actor to centralize session management for both wake-word and push-to-talk voice input. VoiceSessionCoordinator maintains session state including token, text, attributed string, forward config, and auto-send logic. Updated VoicePushToTalk and VoiceWakeRuntime to route all session operations through the coordinator instead of calling VoiceWakeOverlayController directly.

## 00905 — Gateway: finalize WS control plane
**SHA:** b2e7fb01a9 · **Date:** 2025-12-09 14:41
**Files changed:** apps/macos/Sources/Clawdis/AgentRPC.swift, apps/macos/Sources/Clawdis/AnyCodable.swift, apps/macos/Sources/Clawdis/GatewayChannel.swift, src/gateway/protocol.ts, src/gateway/server.ts, src/webchat/server.ts, and others
**Tags:** `core-feature`, `refactor`

Replaced legacy HTTP-based RPC with WebSocket control plane for Gateway. AgentRPC now uses GatewayChannel to connect via WebSocket at port 18789. Introduced hello/hello-ok handshake protocol with versioning, capabilities, and auth. Gateway server broadcasts presence, agent events, and tick events to all connected clients. WebChat server also connects to Gateway via WebSocket for all operations.

## 00906 — WebChat: loopback snapshot hydration
**SHA:** 2746efeb25 · **Date:** 2025-12-09 14:41
**Files changed:** docs/webchat.md, src/webchat/server.test.ts, src/webchat/server.ts
**Tags:** `core-feature`, `documentation`, `testing`

WebChat server now maintains a single WebSocket connection to Gateway and hydrates initial state from Gateway hello-ok snapshot. Updated documentation to explain that WebChat proxies all operations through Gateway WS connection. Added tests for snapshot hydration and gateway event broadcasting. WebChat auto-refreshes health and presence if sequence gap is detected.

## 00907 — Gateway: discriminated protocol schema + CLI updates
**SHA:** 172ce6c79f · **Date:** 2025-12-09 15:01
**Files changed:** apps/macos/Sources/Clawdis/AgentRPC.swift, apps/macos/Sources/Clawdis/AnyCodable.swift, apps/macos/Sources/ClawdisProtocol/GatewayModels.swift, apps/macos/Sources/ClawdisProtocol/Protocol.swift, src/gateway/protocol.ts
**Tags:** `type-safety`, `refactor`

Introduced discriminated union types for Gateway protocol frames using TypeBox schemas. Added AnyCodable helper for Swift to handle heterogeneous JSON payloads. Created GatewayModels.swift with typed Hello, HelloOk, Request, Response, Event structs. Updated CLI to use strongly-typed protocol definitions instead of raw dictionaries.

## 00908 — CLI: remove relay/heartbeat legacy commands
**SHA:** d1217e84c7 · **Date:** 2025-12-09 15:06
**Files changed:** apps/macos/Sources/Clawdis/GatewayChannel.swift, apps/macos/Sources/ClawdisProtocol/Protocol.swift
**Tags:** `refactor`, `naming`

Cleaned up legacy relay and heartbeat command references. Updated GatewayChannel to use `AnyCodable` params instead of `[String: Any]`. Applied formatting fixes to Protocol.swift including removing redundant try keywords and simplifying return statements.

## 00909 — Protocol: lint fixes for client/program
**SHA:** cf5769753a · **Date:** 2025-12-09 15:18
**Files changed:** apps/macos/Sources/ClawdisProtocol/Protocol.swift
**Tags:** `linting`

Applied Swift linting and formatting fixes to Protocol.swift. Simplified function bodies by removing redundant return keywords and try statements. No behavioral changes, purely formatting and style cleanup.

## 00910 — Protocol: add TypeBox-driven Swift generator
**SHA:** b0c196cf82 · **Date:** 2025-12-09 15:21
**Files changed:** apps/macos/Sources/ClawdisProtocol/AnyCodable.swift, apps/macos/Sources/ClawdisProtocol/GatewayModels.swift, scripts/protocol-gen-swift.ts, src/gateway/protocol.ts
**Tags:** `type-safety`, `refactor`

Added TypeScript script to generate Swift types from TypeBox protocol schemas. Script generates enums, structs, and Codable conformance for all Gateway protocol types including Hello, HelloOk, Request, Response, Event frames. Generated GatewayModels.swift includes all protocol types with proper Codable support and AnyCodable for dynamic payloads.

## 00911 — Protocol: legacy shim file for Xcode references
**SHA:** f244aba03d · **Date:** 2025-12-09 15:23
**Files changed:** apps/macos/Sources/ClawdisProtocol/Protocol.swift
**Tags:** `refactor`

Kept Protocol.swift as legacy shim file for existing Xcode references. All actual protocol definitions moved to generated GatewayModels.swift, but Protocol.swift maintained for backward compatibility with Xcode project files.

## 00912 — Mac: use typed GatewayFrame + forward-compatible Swift generator
**SHA:** a7737912b0 · **Date:** 2025-12-09 15:26
**Files changed:** apps/macos/Sources/Clawdis/GatewayChannel.swift, apps/macos/Sources/ClawdisProtocol/GatewayModels.swift, scripts/protocol-gen-swift.ts
**Tags:** `type-safety`, `refactor`

Updated GatewayChannel to use strongly-typed GatewayFrame discriminated union instead of raw dictionaries. Enhanced Swift protocol generator to produce forward-compatible frame types with proper enum support. All Gateway WS messages now use typed frames for compile-time safety.

## 00913 — Mac: build GatewayProtocol target and typed presence handling
**SHA:** 336c9d6caa · **Date:** 2025-12-09 15:35
**Files changed:** apps/macos/Sources/Clawdis/PresenceMonitor.swift, apps/macos/Sources/ClawdisProtocol/GatewayModels.swift
**Tags:** `type-safety`, `refactor`

Updated PresenceMonitor to use typed GatewayFrame Event for presence updates instead of raw dictionaries. Added GatewayProtocol as build target. All presence-related Gateway events now decoded using typed Swift structs with proper error handling.

## 00914 — chore(swabble): apply swiftformat
**SHA:** 318457cb2c · **Date:** 2025-12-09 15:36
**Files changed:** apps/macos/Sources/Clawdis/**, apps/macos/Sources/ClawdisProtocol/**
**Tags:** `linting`

Applied SwiftFormat across entire macOS codebase. Standardized indentation, spacing, and Swift code style. No behavioral changes, purely formatting pass.

## 00915 — Mac: type agent events end-to-end
**SHA:** 20d247b3f7 · **Date:** 2025-12-09 15:38
**Files changed:** apps/macos/Sources/Clawdis/AgentEventMonitor.swift, apps/macos/Sources/ClawdisProtocol/GatewayModels.swift
**Tags:** `type-safety`, `refactor`

Replaced raw dictionary handling in AgentEventMonitor with typed GatewayFrame Event decoding. Agent events from Gateway now use strongly-typed Swift structs throughout the event pipeline.

## 00916 — gateway: harden ws protocol and liveness
**SHA:** 72eb240c3b · **Date:** 2025-12-09 17:02
**Files changed:** apps/macos/Sources/Clawdis/GatewayChannel.swift, src/commands/agent.ts, src/gateway/protocol.ts, src/gateway/server.ts
**Tags:** `core-feature`, `process-lifecycle`

Added tick-based liveness monitoring to Gateway WebSocket protocol. Gateway broadcasts tick events at configurable interval (default 30s). Clients track lastTick and reconnect if no tick received within 2x interval tolerance. Added policy field to hello-ok with tickIntervalMs configuration. Clients spawn watchTicks task after successful hello-ok handshake.

## 00917 — ci/docs: enforce protocol check and deprecate control api
**SHA:** 3ced3f4c82 · **Date:** 2025-12-09 17:03
**Files changed:** docs/control-api.md, docs/gateway-protocol.md, scripts/check-protocol.ts
**Tags:** `documentation`, `refactor`

Deprecated legacy HTTP control API in favor of Gateway WebSocket protocol. Updated documentation to mark control API as deprecated and direct users to gateway-protocol.md. Added protocol check script to validate TypeBox schemas match generated Swift code.

## 00918 — tests: cover agent sequencing, tick watchdog, presence fingerprint
**SHA:** 96be7c8990 · **Date:** 2025-12-09 17:05
**Files changed:** src/gateway/server.test.ts
**Tags:** `testing`

Added comprehensive test coverage for Gateway protocol features including agent event sequencing, tick watchdog timeout detection, and presence fingerprint validation. Tests verify correct sequence number handling, tick interval enforcement, and presence state synchronization.

## 00919 — Mac: launch gateway and add relay installer
**SHA:** e40f9c9730 · **Date:** 2025-12-09 16:15
**Files changed:** apps/macos/Sources/Clawdis/RelayProcessManager.swift, apps/macos/Sources/Clawdis/Utilities.swift
**Tags:** `refactor`, `naming`

Updated macOS app to launch gateway process instead of relay. Added installer helpers for gateway binary. RelayProcessManager renamed internal references but kept class name for compatibility.

## 00920 — Debug: rename restart button to Gateway
**SHA:** a86963d62d · **Date:** 2025-12-09 16:16
**Files changed:** apps/macos/Sources/Clawdis/DebugSettings.swift
**Tags:** `naming`, `ux`

Changed debug menu button label from "Restart relay" to "Restart Gateway" to match new naming convention. One-line UI text update.

## 00921 — CLI: add gateway verbose flag
**SHA:** 4bf968a45a · **Date:** 2025-12-09 17:17
**Files changed:** src/index.ts
**Tags:** `verbosity`

Added --verbose flag to gateway command. When enabled, sets log level to trace and enables verbose output for all gateway operations including provider connections.

## 00922 — Docs: rename relay command to gateway
**SHA:** e0ea7be499 · **Date:** 2025-12-09 17:24
**Files changed:** docs/**
**Tags:** `documentation`, `naming`

Updated all documentation to use "gateway" terminology instead of "relay". Changed command examples, configuration references, and architecture descriptions throughout docs directory.

## 00923 — CLI: add gateway --force option
**SHA:** 6afcf43ff2 · **Date:** 2025-12-09 16:28
**Files changed:** src/index.ts, src/gateway/server.ts
**Tags:** `core-feature`

Added --force flag to gateway command to skip runtime validation checks and force gateway startup. Useful for development and troubleshooting scenarios where normal preflight checks would block startup.

## 00924 — Tests: cover gateway --force helpers
**SHA:** dc8f9e043d · **Date:** 2025-12-09 16:31
**Files changed:** src/gateway/server.test.ts
**Tags:** `testing`

Added test coverage for gateway --force flag behavior. Tests verify that force mode skips validation and allows gateway to start even when normal checks would fail.

## 00925 — Status: color provider lines
**SHA:** 796f630a7c · **Date:** 2025-12-09 16:31
**Files changed:** src/commands/status.ts
**Tags:** `ux`

Added color-coding to provider status lines in status command output. Different colors for connected, disconnected, and error states improve visual scanning of multi-provider status.

## 00926 — Gateway: honor verbose for Baileys and show log path
**SHA:** 464e4c1938 · **Date:** 2025-12-09 16:33
**Files changed:** src/gateway/server.ts, src/providers/web/index.ts
**Tags:** `verbosity`

Gateway now passes verbose flag to Baileys WhatsApp library when --verbose is enabled. Also displays log file path on startup so users know where to find detailed logs.

## 00927 — Gateway: start providers and route sends to their surface
**SHA:** 60a68aa136 · **Date:** 2025-12-09 16:38
**Files changed:** src/gateway/server.ts
**Tags:** `core-feature`, `provider`

Gateway now automatically starts configured providers (WhatsApp Web and Telegram) on launch. Added provider startup logic that checks for auth credentials and launches provider monitors. Outbound sends are routed to correct provider based on surface hint in send request.

## 00928 — chore: update dependencies
**SHA:** d9a132b649 · **Date:** 2025-12-09 17:43
**Files changed:** package.json, pnpm-lock.yaml
**Tags:** `dependency`

Updated project dependencies to latest compatible versions. Standard dependency maintenance commit.

## 00929 — UI: unify refresh buttons
**SHA:** 7017756140 · **Date:** 2025-12-09 17:54
**Files changed:** apps/macos/Sources/Clawdis/StatusView.swift, apps/macos/Sources/Clawdis/DebugSettings.swift
**Tags:** `ux`, `refactor`

Unified refresh button styling and behavior across status view and debug settings. Consistent button placement and labels improve UX coherence.

## 00930 — Menu: add debug submenu actions
**SHA:** 80c7b04831 · **Date:** 2025-12-09 17:57
**Files changed:** apps/macos/Sources/Clawdis/AppDelegate.swift
**Tags:** `ux`

Added debug actions to macOS menu bar submenu including open logs, restart gateway, and reveal app in Finder. Provides quick access to common debugging operations.

## 00931 — Mac: surface gateway errors in remote test
**SHA:** d5cd1058ab · **Date:** 2025-12-09 18:01
**Files changed:** apps/macos/Sources/Clawdis/RemoteTest.swift
**Tags:** `ux`, `bugfix`

Improved error display in remote test window. Gateway connection errors now shown clearly in UI instead of silent failures. Helps users diagnose SSH tunnel and remote gateway issues.

## 00932 — macOS: add settings previews
**SHA:** 959ba94eca · **Date:** 2025-12-09 18:04
**Files changed:** apps/macos/Sources/Clawdis/SettingsView.swift
**Tags:** `ux`

Added Xcode preview providers for settings views. Enables live preview of settings UI during development without running full app.

## 00933 — IPC: rename relay socket to gateway.sock
**SHA:** b6bd39660f · **Date:** 2025-12-09 17:03
**Files changed:** src/web/ipc.ts, src/gateway/server.ts
**Tags:** `naming`, `refactor`

Renamed IPC socket file from relay.sock to gateway.sock to match new naming. Updated all socket path references and documentation.

## 00934 — chore: format swift/ts and fix gateway lint
**SHA:** 8d888b426f · **Date:** 2025-12-09 17:11
**Files changed:** apps/macos/Sources/**, src/**
**Tags:** `linting`

Applied formatting to Swift and TypeScript files. Fixed linting warnings in gateway server code. No behavioral changes.

## 00935 — web: show surface + host/ip chips in chat UI
**SHA:** f9370718bc · **Date:** 2025-12-09 17:23
**Files changed:** apps/macos/Sources/Clawdis/Resources/WebChat/**
**Tags:** `ux`

WebChat UI now displays surface type (WhatsApp/Telegram/WebChat) along with host and IP address as chips in message list. Helps users identify message source at a glance.

## 00936 — msg: retry web/telegram sends and add regression tests
**SHA:** d04f7fc6e9 · **Date:** 2025-12-09 17:23
**Files changed:** src/telegram/send.ts, src/web/auto-reply.ts, src/telegram/send.test.ts
**Tags:** `core-feature`, `testing`, `bugfix`

Implemented retry logic with exponential backoff for WhatsApp Web and Telegram message sends. Retries up to 3 times for transient errors (429, timeout, connection issues). Added regression tests to verify retry behavior and terminal error handling.

## 00937 — chore: drop runner shim and add committer helper
**SHA:** 1f19ca1665 · **Date:** 2025-12-09 17:24
**Files changed:** scripts/runner.sh, scripts/commit-helper.sh
**Tags:** `refactor`

Removed obsolete runner.sh script. Added commit-helper.sh to assist with conventional commit message formatting. Development tooling cleanup.

## 00938 — fix(mac): avoid crash decoding gateway frames
**SHA:** fcc8d59588 · **Date:** 2025-12-09 17:36
**Files changed:** apps/macos/Sources/Clawdis/GatewayChannel.swift
**Tags:** `bugfix`

Added defensive nil checks and error handling when decoding Gateway frames in Swift. Prevents crashes when receiving malformed or unexpected frame types from Gateway.

## 00939 — chore(mac): make package/restart skip ts relay
**SHA:** d8fb2f9175 · **Date:** 2025-12-09 17:36
**Files changed:** scripts/package-mac.sh, scripts/restart-mac.sh
**Tags:** `refactor`

Updated macOS packaging and restart scripts to skip TypeScript relay code since app now uses bundled gateway. Simplifies build process.

## 00940 — web: log disconnect error detail in reconnect loop
**SHA:** 67f2bc1385 · **Date:** 2025-12-09 17:38
**Files changed:** src/providers/web/index.ts
**Tags:** `verbosity`, `bugfix`

Enhanced reconnect loop logging for WhatsApp Web provider. Now logs detailed error information when disconnections occur, improving troubleshooting of connection issues.

## 00941 — mac: honor local relay path
**SHA:** a4d5b68134 · **Date:** 2025-12-09 17:40
**Files changed:** apps/macos/Sources/Clawdis/RelayProcessManager.swift
**Tags:** `core-feature`

macOS app now respects local relay path override from environment variable. Allows developers to point app at local development gateway build instead of bundled version.

## 00942 — settings: clarify pause toggles gateway messaging
**SHA:** 885355ce53 · **Date:** 2025-12-09 17:40
**Files changed:** apps/macos/Sources/Clawdis/SettingsView.swift
**Tags:** `ux`, `documentation`

Updated settings UI text to clarify that pause toggle controls gateway messaging, not just auto-replies. Improved user understanding of pause behavior.

## 00943 — mac: simplify degraded labels
**SHA:** b3d4e5cfdf · **Date:** 2025-12-09 17:45
**Files changed:** apps/macos/Sources/Clawdis/StatusView.swift
**Tags:** `ux`

Simplified status label text for degraded states. Shorter, clearer messages improve status bar readability.

## 00944 — docs: add docs:list helper and front matter
**SHA:** bc3a14cde2 · **Date:** 2025-12-09 17:51
**Files changed:** docs/**, scripts/docs-list.sh
**Tags:** `documentation`

Added script to list all documentation files with front matter metadata. Helps maintain documentation index and navigation. Added standardized front matter to all doc files.

## 00945 — chore: rename relay to gateway
**SHA:** a3bf2bdd8c · **Date:** 2025-12-09 18:00
**Files changed:** AGENTS.md, CHANGELOG.md, README.md, docs/**, src/**
**Tags:** `naming`, `documentation`, `refactor`

Comprehensive rename from "relay" to "gateway" throughout entire codebase. Updated documentation, code comments, variable names, file names, and user-facing text. Affects AGENTS.md, CHANGELOG.md, README.md, and all docs/ files.

## 00946 — fix(ptt): ignore stale recognition callbacks
**SHA:** 0d4bf1c15a · **Date:** 2025-12-09 19:17
**Files changed:** apps/macos/Sources/Clawdis/VoicePushToTalk.swift
**Tags:** `bugfix`

Push-to-talk now ignores recognition results from previous sessions. Prevents stale partial transcripts from appearing after user has released PTT key. Fixed race condition in speech recognition callback handling.

## 00947 — fix: improve app restart and gateway logs
**SHA:** 2adb14c320 · **Date:** 2025-12-09 18:36
**Files changed:** apps/macos/Sources/Clawdis/AppDelegate.swift, src/gateway/server.ts
**Tags:** `bugfix`, `verbosity`

Improved app restart reliability by properly terminating gateway before relaunch. Enhanced gateway startup logging to show configuration and provider status. Better diagnostic output for troubleshooting.

## 00948 — chore: add gateway env/process manager after rename
**SHA:** 55bffeba4a · **Date:** 2025-12-09 19:37
**Files changed:** src/gateway/process.ts, src/gateway/env.ts
**Tags:** `refactor`, `process-lifecycle`

Added process and environment management utilities for gateway after relay-to-gateway rename. Centralized environment variable handling and process lifecycle helpers.

## 00949 — surface: envelope inbound messages for agent
**SHA:** ffc930b871 · **Date:** 2025-12-09 18:43
**Files changed:** README.md, src/auto-reply/envelope.ts, src/auto-reply/envelope.test.ts, src/telegram/bot.test.ts, src/web/auto-reply.ts
**Tags:** `core-feature`, `testing`

Implemented message envelope format for agent context. Every inbound message now prefixed with `[Surface FROM HOST/IP TIMESTAMP]` header. WhatsApp shows phone number, Telegram shows telegram:id, WebChat shows hostname and IP. Provides agent with transport, sender, host, and timing context without relying on implicit state.

## 00950 — fix(mac): restore gateway clear log
**SHA:** 2918e00d33 · **Date:** 2025-12-09 18:44
**Files changed:** apps/macos/Sources/Clawdis/DebugSettings.swift
**Tags:** `bugfix`

Restored "Clear Gateway Log" action in debug menu that was accidentally removed during rename. Users can now clear gateway logs from menu bar again.
