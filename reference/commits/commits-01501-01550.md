# Commit Reference: 01501–01550

A plain factual summary of every commit in the OpenClaw repository, from commit 1501 through commit 1550.

---

## 01501 — fix(macos): clarify OAuth detection
**SHA:** f6cafd1a15 · **Date:** 2025-12-14 19:10
**Files changed:** apps/macos/Sources/Clawdis/AnthropicOAuth.swift, apps/macos/Sources/Clawdis/Onboarding.swift, apps/macos/Tests/ClawdisIPCTests/PiOAuthStoreTests.swift
**Tags:** `bugfix`, `refactor`, `testing`

Introduced a new `AnthropicOAuthStatus` enum to clarify OAuth detection logic and provide detailed status reporting for failed authentication scenarios. Added comprehensive test coverage for various OAuth credential formats and failure modes, including missing files, invalid JSON, and missing tokens.

---

## 01502 — ui(macos): tweak Claude sign-in copy
**SHA:** 6d08d84011 · **Date:** 2025-12-14 19:12
**Files changed:** apps/macos/Sources/Clawdis/Onboarding.swift
**Tags:** `ui`, `documentation`

Updated onboarding copy to simplify Claude sign-in messaging. Changed "Connect Claude" to "Sign in to Claude" and updated the description to be more concise and action-oriented.

---

## 01503 — ui(macos): recommend Opus on Claude step
**SHA:** 4cdd61eb78 · **Date:** 2025-12-14 19:13
**Files changed:** apps/macos/Sources/Clawdis/Onboarding.swift
**Tags:** `ui`, `documentation`

Added a recommended model suggestion on the Claude authentication step, recommending Opus 4.5 for the best experience with the Pi agent runtime.

---

## 01504 — fix(macos): hide skipped onboarding panes
**SHA:** 3d959c46d0 · **Date:** 2025-12-14 19:13
**Files changed:** apps/macos/Sources/Clawdis/Onboarding.swift
**Tags:** `ux`, `refactor`

Refactored onboarding to dynamically render only non-skipped pages using a ForEach loop over `pageOrder`, rather than hardcoding all pages. This allows skipped steps to be completely hidden from the flow.

---

## 01505 — ui(macos): polish onboarding wording
**SHA:** fb237171 02 · **Date:** 2025-12-14 19:22
**Files changed:** apps/macos/Sources/Clawdis/MasterDiscoveryMenu.swift, apps/macos/Sources/Clawdis/Onboarding.swift
**Tags:** `ui`, `documentation`

Comprehensive onboarding copy refinements including terminology updates ("master" to "gateway"), messaging clarity improvements, and UI label polishing throughout the setup flow.

---

## 01506 — ui(macos): remove Claude auth skip button
**SHA:** 7948d071e0 · **Date:** 2025-12-14 19:23
**Files changed:** apps/macos/Sources/Clawdis/Onboarding.swift
**Tags:** `ui`, `ux`

Removed the "Skip for now" button from the Claude OAuth authentication step, making authentication mandatory in the onboarding flow.

---

## 01507 — fix(auto-reply): parse agent_end and avoid rpc JSON leaks
**SHA:** e1e3da946f · **Date:** 2025-12-16 20:35
**Files changed:** src/auto-reply/command-reply.test.ts, src/auto-reply/command-reply.ts
**Tags:** `bugfix`, `testing`

Enhanced agent response parsing to handle `agent_end` message types and extract assistant text from them. Added test coverage for the new parsing logic and prevented JSON leakage in RPC responses.

---

## 01508 — chore(auto-reply): satisfy biome
**SHA:** 2b0f846f1b · **Date:** 2025-12-16 10:41
**Files changed:** src/auto-reply/command-reply.test.ts
**Tags:** `cleanup`

Minor formatting changes to satisfy the Biome code formatter in the auto-reply test suite.

---

## 01509 — fix(macos): lazy-init AVAudioEngine to prevent Bluetooth audio ducking
**SHA:** 5e8c8367f3 · **Date:** 2025-12-16 10:41
**Files changed:** apps/macos/Sources/Clawdis/VoicePushToTalk.swift
**Tags:** `bugfix`, `audio`, `performance`

Changed AVAudioEngine from eager initialization at app launch to lazy initialization on first use, preventing Bluetooth headphones from incorrectly switching into the low-quality headset profile when voice features are unused.

---

## 01510 — docs(changelog): note macOS voice audio fix
**SHA:** b443c20cef · **Date:** 2025-12-14 19:18
**Files changed:** CHANGELOG.md
**Tags:** `documentation`

Updated the CHANGELOG to document the Bluetooth audio ducking fix for macOS Voice Wake and push-to-talk features.

---

## 01511 — fix(macos): use safe FileHandle reads
**SHA:** 64d6d25d65 · **Date:** 2025-12-16 10:41
**Files changed:** apps/macos/Sources/Clawdis/FileHandle+SafeRead.swift
**Tags:** `bugfix`, `refactor`

Introduced safe FileHandle extension methods that use the throwing API instead of legacy APIs that can raise Objective-C exceptions and crash the app when dealing with closed or invalid handles.

---

## 01512 — test(macos): guard FileHandle read APIs
**SHA:** 66a0813e44 · **Date:** 2025-12-16 10:41
**Files changed:** apps/macos/Tests/ClawdisIPCTests/IPCTests.swift
**Tags:** `testing`, `error-handling`

Added test coverage for the safe FileHandle read extension methods to ensure they properly handle edge cases and don't crash on invalid handles.

---

## 01513 — fix(gateway): cap chat.history payload size
**SHA:** 2a5f0d6063 · **Date:** 2025-12-16 19:34
**Files changed:** src/gateway/modules/chat.ts
**Tags:** `bugfix`, `performance`

Implemented payload size limiting for chat history to prevent memory exhaustion from very large chat contexts.

---

## 01514 — fix(gateway): cap chat.history to 1000 messages
**SHA:** d691e28675 · **Date:** 2025-12-16 19:44
**Files changed:** src/gateway/modules/chat.ts
**Tags:** `bugfix`, `performance`

Set a hard limit of 1000 messages in chat history to reduce memory usage and improve performance during long conversations.

---

## 01515 — fix(gateway): clamp chat.history to 1000 max
**SHA:** 74b198 43ae · **Date:** 2025-12-16 19:55
**Files changed:** src/gateway/modules/chat.ts
**Tags:** `bugfix`, `performance`, `cleanup`

Minor refinement to chat history limiting logic for consistency and clarity.

---

## 01516 — fix(chat-ui): improve typing dots and composer
**SHA:** 49a9f74753 · **Date:** 2025-12-17 11:53
**Files changed:** apps/shared/ClawdisKit/Sources/ClawdisChatUI/ChatComposer.swift, apps/shared/ClawdisKit/Sources/ClawdisChatUI/TypingIndicator.swift
**Tags:** `ui`, `bugfix`

Improved the chat composer layout and typing indicator appearance with better frame sizing and alignment adjustments for more responsive UI.

---

## 01517 — fix(chat): reduce system spam and cap history
**SHA:** e1e3da946f · **Date:** 2025-12-16 20:35
**Files changed:** src/gateway/modules/chat.ts
**Tags:** `bugfix`, `performance`

Reduced unnecessary system messages from chat processing and reaffirmed chat history limiting to prevent context bloat.

---

## 01518 — fix(system): inject transitions only
**SHA:** 060a209ecb · **Date:** 2025-12-17 08:31
**Files changed:** src/system/transitions.ts
**Tags:** `bugfix`, `refactor`

Corrected transition injection logic to apply only where needed, eliminating unnecessary transitions from system messages.

---

## 01519 — fix(macos): anchor canvas panel to active screen
**SHA:** 9dcdeb15ec · **Date:** 2025-12-17 09:28
**Files changed:** apps/macos/Sources/Clawdis/CanvasPanel.swift
**Tags:** `bugfix`, `ui`

Fixed canvas panel positioning to anchor to the currently active screen when the window is displayed, ensuring it appears on the user's current display.

---

## 01520 — chore: drop agent-scripts AGENTS pointer
**SHA:** 43e257e7de · **Date:** 2025-12-17 10:08
**Files changed:** apps/macos/Sources/Clawdis/AgentScripts.swift
**Tags:** `cleanup`, `refactor`

Removed a deprecated pointer to the agent-scripts AGENTS configuration as part of codebase cleanup.

---

## 01521 — Canvas: simplify show + report status
**SHA:** c5867b2876 · **Date:** 2025-12-17 10:37
**Files changed:** apps/macos/Sources/Clawdis/CanvasPanel.swift
**Tags:** `refactor`, `ui`

Simplified canvas show logic and improved status reporting for canvas panel visibility and interactions.

---

## 01522 — feat: embed pi agent runtime
**SHA:** fece42ce0a · **Date:** 2025-12-17 11:29
**Files changed:** src/agent/pi-runtime.ts, package.json
**Tags:** `core-feature`, `dependency`

Embedded the Pi agent runtime directly into Clawdis, allowing agents to run without external dependencies and providing better integration with the gateway.

---

## 01523 — docs: document embedded agent runtime
**SHA:** 1cdebb68a0 · **Date:** 2025-12-17 11:29
**Files changed:** docs/EMBEDDED_AGENT.md, README.md
**Tags:** `documentation`, `core-feature`

Added comprehensive documentation for the embedded Pi agent runtime, including setup instructions and configuration options.

---

## 01524 — feat(macos): add Canvas A2UI renderer
**SHA:** cdb5ddb2da · **Date:** 2025-12-17 11:35
**Files changed:** apps/macos/Sources/Clawdis/CanvasA2UIRenderer.swift, apps/macos/Sources/Clawdis/CanvasPanel.swift
**Tags:** `core-feature`, `ui`

Implemented A2UI (Agent-to-UI) rendering support in the Canvas panel, allowing agents to build and interact with rich UI components directly.

---

## 01525 — macOS: update config settings copy
**SHA:** cf127829 5d · **Date:** 2025-12-17 11:36
**Files changed:** apps/macos/Sources/Clawdis/SettingsView.swift
**Tags:** `ui`, `documentation`

Updated configuration settings UI copy for clarity and improved user understanding of available options.

---

## 01526 — fix(macos): avoid treating '/' as file target
**SHA:** 6653813cb9 · **Date:** 2025-12-17 11:36
**Files changed:** apps/macos/Sources/Clawdis/FileTargetHandler.swift
**Tags:** `bugfix`

Fixed a bug where the root path '/' was being incorrectly treated as a file target, preventing proper file handling logic.

---

## 01527 — chore: bump Peekaboo submodule
**SHA:** be9b550209 · **Date:** 2025-12-17 11:37
**Files changed:** .gitmodules, Peekaboo
**Tags:** `dependency`, `build`

Updated the Peekaboo submodule to the latest version for improved accessibility and screen reading capabilities.

---

## 01528 — feat(macos): add menu Canvas open/close
**SHA:** 81a9439eb2 · **Date:** 2025-12-17 11:53
**Files changed:** apps/macos/Sources/Clawdis/MenuPanel.swift, apps/macos/Sources/Clawdis/CanvasPanel.swift
**Tags:** `core-feature`, `ui`

Added menu bar controls to toggle canvas panel visibility, making it easy for users to show and hide the canvas from the menu bar.

---

## 01529 — Canvas: fix A2UI v0.8 rendering
**SHA:** 9eaa45a291 · **Date:** 2025-12-17 13:20
**Files changed:** apps/macos/Sources/Clawdis/CanvasA2UIRenderer.swift
**Tags:** `bugfix`, `ui`

Fixed A2UI rendering for version 0.8 compatibility, ensuring canvas agents can properly display UI components.

---

## 01530 — Build: add wireit
**SHA:** c4da2afb22 · **Date:** 2025-12-17 13:20
**Files changed:** package.json, wireit.json
**Tags:** `build`, `devops`

Integrated Wireit for efficient task orchestration in the build system, improving build performance through caching and parallelization.

---

## 01531 — iOS: allow unicast DNS-SD discovery domain
**SHA:** 316a04f606 · **Date:** 2025-12-17 14:14
**Files changed:** apps/ios/Clawdis/NetworkDiscovery.swift
**Tags:** `core-feature`, `networking`

Extended iOS discovery to support unicast DNS-SD queries in addition to multicast, enabling discovery over wide-area networks and through firewalls.

---

## 01532 — Docs: secure wide-area Bonjour over Tailscale
**SHA:** c7c32210e6 · **Date:** 2025-12-17 14:27
**Files changed:** docs/NETWORKING.md, docs/SECURITY.md
**Tags:** `documentation`, `security`, `networking`

Added documentation for securing wide-area Bonjour/DNS-SD discovery over Tailscale, explaining the security model and configuration.

---

## 01533 — Canvas: fix A2UI push rendering
**SHA:** fdca8fb592 · **Date:** 2025-12-17 14:36
**Files changed:** apps/macos/Sources/Clawdis/CanvasA2UIRenderer.swift
**Tags:** `bugfix`, `ui`

Fixed A2UI push transition rendering in the canvas to properly animate component state changes.

---

## 01534 — Canvas: add vibrancy close pill
**SHA:** 4482965d80 · **Date:** 2025-12-17 14:50
**Files changed:** apps/macos/Sources/Clawdis/CanvasPanel.swift
**Tags:** `ui`

Added a vibrancy effect to the canvas close button for better visual consistency with macOS system UI patterns.

---

## 01535 — Canvas: shrink close button
**SHA:** 691bf85d7e · **Date:** 2025-12-17 14:52
**Files changed:** apps/macos/Sources/Clawdis/CanvasPanel.swift
**Tags:** `ui`

Reduced the size of the canvas close button for a more refined and compact appearance.

---

## 01536 — Android: add unicast discovery domain + app icon
**SHA:** 036bdde764 · **Date:** 2025-12-17 15:29
**Files changed:** apps/android/app/src/main/kotlin/Discovery.kt, apps/android/app/src/main/res/mipmap-*
**Tags:** `core-feature`, `networking`, `ui`

Extended Android app to support unicast DNS-SD discovery and added proper app icon resources for various screen densities.

---

## 01537 — Android: fix unicast discovery address resolution
**SHA:** f5ab3e41c5 · **Date:** 2025-12-17 15:32
**Files changed:** apps/android/app/src/main/kotlin/Discovery.kt
**Tags:** `bugfix`, `networking`

Fixed DNS address resolution logic in Android discovery to properly handle unicast queries and resolve addresses in wide-area scenarios.

---

## 01538 — Canvas: forward A2UI actions
**SHA:** 5e5cb7a292 · **Date:** 2025-12-17 15:41
**Files changed:** apps/macos/Sources/Clawdis/CanvasA2UIRenderer.swift
**Tags:** `core-feature`, `ui`

Implemented action forwarding from A2UI components back to agents, allowing interactive components in canvas to trigger agent behavior.

---

## 01539 — macOS: fold AgentRPC into GatewayConnection
**SHA:** 6fdc62c008 · **Date:** 2025-12-17 16:07
**Files changed:** apps/macos/Sources/Clawdis/GatewayConnection.swift, apps/macos/Sources/Clawdis/AgentRPC.swift
**Tags:** `refactor`

Consolidated agent RPC communication logic into the GatewayConnection class, reducing code duplication and simplifying the connection management architecture.

---

## 01540 — GatewayConnection: validate agent message
**SHA:** a1940418fb · **Date:** 2025-12-17 16:09
**Files changed:** apps/macos/Sources/Clawdis/GatewayConnection.swift
**Tags:** `bugfix`, `error-handling`

Added validation of agent messages in the gateway connection to ensure message integrity and prevent malformed data from causing crashes.

---

## 01541 — Gateway: wide-area Bonjour via clawdis.internal
**SHA:** e9ae10e569 · **Date:** 2025-12-17 17:01
**Files changed:** src/gateway/dns.ts, src/gateway/modules/discovery.ts
**Tags:** `core-feature`, `networking`

Implemented wide-area Bonjour discovery through a dedicated `clawdis.internal` DNS domain, enabling automatic discovery of Clawdis instances across networks without manual configuration.

---

## 01542 — Nodes: auto-discover clawdis.internal
**SHA:** 2ce24fdbf8 · **Date:** 2025-12-17 17:01
**Files changed:** src/nodes/discovery.ts
**Tags:** `core-feature`, `networking`

Extended node discovery to automatically find and connect to Clawdis instances via the `clawdis.internal` domain, simplifying multi-node setup.

---

## 01543 — CLI: dns setup supports sudo-owned CoreDNS config
**SHA:** 2eb27ffb4a · **Date:** 2025-12-17 17:15
**Files changed:** src/cli/dns-setup.ts
**Tags:** `core-feature`, `devops`

Enhanced DNS setup CLI to work with CoreDNS configuration files owned by sudo, allowing proper DNS zone setup in containerized and restricted environments.

---

## 01544 — CLI: make dns setup create valid zone
**SHA:** 514759bde7 · **Date:** 2025-12-17 17:25
**Files changed:** src/cli/dns-setup.ts
**Tags:** `bugfix`, `devops`

Fixed DNS zone creation in the setup CLI to generate valid zone files that properly resolve the `clawdis.internal` domain.

---

## 01545 — iOS: satisfy SwiftFormat in bridge discovery
**SHA:** 0a32610b37 · **Date:** 2025-12-17 18:01
**Files changed:** apps/ios/Clawdis/BridgeDiscovery.swift
**Tags:** `cleanup`

Applied SwiftFormat rules to iOS bridge discovery code for consistent code style.

---

## 01546 — CLI: bootstrap invalid wide-area DNS zone
**SHA:** 6148f862b9 · **Date:** 2025-12-17 18:02
**Files changed:** src/cli/bootstrap.ts
**Tags:** `bugfix`, `devops`

Fixed bootstrap CLI to properly initialize invalid wide-area DNS zones, ensuring proper setup when starting a new Clawdis network.

---

## 01547 — chore(peekaboo): bump submodule
**SHA:** 28d3bd03b2 · **Date:** 2025-12-17 15:28
**Files changed:** .gitmodules, Peekaboo
**Tags:** `dependency`

Updated Peekaboo submodule to latest version for accessibility improvements.

---

## 01548 — fix(pi): harden image read mime
**SHA:** 42948b70e3 · **Date:** 2025-12-17 15:29
**Files changed:** src/agent/image-handler.ts
**Tags:** `bugfix`, `error-handling`

Improved MIME type detection for image reading in the agent runtime to handle edge cases and invalid image data more robustly.

---

## 01549 — chore(pi): add TODO for mime workaround
**SHA:** 84d5f24f5f · **Date:** 2025-12-17 15:49
**Files changed:** src/agent/image-handler.ts
**Tags:** `documentation`, `cleanup`

Added a TODO comment documenting a known MIME type handling workaround for future refactoring.

---

## 01550 — fix(macos): sync node pairing approvals
**SHA:** db7eeee07b · **Date:** 2025-12-17 19:04
**Files changed:** apps/macos/Sources/Clawdis/NodePairing.swift
**Tags:** `bugfix`, `core-feature`

Fixed node pairing approval synchronization to ensure that pairing decisions are properly synced across multiple Clawdis instances on the same network.

---
