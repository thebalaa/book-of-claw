# Commit Reference: 00751–00800

A plain factual summary of every commit in the OpenClaw repository, from commit 751 through commit 800.

---

## 00751 — fix(mac): run remote health with pnpm under zsh
**SHA:** df96318662 · **Date:** 2025-12-08 16:52
**Files changed:** apps/macos/Sources/Clawdis/Utilities.swift
**Tags:** `bugfix`, `refactor`

Restructured the remote CLI resolution script in Swift to properly execute clawdis health commands over SSH. Changed from a CLI variable approach to a direct if-then-else block that handles the `pnpm --silent clawdis` fallback case properly when neither the global clawdis binary nor the local project bin is available.

---

## 00752 — chore: use 2s silence or 5s max capture
**SHA:** 148c9533ae · **Date:** 2025-12-08 16:55
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift
**Tags:** `core-feature`, `ux`

Adjusted voice capture timing parameters in VoiceWakeRuntime. Changed silenceWindow from 1.0 to 2.0 seconds and reduced captureHardStop from 8.0 to 5.0 seconds to provide faster response while maintaining sufficient silence detection.

---

## 00753 — chore: extend voice capture hard stop to 120s
**SHA:** 7b1832bd24 · **Date:** 2025-12-08 16:58
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift
**Tags:** `core-feature`, `ux`

Extended the maximum voice capture duration (captureHardStop) from 5.0 seconds to 120.0 seconds to avoid force-sending during longer user inputs. Added inline documentation explaining this is a safety limit to prevent runaway recording sessions.

---

## 00754 — chore: fix lint warnings and formatting
**SHA:** c3f955d3f1 · **Date:** 2025-12-08 17:05
**Files changed:** apps/macos/Sources/Clawdis/Utilities.swift, src/auto-reply/status.ts, src/cli/program.test.ts, src/cli/program.ts, src/webchat/server.ts
**Tags:** `linting`, `refactor`

Applied formatting fixes across Swift and TypeScript files. Standardized import ordering, fixed line wrapping for long parameter lists, removed redundant code, strengthened type annotations in webchat server (ChatMessage, AttachmentInput, RpcPayload), and cleaned up conditional logic.

---

## 00755 — chore: use 5s silence before speech, 2s after
**SHA:** 0f0a2dddfe · **Date:** 2025-12-08 17:06
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift
**Tags:** `core-feature`, `ux`

Introduced a two-tier silence window in VoiceWakeRuntime. Added triggerOnlySilenceWindow (5.0s) to apply when only the wake word is detected, while silenceWindow (2.0s) applies once the user has spoken beyond the trigger. This prevents premature sends when the user pauses after saying the wake word.

---

## 00756 — Webchat: sync thinking level with session
**SHA:** dc3c82ad40 · **Date:** 2025-12-08 16:09
**Files changed:** apps/macos/Sources/Clawdis/Resources/WebChat/ChatPanel.js, apps/macos/Sources/Clawdis/Resources/WebChat/agent/agent.js, apps/macos/Sources/Clawdis/Resources/WebChat/bootstrap.js, apps/macos/Sources/Clawdis/Resources/WebChat/components/AgentInterface.js, apps/macos/Sources/Clawdis/Resources/WebChat/webchat.bundle.js, docs/thinking.md, src/commands/agent.ts, src/webchat/server.ts
**Tags:** `core-feature`, `auto-reply`, `documentation`

Implemented thinkingOnce flag allowing webchat to override thinking level for a single message. The thinking selector now mirrors the session's persisted level and any change applies only to the next message, then reverts. Server reads persisted thinkingLevel from session store and returns it in bootstrap info. Added thinkingOnce parameter to agent command and RPC handler.

---

## 00757 — Agent: add thinkingOnce flag
**SHA:** 1ac6ab4428 · **Date:** 2025-12-08 16:12
**Files changed:** src/commands/agent.ts
**Tags:** `core-feature`, `auto-reply`

Added thinkingOnce command-line option to agent.ts allowing one-shot thinking level override that takes precedence over thinkOverride and persisted thinking. The resolution order is now: thinkOnce > thinkOverride > persisted > defaults.

---

## 00758 — Webchat: poll session for messages/thinking
**SHA:** 7a7c59e91a · **Date:** 2025-12-08 16:14
**Files changed:** apps/macos/Sources/Clawdis/Resources/WebChat/bootstrap.js, apps/macos/Sources/Clawdis/Resources/WebChat/webchat.bundle.js
**Tags:** `core-feature`, `ux`

Added a 3-second polling loop to webchat that fetches session info and syncs messages and thinking level in real time. The polling skips while streaming is active and compares timestamps to avoid duplicate updates. When thinking level changes externally, the UI updates accordingly.

---

## 00759 — fix: resize overlay on text updates and keep final tint
**SHA:** 838a9c000c · **Date:** 2025-12-08 17:07
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `bugfix`, `ux`

Fixed voice overlay window to dynamically resize when the attributed text changes. Added invalidateIntrinsicContentSize call before computing the fittingSize and made updateWindowFrame public so it can be called from the view's onChange handler. Removed maxHeight constraint from the editor frame.

---

## 00760 — chore: tighten webchat types and formatting
**SHA:** 636f2d659f · **Date:** 2025-12-08 17:09
**Files changed:** src/webchat/server.ts
**Tags:** `type-safety`, `linting`, `refactor`

Strengthened TypeScript types in webchat server by defining ChatMessage, AttachmentInput, and RpcPayload types and using them consistently. Added type guards in handleRpc for payload validation. Cleaned up formatting and removed redundant comments while preserving semantic behavior.

---

## 00761 — fix(mac): harden remote webchat tunnel and keep it alive
**SHA:** 466236e32f · **Date:** 2025-12-08 17:10
**Files changed:** apps/macos/Sources/Clawdis/AppState.swift
**Tags:** `bugfix`, `process-lifecycle`

Hardened the remote webchat SSH tunnel in the macOS app to maintain persistent connectivity. Implementation details suggest improved error handling and reconnection logic for the tunnel that forwards the webchat port over SSH.

---

## 00762 — fix: restart webchat tunnel on main actor
**SHA:** 421924b73f · **Date:** 2025-12-08 17:12
**Files changed:** apps/macos/Sources/Clawdis/AppState.swift
**Tags:** `bugfix`, `process-lifecycle`

Fixed concurrency issue by ensuring webchat tunnel restart operations run on the main actor. This prevents threading issues when the tunnel fails and needs to be re-established.

---

## 00763 — Webchat: push updates over WebSocket
**SHA:** 7144a0fb9b · **Date:** 2025-12-08 16:19
**Files changed:** apps/macos/Sources/Clawdis/Resources/WebChat/bootstrap.js, apps/macos/Sources/Clawdis/Resources/WebChat/webchat.bundle.js
**Tags:** `core-feature`, `ux`

Infrastructure for WebSocket-based push updates in webchat. Sets the stage for real-time message and state synchronization instead of relying solely on polling.

---

## 00764 — Webchat: clean server build and add ws types
**SHA:** a34ab1d36e · **Date:** 2025-12-08 16:21
**Files changed:** apps/macos/Sources/Clawdis/Resources/WebChat/webchat.bundle.js
**Tags:** `type-safety`, `refactor`

Cleaned up the webchat server build output and added WebSocket type definitions to support the push-based update architecture introduced in the previous commit.

---

## 00765 — feat(mac): add push-to-talk hotkey
**SHA:** 0317eec10d · **Date:** 2025-12-08 17:23
**Files changed:** apps/macos/Sources/Clawdis/AppState.swift, apps/macos/Sources/Clawdis/Constants.swift, apps/macos/Sources/Clawdis/MenuBar.swift, apps/macos/Sources/Clawdis/VoicePushToTalk.swift, apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift, apps/macos/Sources/Clawdis/VoiceWakeSettings.swift, apps/macos/Tests/ClawdisIPCTests/VoicePushToTalkTests.swift
**Tags:** `core-feature`, `ux`, `testing`

Implemented Cmd+Fn push-to-talk hotkey for macOS. Created VoicePushToTalkHotkey class that monitors global flag-changed events and triggers VoicePushToTalk actor which handles short-lived speech recognition while the chord is held. The feature pauses the wake-word runtime, shows the voice overlay with partial/final transcripts, and supports the same forwarding configuration as wake-word mode. Added unit tests for delta computation and attributed string coloring.

---

## 00766 — docs: document push-to-talk hotkey
**SHA:** 5dec7d534f · **Date:** 2025-12-08 17:23
**Files changed:** docs/mac/voicewake.md
**Tags:** `documentation`

Updated macOS voice wake documentation to describe the new Cmd+Fn push-to-talk feature. Explains that it uses the same forwarding payload structure as wake-word mode and is disabled on macOS versions below 26.

---

## 00767 — fix(mac): surface webchat load failures and preflight reachability
**SHA:** 9625d94aa0 · **Date:** 2025-12-08 17:24
**Files changed:** apps/macos/Sources/Clawdis/AppState.swift
**Tags:** `bugfix`, `ux`

Improved error handling for webchat by surfacing load failures to the user and adding preflight reachability checks before attempting to establish the webchat connection.

---

## 00768 — fix: polish voice overlay and webchat lint
**SHA:** db3b3ed9eb · **Date:** 2025-12-08 17:32
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift, src/webchat/server.ts
**Tags:** `bugfix`, `linting`, `ux`

Polished voice overlay presentation and fixed linting issues in webchat server. Cleaned up visual presentation details and code formatting inconsistencies.

---

## 00769 — docs/macos: simplify sag install (auto-tap)
**SHA:** 2f21dd81b0 · **Date:** 2025-12-08 18:19
**Files changed:** docs/mac/README.md (inferred)
**Tags:** `documentation`

Simplified macOS installation documentation for sag (screen annotation GUI) by noting that brew tap happens automatically, making the installation steps clearer.

---

## 00770 — fix: keep overlay attributed colors and auto-resize
**SHA:** cf3b7f2c16 · **Date:** 2025-12-08 18:28
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `bugfix`, `ux`

Ensured that the voice overlay preserves attributed text colors (committed vs. volatile transcript) and automatically resizes the window as text content changes. Combined multiple resize and color handling fixes.

---

## 00771 — tweak: allow overlay to grow to 400px then scroll
**SHA:** a19d4c19d3 · **Date:** 2025-12-08 18:33
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Adjusted overlay sizing to allow growth up to 400px height before enabling scrolling. Prevents the overlay from becoming too tall while still accommodating longer transcripts.

---

## 00772 — perf(mac): move blocking launchctl/webchat work off main
**SHA:** 73211c900b · **Date:** 2025-12-08 18:42
**Files changed:** apps/macos/Sources/Clawdis/AppState.swift
**Tags:** `optimization`, `refactor`

Moved blocking launchctl and webchat initialization work off the main thread to improve UI responsiveness. Operations that involve external process spawning or network setup now run on background queues.

---

## 00773 — fix: hide overlay scrollbar unless content overflows
**SHA:** 86d9e1e816 · **Date:** 2025-12-08 18:50
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `bugfix`, `ux`

Configured the overlay scrollbar to only appear when content actually overflows the visible area, preventing unnecessary UI clutter for short transcripts.

---

## 00774 — tweak: centralize overlay max/min heights
**SHA:** 93aeee1611 · **Date:** 2025-12-08 18:52
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `refactor`, `ux`

Centralized the overlay height calculation logic by defining clear max and min height constants and using them consistently throughout the targetFrame computation.

---

## 00775 — tweak: strengthen partial transcript tint
**SHA:** 7c0f0a59eb · **Date:** 2025-12-08 18:54
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Increased the color contrast for partial transcript text to make it more visually distinguishable from committed transcript text in the voice overlay.

---

## 00776 — chore: launch app in restart script instead of launch agent
**SHA:** 4fd7480557 · **Date:** 2025-12-08 19:01
**Files changed:** apps/macos/restart-clawdis.sh (inferred)
**Tags:** `process-lifecycle`, `refactor`

Changed the app restart mechanism to use the restart script directly instead of relying on the launch agent, simplifying the restart flow.

---

## 00777 — ux: show vibrant label until edit, then switch to text view
**SHA:** 768d550ee2 · **Date:** 2025-12-08 19:11
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Modified overlay UI to display a vibrant label for the initial transcript display and switch to an editable text view only when the user enters edit mode.

---

## 00778 — ux: brighten display label and wrap properly
**SHA:** 7cb31581d5 · **Date:** 2025-12-08 19:15
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Increased the display label brightness for better readability and ensured text wraps correctly within the overlay bounds.

---

## 00779 — ui: drop translucency for overlay background
**SHA:** 1d385fd35a · **Date:** 2025-12-08 19:20
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Removed translucent background from the voice overlay, switching to an opaque background for improved text contrast and readability.

---

## 00780 — ux: keep vibrancy, brighten label, ensure wrapping
**SHA:** 421d6db592 · **Date:** 2025-12-08 19:36
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Restored vibrancy effect to the overlay while maintaining the improved label brightness and text wrapping from previous commits.

---

## 00781 — ux: wrap label to overlay width, remove label background
**SHA:** f7430d74a7 · **Date:** 2025-12-08 19:43
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Configured the label to wrap at the overlay's width boundary and removed the separate label background to integrate better with the vibrant container.

---

## 00782 — ux: use primary text color in display label
**SHA:** 2c610258d1 · **Date:** 2025-12-08 19:57
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Changed the display label to use the system's primary text color for consistency with macOS design guidelines.

---

## 00783 — ui: strip label color attributes so text uses primary color
**SHA:** 66a8780fa2 · **Date:** 2025-12-08 20:00
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`, `bugfix`

Removed color attributes from the label's attributed string to ensure the text always renders in the primary color regardless of the source attributes.

---

## 00784 — ux: top-align overlay content
**SHA:** fbbf0ed41c · **Date:** 2025-12-08 20:10
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Changed overlay content alignment to top-aligned for more natural reading flow and visual consistency.

---

## 00785 — VoiceWake: keep empty trigger rows
**SHA:** 34f892ae82 · **Date:** 2025-12-08 20:13
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeSettings.swift
**Tags:** `ux`, `bugfix`

Modified the trigger word table in settings to preserve empty rows instead of filtering them out, allowing users to see placeholder entries and add new triggers more easily.

---

## 00786 — HeartbeatStore: fix main-actor cleanup
**SHA:** e3089d60ea · **Date:** 2025-12-08 20:17
**Files changed:** apps/macos/Sources/Clawdis/HeartbeatStore.swift (inferred)
**Tags:** `bugfix`, `process-lifecycle`

Fixed concurrency issue in HeartbeatStore by ensuring cleanup operations run on the main actor, preventing potential threading violations.

---

## 00787 — RPC: stream heartbeat events to menu
**SHA:** ab448988ff · **Date:** 2025-12-08 20:18
**Files changed:** apps/macos/Sources/Clawdis/RPC.swift (inferred)
**Tags:** `core-feature`, `ux`

Implemented RPC mechanism to stream heartbeat events from the relay to the macOS menu bar, enabling real-time heartbeat status updates in the UI.

---

## 00788 — VoiceWake: sanitize triggers only when applying
**SHA:** cfdcabc8b4 · **Date:** 2025-12-08 20:20
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeSettings.swift, apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift (inferred)
**Tags:** `refactor`, `ux`

Moved trigger word sanitization logic to the point where triggers are applied to the runtime instead of on every UI update. This preserves the user's raw input in the settings UI while ensuring the runtime only receives clean trigger words.

---

## 00789 — ux: keep window in edit, add escape to cancel; fix lint drift
**SHA:** ded106b9e3 · **Date:** 2025-12-08 20:22
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`, `linting`, `bugfix`

Enhanced voice overlay edit mode to keep the window open while editing and added Escape key support to cancel editing. Fixed linting issues that had accumulated.

---

## 00790 — VoiceWake: add chimes for trigger and send
**SHA:** feb70aeb6b · **Date:** 2025-12-08 20:45
**Files changed:** apps/macos/Package.swift, apps/macos/Sources/Clawdis/AppState.swift, apps/macos/Sources/Clawdis/Constants.swift, apps/macos/Sources/Clawdis/Resources/Sounds/startrek-computer.wav, apps/macos/Sources/Clawdis/VoicePushToTalk.swift, apps/macos/Sources/Clawdis/VoiceWakeChime.swift, apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift, apps/macos/Sources/Clawdis/VoiceWakeSettings.swift, docs/mac/voicewake.md
**Tags:** `core-feature`, `ux`, `documentation`

Implemented audio chime system for voice wake events. Created VoiceWakeChime enum supporting both system sounds and custom user-provided audio files. Added VoiceWakeChimePlayer that plays chimes on trigger detection and send events. Bundled startrek-computer.wav as the default sound. Added UI in settings to enable/disable chimes, select sounds from a catalog (Ping, Pop, Glass, Frog, Submarine, Funk, Tink), or choose custom audio files. Chimes are played in both wake-word and push-to-talk modes.

---

## 00791 — VoiceWake: streamline chimes, default to Glass
**SHA:** ffaf968940 · **Date:** 2025-12-08 20:50
**Files changed:** apps/macos/Sources/Clawdis/Constants.swift (inferred)
**Tags:** `ux`, `refactor`

Changed the default chime from startrek-computer to Glass for a less intrusive sound profile. Streamlined chime initialization logic.

---

## 00792 — VoiceWake: skip send chime when nothing to send
**SHA:** ec046411f1 · **Date:** 2025-12-08 20:57
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift, apps/macos/Sources/Clawdis/VoicePushToTalk.swift (inferred)
**Tags:** `ux`, `bugfix`

Added logic to skip playing the send chime when the final transcript is empty, avoiding audio feedback for no-op sends.

---

## 00793 — ux: add hover/ edit close button and keep overlay until escape or send
**SHA:** 7a82777fc5 · **Date:** 2025-12-08 21:22
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Added a close button to the overlay that appears on hover and edit mode. Modified overlay lifecycle to persist until the user explicitly escapes or sends the transcript instead of auto-dismissing.

---

## 00794 — VoiceWake: centralize send chime and guard play
**SHA:** bb3606b64f · **Date:** 2025-12-08 21:25
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift, apps/macos/Sources/Clawdis/VoicePushToTalk.swift (inferred)
**Tags:** `refactor`, `bugfix`

Centralized send chime playback logic to avoid duplication between wake-word and push-to-talk paths. Added guards to ensure chimes only play when enabled and when there's actual content to send.

---

## 00795 — docs: add control channel reference
**SHA:** 71e58c768c · **Date:** 2025-12-08 21:50
**Files changed:** docs/control-api.md, docs/remote.md
**Tags:** `documentation`, `core-feature`

Added comprehensive documentation for the new control channel API. The control-api.md document describes the newline-delimited JSON protocol running on localhost:18789, covering request/response/event frame formats, available methods (ping, health, status, last-heartbeat, set-heartbeats), and heartbeat event payloads. The remote.md document explains the remote-over-SSH topology where macOS clients tunnel to a master relay's control port.

---

## 00796 — relay: add control channel and heartbeat stream
**SHA:** 22996854f7 · **Date:** 2025-12-08 21:50
**Files changed:** src/cli/program.ts, src/commands/health.ts, src/commands/status.ts, src/infra/control-channel.ts, src/infra/heartbeat-events.ts, src/process/heartbeat-events.ts, src/web/auto-reply.ts
**Tags:** `core-feature`, `refactor`, `process-lifecycle`

Implemented the control channel server for the relay. Created src/infra/control-channel.ts that starts a TCP server on 127.0.0.1:18789 serving newline-delimited JSON for RPC-style requests (ping, health, status, last-heartbeat, set-heartbeats) and streaming events (heartbeat, relay-status, log). Replaced file-based heartbeat-events.ts with in-memory event bus in heartbeat-events.ts using listeners and emitters. Refactored health and status commands to export summary functions (getHealthSnapshot, getStatusSummary) that the control channel can call. The relay command now starts the control server alongside web and Telegram monitors.

---

## 00797 — macos: use control channel for health and heartbeat
**SHA:** 293b4960f3 · **Date:** 2025-12-08 21:50
**Files changed:** apps/macos/Sources/Clawdis/AppState.swift (inferred)
**Tags:** `core-feature`, `refactor`

Updated the macOS menu bar app to use the control channel instead of shelling out to CLI commands for health checks and heartbeat monitoring. The app now connects to the control channel via TCP (either locally or over SSH tunnel) and issues RPC requests.

---

## 00798 — chore: sync webchat bundle and voice wake settings
**SHA:** 11400e43dc · **Date:** 2025-12-08 21:51
**Files changed:** apps/macos/Sources/Clawdis/Resources/WebChat/webchat.bundle.js (inferred)
**Tags:** `refactor`

Synchronized the compiled webchat bundle with recent changes and aligned voice wake settings across components.

---

## 00799 — ux: float close button outside bubble and reduce hover flicker
**SHA:** 12e048a7fb · **Date:** 2025-12-08 21:59
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`, `bugfix`

Repositioned the close button to float outside the overlay bubble instead of inside it, reducing visual clutter and fixing hover flicker issues that occurred when the button overlapped with interactive elements.

---

## 00800 — fix: avoid auto-send task init error
**SHA:** 9c54e48194 · **Date:** 2025-12-08 22:02
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift (inferred)
**Tags:** `bugfix`, `auto-reply`

Fixed an initialization error in the auto-send task that could occur when the overlay was dismissed before the task completed. Added proper task cleanup and cancellation handling.

---
