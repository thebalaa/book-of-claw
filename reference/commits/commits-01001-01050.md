# Commit Reference: 01001–01050

A plain factual summary of every commit in the OpenClaw repository, from commit 1001 through commit 1050.

---

## 01001 — chore: bump pi deps for tau rpc
**SHA:** 50c33dfcdf · **Date:** 2025-12-09 21:52
**Files changed:** package.json, src/process/tau-rpc.ts
**Tags:** `dependency`, `refactor`

Updated @mariozechner/pi-ai and @mariozechner/pi-coding-agent from 0.16.0 to 0.17.0. Modified tau-rpc.ts to handle response failures and accept raw string prompts instead of structured message objects, with improved error handling for failed prompt responses.

---

## 01002 — mac: clear status highlight via menu delegate
**SHA:** d08ca9585a · **Date:** 2025-12-09 23:01
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `ui`, `refactor`

Added StatusMenuDelegate to manage menu presentation state and clear the status item highlight when the menu closes. This centralizes menu state management and improves UI responsiveness.

---

## 01003 — fix(macos): harden presence decode
**SHA:** 052d8ba879 · **Date:** 2025-12-09 22:08
**Files changed:** apps/macos/Sources/Clawdis/InstancesStore.swift
**Tags:** `bugfix`, `error-handling`

Refactored presence event decoding to use a dedicated PresenceEventPayload struct and improved type safety. Changed from manual JSON manipulation to proper Codable decoding with proper error handling.

---

## 01004 — mac: revert webchat menu fallback
**SHA:** e80e5b0801 · **Date:** 2025-12-09 23:15
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `ui`, `refactor`

Reverted changes related to webchat menu fallback behavior to simplify the menu handling logic.

---

## 01005 — feat: add ws chat attachments
**SHA:** 1dd5c97ae0 · **Date:** 2025-12-09 23:16
**Files changed:** src/ws-server.ts, src/commands/chat.ts
**Tags:** `core-feature`, `api`

Added support for file attachments in WebSocket chat messages. Extended the chat protocol to handle attachment data and integrated attachment processing into the messaging pipeline.

---

## 01006 — mac: tie highlight to panel visibility
**SHA:** 6d91dad8e4 · **Date:** 2025-12-09 23:20
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `ui`, `refactor`

Linked the status item highlight state directly to the web chat panel visibility state, ensuring the highlight accurately reflects whether the panel is open or closed.

---

## 01007 — mac: close panel on second click
**SHA:** d5347176e1 · **Date:** 2025-12-09 23:25
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `ui`, `refactor`

Modified panel toggle behavior so that clicking the status item while the panel is already visible will close the panel instead of keeping it open.

---

## 01008 — test: cover chat attachments
**SHA:** 78d41b8e41 · **Date:** 2025-12-09 23:31
**Files changed:** test/commands/chat.test.ts
**Tags:** `testing`

Added test coverage for the new WebSocket chat attachments feature, ensuring attachments are properly processed and validated.

---

## 01009 — mac: ensure panel toggle doesn't reopen
**SHA:** 0c4e67a951 · **Date:** 2025-12-09 23:32
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `ui`, `bugfix`

Fixed an issue where clicking the status item would immediately reopen the panel after closing it. Added proper state management to prevent unwanted toggles.

---

## 01010 — Add package manager selector and hide uninstalled tools
**SHA:** 2a95a5bf8a · **Date:** 2025-12-09 22:31
**Files changed:** apps/macos/Sources/Clawdis/ToolsSettings.swift
**Tags:** `ui`, `core-feature`

Added NodePackageManager enum to allow users to select between npm, pnpm, and yarn. Refactored InstallMethod to use a generic .node case and dynamically filter tools based on installation status. Updated tool list to reflect current package manager selection.

---

## 01011 — mac: toggle panel purely from visibility
**SHA:** e58d5a54b1 · **Date:** 2025-12-09 23:36
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `ui`, `refactor`

Simplified panel toggle logic to use only the visibility state property, removing dependency on separate toggle flags for clearer state management.

---

## 01012 — gateway: cache health snapshot
**SHA:** dd883454831 · **Date:** 2025-12-09 23:38
**Files changed:** src/gateway/server.ts
**Tags:** `performance`, `refactor`

Added health snapshot caching to the gateway server with configurable refresh intervals. The gateway now broadcasts health status events to connected clients and manages health state more efficiently.

---

## 01013 — fix(webchat): load root path
**SHA:** 14d3a624d8 · **Date:** 2025-12-09 23:40
**Files changed:** src/webchat/server.ts
**Tags:** `bugfix`, `api`

Fixed root path loading in the webchat server to correctly serve root assets when accessed at the base URL.

---

## 01014 — mac: open latest log file
**SHA:** b73a7e07d2 · **Date:** 2025-12-09 23:45
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `ui`, `debugging`

Added functionality to open the most recently created log file from the macOS application logs directory with a menu action.

---

## 01015 — fix(mac): keep overlay on token mismatch
**SHA:** 2116f19106 · **Date:** 2025-12-10 00:47
**Files changed:** apps/macos/Sources/Clawdis/ControlChannel.swift
**Tags:** `bugfix`, `ui`

Fixed an issue where the WebSocket overlay would disappear on token mismatch. Now the overlay remains visible to show the error message to the user.

---

## 01016 — mac: add port diagnostics for gateway
**SHA:** f6ade5dc84 · **Date:** 2025-12-10 00:49
**Files changed:** apps/macos/Sources/Clawdis/GatewayProcessManager.swift, apps/macos/Sources/Clawdis/PortGuardian.swift
**Tags:** `core-feature`, `debugging`

Introduced PortGuardian actor to track and manage gateway processes by port. Records process IDs, commands, and connection mode to diagnose port conflicts and stale processes.

---

## 01017 — fix(webchat): serve root assets correctly
**SHA:** 1a17de9d39 · **Date:** 2025-12-09 23:50
**Files changed:** src/webchat/server.ts
**Tags:** `bugfix`, `api`

Fixed asset serving in the webchat server to properly handle root path requests and ensure CSS, JavaScript, and other static files load correctly.

---

## 01018 — mac: global outside-click monitor and highlight helper
**SHA:** 3b9d84e2b1 · **Date:** 2025-12-10 00:51
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `ui`, `refactor`

Added a global outside-click monitor and highlight helper utility to simplify the UI interaction patterns for dismissing overlays and panels.

---

## 01019 — fix: keep tools list stable
**SHA:** bb057b1dad · **Date:** 2025-12-10 00:02
**Files changed:** apps/macos/Sources/Clawdis/ToolsSettings.swift
**Tags:** `bugfix`, `ui`

Fixed tool list ordering and filtering to prevent unnecessary reordering when installation status changes, providing a more stable user experience.

---

## 01020 — style(webchat): pad error view
**SHA:** 27d8aa0f04 · **Date:** 2025-12-10 00:02
**Files changed:** apps/webchat/views/error.html
**Tags:** `ui`, `cleanup`

Added padding to the error view container in webchat for improved visual spacing and readability.

---

## 01021 — mac: centralize log path lookup
**SHA:** c4eff00ed7 · **Date:** 2025-12-10 00:03
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `refactor`, `cleanup`

Extracted log path lookup logic into a centralized helper function to reduce duplication and improve maintainability.

---

## 01022 — style(webchat): add body padding class on error
**SHA:** 496136b52c · **Date:** 2025-12-10 00:04
**Files changed:** apps/webchat/styles.css
**Tags:** `ui`, `cleanup`

Added CSS padding class to the body element when displaying error messages, ensuring consistent spacing and layout.

---

## 01023 — mac: guard ports and sweep stale tunnels
**SHA:** 872d54a2dd · **Date:** 2025-12-10 01:04
**Files changed:** apps/macos/Sources/Clawdis/GatewayProcessManager.swift, apps/macos/Sources/Clawdis/PortGuardian.swift, apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `core-feature`, `cleanup`

Integrated PortGuardian sweep functionality to clean up stale tunnel processes on application startup. Tracks running gateway processes and removes entries for processes that no longer exist.

---

## 01024 — mac: drop legacy log path
**SHA:** a7e46568340 · **Date:** 2025-12-10 00:04
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `cleanup`, `refactor`

Removed support for legacy log file paths, simplifying the log path lookup logic and reducing code complexity.

---

## 01025 — mac: treat pnpm/bun processes as expected gateways
**SHA:** a07229846f · **Date:** 2025-12-10 01:10
**Files changed:** apps/macos/Sources/Clawdis/PortGuardian.swift
**Tags:** `bugfix`, `refactor`

Updated PortGuardian to recognize pnpm and bun development processes as expected gateway processes, preventing them from being incorrectly flagged as stale.

---

## 01026 — fix: expand gateway attach log
**SHA:** 1820308ba2 · **Date:** 2025-12-10 00:19
**Files changed:** src/commands/attach.ts
**Tags:** `bugfix`, `logging`

Expanded the gateway attach log messages to include more detailed diagnostic information for troubleshooting connection issues.

---

## 01027 — mac: show full command and kill controls for ports
**SHA:** 7871e705bf · **Date:** 2025-12-10 01:22
**Files changed:** apps/macos/Sources/Clawdis/PortDiagnostics.swift
**Tags:** `ui`, `core-feature`

Added UI controls to display the full command line for processes using gateway ports and provided manual kill controls for users to terminate stale processes.

---

## 01028 — mac: add browser webchat debug entry
**SHA:** 08f8f58971 · **Date:** 2025-12-10 01:33
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `debugging`, `ui`

Added a debug menu entry to open the webchat interface in the default browser for easier testing and debugging.

---

## 01029 — mac: silence proc_pidpath warning
**SHA:** 5bbc7c8ba2 · **Date:** 2025-12-10 01:43
**Files changed:** apps/macos/Sources/Clawdis/PortGuardian.swift
**Tags:** `bugfix`, `logging`

Suppressed noisy proc_pidpath warnings that appear when querying process information for non-existent or inaccessible processes.

---

## 01030 — mac: route remote mode through SSH
**SHA:** 27f9cd591d · **Date:** 2025-12-10 01:43
**Files changed:** apps/macos/Sources/Clawdis/GatewayProcessManager.swift
**Tags:** `core-feature`, `refactor`

Modified remote mode gateway handling to route connections through SSH instead of direct networking, improving security and compatibility.

---

## 01031 — mac: avoid spawning local gateway in remote mode
**SHA:** b1834b7cf8 · **Date:** 2025-12-10 01:44
**Files changed:** apps/macos/Sources/Clawdis/GatewayProcessManager.swift
**Tags:** `bugfix`, `refactor`

Fixed an issue where the application would attempt to spawn a local gateway process even when operating in remote mode. Now properly respects the connection mode setting.

---

## 01032 — infra: use flock gateway lock
**SHA:** 426503e062 · **Date:** 2025-12-10 00:46
**Files changed:** src/cli/gateway-lock.ts
**Tags:** `core-feature`, `refactor`

Replaced gateway locking mechanism with file-based flock (file lock) for improved cross-platform compatibility and reliability.

---

## 01033 — chore: update dependencies
**SHA:** f1fd25e95e · **Date:** 2025-12-10 00:48
**Files changed:** package.json
**Tags:** `dependency`, `maintenance`

Updated @mariozechner/pi-ai and @mariozechner/pi-coding-agent from 0.17.0 to 0.18.0 to include latest improvements.

---

## 01034 — fix: stabilize health probe and gateway handshake
**SHA:** cf8b00890f · **Date:** 2025-12-10 00:52
**Files changed:** src/cli/program.ts, src/commands/health.ts, src/gateway/server.ts
**Tags:** `bugfix`, `core-feature`

Improved health probe stability by enabling live probing by default and removing the 440 status code from conflict detection. Enhanced error handling in webchat startup with proper error messages when binding fails.

---

## 01035 — test: isolate gateway lock per run
**SHA:** 3907e9eedd · **Date:** 2025-12-10 00:58
**Files changed:** test/setup.ts
**Tags:** `testing`, `refactor`

Modified test setup to isolate gateway locks per test run, preventing cross-test interference and improving test reliability.

---

## 01036 — test: add test:force helper
**SHA:** 260d9b9770 · **Date:** 2025-12-10 01:00
**Files changed:** package.json, src/cli/program.ts
**Tags:** `testing`, `core-feature`

Added test:force npm script helper to force run tests regardless of previous results, improving test development workflow.

---

## 01037 — webchat: handle bind errors gracefully
**SHA:** 35834d3dba · **Date:** 2025-12-10 01:00
**Files changed:** src/webchat/server.ts
**Tags:** `error-handling`, `ui`

Improved error handling in the webchat server to gracefully handle port binding failures with clear error messages.

---

## 01038 — test: drop obsolete reply session placeholder
**SHA:** 5ed1d4e178 · **Date:** 2025-12-10 01:00
**Files changed:** test/fixtures/reply-session.ts
**Tags:** `testing`, `cleanup`

Removed outdated test fixtures and placeholder code that is no longer needed.

---

## 01039 — mac: tidy menu and gateway support
**SHA:** 70fb4d452e · **Date:** 2025-12-10 01:00
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `ui`, `cleanup`

Refactored menu code organization and improved gateway support integration for cleaner code structure.

---

## 01040 — mac: add swiftui web chat option
**SHA:** 83a2a7a1c2 · **Date:** 2025-12-10 02:00
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `ui`, `core-feature`

Added a SwiftUI-based web chat UI option as an alternative to the WebKit-based implementation, providing users with different rendering options.

---

## 01041 — webchat: add centered boot loader
**SHA:** 7f0f789953 · **Date:** 2025-12-10 01:04
**Files changed:** apps/webchat/components/BootLoader.tsx
**Tags:** `ui`, `cleanup`

Added a centered loading spinner component that displays while the webchat interface initializes.

---

## 01042 — chore(test): document force run and relax coverage scope
**SHA:** 6c1638890c · **Date:** 2025-12-10 01:06
**Files changed:** package.json, test/README.md
**Tags:** `documentation`, `testing`

Documented the test:force helper functionality and adjusted test coverage requirements to focus on critical code paths.

---

## 01043 — mac: align web chat UI with web
**SHA:** d077936a21 · **Date:** 2025-12-10 02:18
**Files changed:** apps/macos/Sources/Clawdis/WebChatView.swift
**Tags:** `ui`, `refactor`

Updated the SwiftUI web chat UI to match the visual design and behavior of the web version for consistency.

---

## 01044 — mac: remove divider above active toggle
**SHA:** 1839c144fa · **Date:** 2025-12-10 02:44
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `ui`, `cleanup`

Removed the horizontal divider that appeared above the active status toggle in the menu for a cleaner interface.

---

## 01045 — mac: inline gateway status row
**SHA:** c4f0236ec0 · **Date:** 2025-12-10 02:46
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `ui`, `cleanup`

Consolidated gateway status information into a single inline row instead of occupying separate lines, improving space efficiency.

---

## 01046 — mac: move debug toggles to footer
**SHA:** 68c5d61d60 · **Date:** 2025-12-10 02:48
**Files changed:** apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `ui`, `cleanup`

Relocated debug toggle options to the footer of the menu, reducing clutter in the main menu area.

---

## 01047 — chore(mac): align remote ssh controls
**SHA:** e9679ce993 · **Date:** 2025-12-10 02:48
**Files changed:** apps/macos/Sources/Clawdis/RemoteSSHPanel.swift
**Tags:** `ui`, `cleanup`

Aligned remote SSH control UI elements for consistent styling and improved visual hierarchy.

---

## 01048 — mac: simplify package manager picker
**SHA:** cf2b659491 · **Date:** 2025-12-10 02:49
**Files changed:** apps/macos/Sources/Clawdis/ToolsSettings.swift
**Tags:** `ui`, `refactor`

Simplified the package manager selection picker UI to be more compact and user-friendly.

---

## 01049 — fix(voice): unify overlay send flow
**SHA:** 657450c40c · **Date:** 2025-12-10 02:52
**Files changed:** apps/macos/Sources/Clawdis/VoicePushToTalk.swift, apps/macos/Sources/Clawdis/VoiceSessionCoordinator.swift, apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `bugfix`, `refactor`

Unified the voice overlay send flow to eliminate duplicate code paths and use a single beginSendUI method. Fixed state management by removing the redundant autoSendTask and properly coordinating session state.

---

## 01050 — gateway: include last input in presence events
**SHA:** 5d26bb2566 · **Date:** 2025-12-10 03:48
**Files changed:** src/gateway/server.ts, src/process/presence.ts
**Tags:** `core-feature`, `api`

Extended presence events to include the timestamp of the last user input, providing more detailed activity tracking information to connected clients.

---
