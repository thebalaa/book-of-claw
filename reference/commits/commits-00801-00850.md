# Commit Reference: 00801–00850

A plain factual summary of every commit in the OpenClaw repository, from commit 801 through commit 850.

---

## 00801 — control: seed events, add tests, update remote doc
**SHA:** e38bdd0d2d · **Date:** 2025-12-08 22:03
**Files changed:** docs/remote.md, src/infra/control-channel.test.ts, src/infra/control-channel.ts
**Tags:** `testing`, `documentation`, `core-feature`

Added control channel test suite with Vitest, testing ping, health, and heartbeat event streaming. Control server now seeds new clients with relay status and last heartbeat event on connection. Updated remote.md to document status request and SSH reachability testing.

---

## 00802 — macos: control channel diagnostics and tunnel-based testing
**SHA:** c5b073702c · **Date:** 2025-12-08 22:04
**Files changed:** apps/macos/Sources/Clawdis/ControlChannel.swift, apps/macos/Sources/Clawdis/GeneralSettings.swift, apps/macos/Sources/Clawdis/HeartbeatStore.swift, apps/macos/Sources/Clawdis/MenuBar.swift, apps/macos/Sources/Clawdis/VoiceWakeChime.swift, apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift
**Tags:** `ux`, `refactor`

Added connection state tracking (disconnected, connecting, connected, degraded) to control channel with 30-second ping health checks. Settings panel now displays control channel status, last ping latency, and last heartbeat age. Menu bar shows "Control channel disconnected" warning when degraded.

---

## 00803 — ux: float close button outside bubble, stronger shadow
**SHA:** 33b54f3d0c · **Date:** 2025-12-08 22:11
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Refactored overlay close button to render outside the clipped bubble area using CloseButtonOverlay component. Offset adjusted from -8 to -12 points. Prevents duplicate auto-send by cancelling task and checking isSending flag.

---

## 00804 — macos: harden control channel connect continuation
**SHA:** 9bde7a6daa · **Date:** 2025-12-08 22:16
**Files changed:** apps/macos/Sources/Clawdis/ControlChannel.swift
**Tags:** `bugfix`

Protected control channel connection continuation from multiple resumption by clearing stateUpdateHandler after first state transition. Added weak self and weak conn captures to prevent retain cycles.

---

## 00805 — macos: polish voice overlay and remote command handling
**SHA:** 04b5002d8f · **Date:** 2025-12-08 22:23
**Files changed:** apps/macos/Sources/Clawdis/ControlChannel.swift, apps/macos/Sources/Clawdis/Utilities.swift, apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `refactor`, `ux`

Simplified control channel state handler by removing redundant resumed flag guard. Improved remote command resolver to handle empty project root and detect CLI location (clawdis binary, node script, or pnpm). Removed duplicate CloseHoverButton definition from overlay.

---

## 00806 — macos: refine speech noise floor tracking
**SHA:** 6c91304400 · **Date:** 2025-12-08 22:24
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift
**Tags:** `core-feature`, `optimization`

Implemented adaptive noise floor tracking with asymmetric alpha (0.08 when quiet, 0.01 when loud) for better speech detection. Audio level processing moved to detached task to avoid actor reentrancy. Adds rmsLevel calculation and noteAudioLevel method.

---

## 00807 — VoiceWake: add level meter
**SHA:** 92d015333a · **Date:** 2025-12-08 22:28
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift, apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift
**Tags:** `ux`, `core-feature`

Added 14-bar level meter visualization to voice overlay showing normalized speech level (0-1). LevelBars component displays accent-colored bars with animated height. Level resets to 0 on dismiss and when stopping voice ears.

---

## 00808 — macos: sync ears with overlay visibility
**SHA:** 677374de86 · **Date:** 2025-12-08 22:31
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift
**Tags:** `bugfix`

Updated level meter display when overlay dismisses from recognizer. Ensures visual consistency between overlay visibility and audio capture state.

---

## 00809 — macos: blink critter when overlay dismisses empty
**SHA:** abca8535cf · **Date:** 2025-12-08 22:34
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Triggers critter blink animation when voice overlay dismisses with empty transcript. Provides visual feedback for cancelled or empty voice input.

---

## 00810 — macos: stabilize control connection wait
**SHA:** 6298c586fd · **Date:** 2025-12-08 21:31
**Files changed:** apps/macos/Sources/Clawdis/ControlChannel.swift
**Tags:** `refactor`

Extracted connection state handling into ConnectionWaiter actor to prevent Sendable capture issues. Ensures thread-safe single-shot continuation resumption.

---

## 00811 — VoiceWake: button meter + fix label color
**SHA:** 2d512c714b · **Date:** 2025-12-08 22:36
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeSettings.swift
**Tags:** `ux`

Added level meter to VoiceWake test button in settings panel. Fixed label text color to use primary color for better visibility.

---

## 00812 — macos: stabilize close hover and unclipped button
**SHA:** fce04b9424 · **Date:** 2025-12-08 22:38
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Refined close button positioning and hover handling. Ensures button renders outside clipped overlay region for consistent interaction.

---

## 00813 — macos: restore overlay close button
**SHA:** ad3254deb6 · **Date:** 2025-12-08 21:40
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Restored close button to overlay after layout refactoring. Fixed regression where close button was accidentally removed.

---

## 00814 — Remove overlay bar meter
**SHA:** c5af11f6bd · **Date:** 2025-12-08 22:43
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Removed level meter from overlay bar. Likely superseded by alternative level visualization approach.

---

## 00815 — macos: deepen shadow on close pill
**SHA:** fa9a92f214 · **Date:** 2025-12-08 22:45
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Increased shadow depth on overlay close button pill for better visual separation and depth perception.

---

## 00816 — macos: add soft shadow behind overlay bubble
**SHA:** 440558c44f · **Date:** 2025-12-08 22:51
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Added soft shadow behind overlay bubble to improve visual hierarchy and separation from background content.

---

## 00817 — VoiceWake: guard trigger chime
**SHA:** 62fecdcaa8 · **Date:** 2025-12-08 22:52
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift
**Tags:** `bugfix`

Added guard to prevent playing trigger chime multiple times. Ensures single chime playback per voice activation.

---

## 00818 — macos: fail fast when SSH tunnel exits
**SHA:** 0e4b28ac25 · **Date:** 2025-12-08 22:53
**Files changed:** apps/macos/Sources/Clawdis/ControlChannel.swift
**Tags:** `bugfix`

Added SSH tunnel process monitoring with terminationHandler. Disconnects control channel immediately when SSH tunnel exits unexpectedly.

---

## 00819 — macos: add inset margin so overlay shadow isn't clipped
**SHA:** 5dd5c9c605 · **Date:** 2025-12-08 22:56
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Added inset margin to overlay window to prevent shadow clipping at edges. Ensures complete shadow visibility around bubble.

---

## 00820 — macos: swap bubble shadow for 1px border
**SHA:** a6426d0ac5 · **Date:** 2025-12-08 23:14
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `ux`

Replaced soft shadow with 1px border around overlay bubble. Cleaner visual style with reduced rendering overhead.

---

## 00821 — control: drop runtime export of type-only HeartbeatEventPayload
**SHA:** 05bd452f76 · **Date:** 2025-12-08 23:15
**Files changed:** src/infra/heartbeat-events.ts
**Tags:** `type-safety`, `refactor`

Removed runtime export of HeartbeatEventPayload since it is a type-only declaration. Prevents unnecessary runtime code generation.

---

## 00822 — VoiceWake: track listening state for PTT
**SHA:** 2b7adeb220 · **Date:** 2025-12-08 23:17
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift
**Tags:** `core-feature`

Added listening state tracking to support push-to-talk (PTT) functionality. Prepares voice wake runtime for PTT activation mode.

---

## 00823 — Build: update webchat bundle
**SHA:** 06f59f4e8a · **Date:** 2025-12-08 23:20
**Files changed:** public/webchat/bundle.js
**Tags:** `dependency`

Rebuilt webchat bundle with latest changes. Updates compiled JavaScript for web chat interface.

---

## 00824 — macos: keep remote control tunnel alive
**SHA:** 22259a322d · **Date:** 2025-12-08 23:28
**Files changed:** apps/macos/Sources/Clawdis/ControlChannel.swift
**Tags:** `bugfix`

Implemented SSH tunnel keepalive mechanism to prevent idle disconnections. Improves reliability of remote control connections.

---

## 00825 — docs: note Mac app for relay debugging
**SHA:** 1f2f5858c0 · **Date:** 2025-12-08 23:37
**Files changed:** docs/remote.md
**Tags:** `documentation`

Updated remote.md to document using Mac app for relay debugging and tunnel testing. Clarifies diagnostic workflow.

---

## 00826 — macos: timeout control health probes
**SHA:** c3c6880382 · **Date:** 2025-12-08 22:45
**Files changed:** apps/macos/Sources/Clawdis/ControlChannel.swift
**Tags:** `bugfix`

Added timeout support to control channel health requests. Prevents indefinite hangs when relay becomes unresponsive.

---

## 00827 — fix(mac): switch push-to-talk to right option
**SHA:** bc01488a75 · **Date:** 2025-12-08 23:50
**Files changed:** apps/macos/Sources/Clawdis/AppDelegate.swift
**Tags:** `bugfix`, `ux`

Changed push-to-talk hotkey from left option to right option key. Improves ergonomics and avoids conflicts with text input.

---

## 00828 — Mac: clarify runtime comments
**SHA:** 5674c9f4c2 · **Date:** 2025-12-09 00:08
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeRuntime.swift
**Tags:** `documentation`

Improved code comments in VoiceWakeRuntime for better clarity. Documentation-only change with no behavior modification.

---

## 00829 — fix(mac): stabilize voice wake visuals
**SHA:** c77fa12bda · **Date:** 2025-12-09 00:12
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `bugfix`, `ux`

Fixed visual instability in voice wake overlay animations. Ensures smooth and consistent overlay presentation.

---

## 00830 — feat: emit job-state events from rpc
**SHA:** 594e837440 · **Date:** 2025-12-09 00:18
**Files changed:** apps/macos/Sources/Clawdis/AgentRPC.swift, src/cli/program.ts
**Tags:** `core-feature`

Added job-state event emission from agent RPC with started, streaming, done, and error states. Tracks active jobs counter and updates working state in AppStateStore. CLI generates job IDs and emits lifecycle events.

---

## 00831 — macos: show detailed health failure
**SHA:** 04b34adec6 · **Date:** 2025-12-08 23:20
**Files changed:** apps/macos/Sources/Clawdis/HealthStore.swift
**Tags:** `ux`

Enhanced health failure messages to show detailed error information. Improves troubleshooting by surfacing specific failure reasons.

---

## 00832 — refactor(mac): split menubar UI into smaller files
**SHA:** 3114dfd39b · **Date:** 2025-12-09 00:27
**Files changed:** apps/macos/Sources/Clawdis/CritterStatusLabel.swift, apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `refactor`

Extracted CritterStatusLabel (325 lines) from MenuBar.swift into separate file. Improves code organization by separating animated status label component with blink, wiggle, and ear boost visuals.

---

## 00833 — feat: broadcast agent events over control channel
**SHA:** 40dd23337c · **Date:** 2025-12-09 00:28
**Files changed:** apps/macos/Sources/Clawdis/ControlChannel.swift, src/commands/agent.ts
**Tags:** `core-feature`

Added agent event streaming over control channel with ControlAgentEvent type and AnyCodable for dynamic JSON. Control channel decodes agent events and updates working state based on job stream state. Agent command now broadcasts events to control clients.

---

## 00834 — feat: stream tool/job events over control channel
**SHA:** 371a30f08b · **Date:** 2025-12-09 00:31
**Files changed:** src/auto-reply/command-reply.ts
**Tags:** `core-feature`

Extended agent event streaming to include tool execution lifecycle events. Emits tool_execution_start and tool_result events with metadata to control channel for real-time visibility.

---

## 00835 — chore: ignore macOS swiftpm cache
**SHA:** 2d1f1640f3 · **Date:** 2025-12-09 00:43
**Files changed:** .gitignore
**Tags:** `refactor`

Added .swiftpm directory to gitignore to exclude Swift Package Manager build cache from version control.

---

## 00836 — feat: forward tool/assistant events to agent bus
**SHA:** b7b1714f32 · **Date:** 2025-12-09 00:44
**Files changed:** src/auto-reply/command-reply.ts
**Tags:** `core-feature`

Connected tool and assistant lifecycle events to agent event bus. Ensures all agent activity streams through unified event system for monitoring.

---

## 00837 — relay: don't crash when webchat port is busy
**SHA:** 36c91c3984 · **Date:** 2025-12-08 23:49
**Files changed:** src/commands/relay.ts
**Tags:** `bugfix`

Added error handling for webchat port conflicts. Relay command now logs error and continues instead of crashing when port is already in use.

---

## 00838 — macOS: extract attributed string helper
**SHA:** 9928f1b3c1 · **Date:** 2025-12-09 00:55
**Files changed:** apps/macos/Sources/Clawdis/Utilities.swift
**Tags:** `refactor`

Extracted attributed string utility methods into separate helper functions. Improves code reusability and organization.

---

## 00839 — feat(mac): add agent events debug window
**SHA:** 8e8e695db9 · **Date:** 2025-12-09 00:56
**Files changed:** apps/macos/Sources/Clawdis/AgentEventsWindow.swift, apps/macos/Sources/Clawdis/MenuBar.swift
**Tags:** `ux`, `core-feature`

Added agent events debug window to Mac app for monitoring real-time event streams. Displays agent, tool, and job events in dedicated window for development and debugging.

---

## 00840 — chore: tidy agent event streaming types
**SHA:** 34d2527606 · **Date:** 2025-12-09 00:57
**Files changed:** src/infra/agent-events.ts
**Tags:** `type-safety`, `refactor`

Cleaned up agent event streaming type definitions. Improved type safety and consistency across event structures.

---

## 00841 — chore: guard host runtime and simplify packaging
**SHA:** cf36f5a23b · **Date:** 2025-12-09 00:59
**Files changed:** package.json, src/commands/relay.ts
**Tags:** `refactor`, `dependency`

Added runtime guards to prevent bundling host-specific dependencies. Simplified packaging configuration for better cross-platform compatibility.

---

## 00842 — chore(mac): prefer host runtime for remote relay
**SHA:** cba016df74 · **Date:** 2025-12-09 00:59
**Files changed:** apps/macos/Sources/Clawdis/Utilities.swift
**Tags:** `refactor`

Updated remote command resolver to prefer host runtime (node/bun) over bundled relay. Improves remote relay startup performance and flexibility.

---

## 00843 — ci: test node and bun runtimes
**SHA:** d9eb320bba · **Date:** 2025-12-09 01:00
**Files changed:** .github/workflows/ci.yml
**Tags:** `testing`

Added matrix testing for both Node.js and Bun runtimes in CI workflow. Tests lint, test, and build steps separately for each runtime with fail-fast disabled.

---

## 00844 — macos: log health timeout and control requests
**SHA:** 15729e9ea0 · **Date:** 2025-12-09 00:00
**Files changed:** apps/macos/Sources/Clawdis/ControlChannel.swift
**Tags:** `verbosity`

Added logging for health probe timeouts and control channel requests. Improves debugging visibility for remote connection issues.

---

## 00845 — chore(mac): drop duplicate job-state tracking
**SHA:** 5b5a79b90b · **Date:** 2025-12-09 01:06
**Files changed:** apps/macos/Sources/Clawdis/AgentRPC.swift
**Tags:** `refactor`

Removed duplicate job-state event tracking from AgentRPC. Working state now sourced exclusively from agent events streamed via control channel.

---

## 00846 — chore: single-source working state from agent events
**SHA:** f965e1c3ff · **Date:** 2025-12-09 01:17
**Files changed:** apps/macos/Sources/Clawdis/AppStateStore.swift
**Tags:** `refactor`

Consolidated working state management to use agent events as single source of truth. Removes duplicate state tracking logic.

---

## 00847 — fix: always emit tool events
**SHA:** e981d90209 · **Date:** 2025-12-09 01:22
**Files changed:** src/auto-reply/command-reply.ts
**Tags:** `bugfix`

Removed verbose-only gating on tool event emission. Tool lifecycle events now always emit regardless of verbosity level for consistent monitoring.

---

## 00848 — test: ensure tool events emit without verbose
**SHA:** 2761c40781 · **Date:** 2025-12-09 01:24
**Files changed:** src/auto-reply/command-reply.test.ts
**Tags:** `testing`

Added test to verify tool events emit even when verbose mode is disabled. Validates fix from commit 00847.

---

## 00849 — control: reconnect on EOF and relax rpc text parse
**SHA:** ec1ff52dfb · **Date:** 2025-12-09 00:29
**Files changed:** apps/macos/Sources/Clawdis/ControlChannel.swift
**Tags:** `bugfix`

Added automatic reconnection when control channel receives EOF. Relaxed RPC text parsing to handle malformed or incomplete frames gracefully.

---

## 00850 — control: log incoming health requests
**SHA:** 73cc34467a · **Date:** 2025-12-09 00:38
**Files changed:** src/infra/control-channel.ts
**Tags:** `verbosity`

Added logging for incoming health requests to control channel server. Improves visibility into client health probe activity.
