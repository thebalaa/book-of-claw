# Commit Reference: 00401–00450

A plain factual summary of every commit in the OpenClaw repository, from commit 401 through commit 450.

---

## 00401 — chore: make pi-only rpc with fixed sessions
**SHA:** fcf0c28132 · **Date:** 2025-12-05 17:50
**Files changed:** AGENTS.md, CHANGELOG.md, README.md, docs/agent.md, docs/agents.md, src/agents/, src/auto-reply/, src/config/
**Tags:** `refactor`, `core-feature`, `process-lifecycle`

Dropped support for all non-Pi agents (Claude, Codex, Gemini, Opencode) and switched the codebase to Pi-only operation. Updated CHANGELOG (v1.5.0), removed legacy agent implementations, and restructured agent handling to default to Pi RPC while maintaining session and heartbeat plumbing for non-Pi fallbacks.

## 00402 — docs: add repo link to homepage
**SHA:** d33f9ddf44 · **Date:** 2025-12-05 17:51
**Files changed:** docs/index.md
**Tags:** `documentation`

Added explicit source code link and GitHub repository reference to the documentation homepage (`docs/index.md`), improving discoverability for users.

## 00403 — fix: harden pi rpc prompt handling
**SHA:** f315bf074b · **Date:** 2025-12-05 18:24
**Files changed:** src/auto-reply/command-reply.test.ts, src/auto-reply/command-reply.ts, src/index.core.test.ts
**Tags:** `bugfix`, `testing`, `process-lifecycle`

Hardened Pi RPC prompt handling to ensure the body message is always sent via RPC stdin even when the command array omits the `{{Body}}` template. Added test coverage to validate this scenario.

## 00404 — Route pi agent prompts via RPC stdin
**SHA:** 869cc3d497 · **Date:** 2025-12-05 18:34
**Files changed:** src/auto-reply/command-reply.ts
**Tags:** `core-feature`, `process-lifecycle`

Refactored Pi agent invocation to drive the agent via RPC stdin, sending prompt messages as JSON structures (`{ type: "prompt", message: ... }`) rather than command-line arguments. This enables server-side auto-compaction and streaming.

## 00405 — chore: drop twilio and go web-only
**SHA:** 7c7314f673 · **Date:** 2025-12-05 19:03
**Files changed:** src/auto-reply/reply.ts, src/auto-reply/reply.chunking.test.ts, src/cli/, src/commands/, src/config/, src/twilio/, src/web/, test/
**Tags:** `refactor`, `dependency`, `provider`

Removed all Twilio integration code and made the system web-only (WhatsApp Web provider). Deleted Twilio-specific modules, test files, message chunking logic, and updated configuration structures. Simplified the provider layer to exclusively use web-based WhatsApp.

## 00406 — docs: update for web-only pi rpc
**SHA:** c25b0c1a66 · **Date:** 2025-12-05 19:04
**Files changed:** docs/index.md
**Tags:** `documentation`

Updated documentation to reflect the web-only architecture and Pi RPC operation mode, removing references to Twilio and legacy agent options.

## 00407 — fix: ignore rpc toolcall deltas to avoid duplicate replies
**SHA:** 0da3f84a2e · **Date:** 2025-12-05 19:16
**Files changed:** src/index.core.test.ts, src/index.ts
**Tags:** `bugfix`, `process-lifecycle`

Fixed duplicate reply handling by ignoring RPC toolcall delta events (partial tool streaming updates), which was causing multiple messages to be sent for a single tool invocation.

## 00408 — chore: redact long texts in web logs
**SHA:** 29dfe89137 · **Date:** 2025-12-05 19:21
**Files changed:** src/web/auto-reply.ts
**Tags:** `verbosity`, `refactor`

Redacted long text fields in web provider logs to reduce noise and protect privacy in log output, improving observability without exposing sensitive message content.

## 00409 — feat: stream turn completions and tighten rpc timeout
**SHA:** 5492845659 · **Date:** 2025-12-05 21:13
**Files changed:** src/index.core.test.ts, src/index.ts
**Tags:** `core-feature`, `process-lifecycle`

Implemented streaming of turn completions from RPC and tightened the RPC communication timeout to improve responsiveness and streaming behavior during agent interactions.

## 00410 — chore: remove twilio and expand pi cli detection
**SHA:** e7a9313135 · **Date:** 2025-12-05 21:13
**Files changed:** src/auto-reply/command-reply.ts
**Tags:** `refactor`, `dependency`

Removed remaining Twilio references from command-reply logic and expanded Pi CLI detection to recognize variations like `pi`, `tau`, `pi-coding-agent`, and paths containing `/pi/`.

## 00411 — fix: normalize directive triggers and short-circuit
**SHA:** dc02bcee74 · **Date:** 2025-12-05 21:29
**Files changed:** src/index.core.test.ts, src/index.ts
**Tags:** `bugfix`, `process-lifecycle`

Normalized directive trigger handling (e.g., `/abort`, `/restart`, heartbeat directives) to prevent redundant processing and added short-circuit logic for early termination when directives are encountered.

## 00412 — docs: note directive short-circuit
**SHA:** fffe1be521 · **Date:** 2025-12-05 21:30
**Files changed:** docs/
**Tags:** `documentation`

Added documentation noting the directive short-circuit behavior and explaining how `/abort` and `/restart` directives stop further processing.

## 00413 — chore: add system marker to directives and abort
**SHA:** fe87160b19 · **Date:** 2025-12-05 21:37
**Files changed:** src/index.core.test.ts, src/index.ts
**Tags:** `refactor`, `process-lifecycle`

Added system markers to identify directive messages and improved abort logic to cleanly terminate agent communication when `/abort` or timeout directives are encountered.

## 00414 — Add bundled pi default and session token reporting
**SHA:** 690113dd73 · **Date:** 2025-12-05 22:33
**Files changed:** src/cli/program.ts, src/commands/status.ts
**Tags:** `core-feature`, `documentation`

Added bundled Pi CLI as a default option and implemented session token reporting in the status command, allowing users to see active session tokens for their Pi agent.

## 00415 — feat: add mac companion app
**SHA:** a5164df293 · **Date:** 2025-12-05 23:13
**Files changed:** .gitignore, apps/macos/, bin/clawdis-mac, package.json, src/cli/
**Tags:** `core-feature`, `naming`, `ux`

Introduced the macOS companion application (`apps/macos/`), a SwiftUI-based menubar app for managing Clawdis. Added template assets, build configuration, and CLI integration for bundling the macOS binary.

## 00416 — chore: ignore macOS .DS_Store globally
**SHA:** d75d64df64 · **Date:** 2025-12-05 23:19
**Files changed:** .gitignore
**Tags:** `refactor`

Added `.DS_Store` and related macOS-specific build artifacts to `.gitignore` to prevent committing system files.

## 00417 — chore: rename package to clawdis
**SHA:** 5949ef0e2c · **Date:** 2025-12-05 23:19
**Files changed:** package.json, src/index.ts, src/cli/
**Tags:** `naming`, `refactor`

Renamed the package from "Warelay" to "Clawdis" (a play on "Clawd" the lobster) throughout the codebase, reflecting the rebranding effort.

## 00418 — fix: avoid directive hits inside URLs and add tests
**SHA:** 99b174f495 · **Date:** 2025-12-05 22:28
**Files changed:** src/index.core.test.ts, src/index.ts
**Tags:** `bugfix`, `testing`, `process-lifecycle`

Fixed directive parsing to avoid triggering on directives that appear inside URLs, which could cause false positives. Added comprehensive test coverage for URL-embedded directive scenarios.

## 00419 — test: cover directive parsing and abort/restart prefixes
**SHA:** c95c6d72e9 · **Date:** 2025-12-05 22:29
**Files changed:** src/index.core.test.ts
**Tags:** `testing`, `process-lifecycle`

Expanded test coverage for directive parsing, abort prefix handling, and restart prefix scenarios to ensure correct behavior across all directive edge cases.

## 00420 — fix: ignore directives inside history blocks
**SHA:** 24d90c17c2 · **Date:** 2025-12-05 22:49
**Files changed:** src/index.core.test.ts, src/index.ts
**Tags:** `bugfix`, `testing`, `process-lifecycle`

Fixed directive detection to ignore directives appearing inside conversation history blocks, preventing accidental triggering of directives in historical message context.

## 00421 — fix: avoid echoing prompts when rpc returns empty
**SHA:** 4cb2a92037 · **Date:** 2025-12-05 22:52
**Files changed:** src/index.core.test.ts, src/index.ts
**Tags:** `bugfix`, `verbosity`

Prevented echoing user prompts back to the user when the Pi RPC returns empty output, improving handling of silent or non-responsive agent turns.

## 00422 — fix: suppress heartbeat directive acks and add coverage
**SHA:** 5b217b20422 · **Date:** 2025-12-05 22:54
**Files changed:** src/index.core.test.ts, src/index.ts
**Tags:** `bugfix`, `testing`, `auto-reply`

Suppressed acknowledgment messages for heartbeat directives and added test coverage to verify heartbeat handling doesn't produce unnecessary user-visible output.

## 00423 — fix: broaden prompt-echo guard and add heartbeat directive test
**SHA:** d7a188fb34 · **Date:** 2025-12-05 22:56
**Files changed:** src/index.core.test.ts, src/index.ts
**Tags:** `bugfix`, `testing`, `process-lifecycle`

Broadened the guard condition for prompt echoing to handle additional edge cases and added dedicated test for heartbeat directive behavior.

## 00424 — fix: allow inline directives to continue and add mixed-message test
**SHA:** 3241d81ce5 · **Date:** 2025-12-05 22:57
**Files changed:** src/index.core.test.ts, src/index.ts
**Tags:** `bugfix`, `testing`, `process-lifecycle`

Modified directive handling to allow inline directives (directives embedded in larger messages) to continue processing rather than terminating. Added test for mixed message scenarios.

## 00425 — fix: handle prompt-too-long by resetting session and continuing inline directives
**SHA:** 36b0796976 · **Date:** 2025-12-05 23:01
**Files changed:** src/index.core.test.ts, src/index.ts
**Tags:** `bugfix`, `process-lifecycle`

Implemented "prompt too long" error handling that resets the session and continues processing inline directives, maintaining conversation flow when prompts exceed agent limits.

## 00426 — revert prompt-too-long fallback and keep inline directives
**SHA:** 3c64a57c84 · **Date:** 2025-12-05 23:18
**Files changed:** src/index.core.test.ts, src/index.ts
**Tags:** `bugfix`, `refactor`

Reverted the "prompt too long" session reset fallback while retaining inline directive continuation behavior, opting for a cleaner approach to prompt length handling.

## 00427 — chore: ignore mac build artifacts
**SHA:** 38a4e9806f · **Date:** 2025-12-05 23:45
**Files changed:** .gitignore
**Tags:** `refactor`

Added macOS app build artifacts and intermediate files to `.gitignore` to keep the repository clean during macOS development.

## 00428 — chore: add mac build+run helper
**SHA:** d0cefecd0d · **Date:** 2025-12-05 23:47
**Files changed:** apps/macos/, Makefile
**Tags:** `refactor`, `ux`

Added build and run helper scripts/commands to streamline macOS app compilation and execution during development.

## 00429 — chore: bundle mac app and custom menu icon
**SHA:** b66098ea20 · **Date:** 2025-12-05 23:54
**Files changed:** apps/macos/, bin/, src/cli/
**Tags:** `refactor`, `ux`

Bundled the macOS application with a custom lobster-themed menu icon and integrated the binary into the CLI tooling.

## 00430 — feat: richer mac settings panes and template icon
**SHA:** b557a73c3f · **Date:** 2025-12-05 23:59
**Files changed:** apps/macos/
**Tags:** `core-feature`, `ux`

Enhanced the macOS settings interface with richer panes for configuration and integrated a custom template icon for the status menu, improving the user experience.

## 00431 — feat(mac): animate menubar icon
**SHA:** 4aa275e13c · **Date:** 2025-12-06 00:07
**Files changed:** apps/macos/
**Tags:** `core-feature`, `ux`

Implemented animated menubar icon for the macOS app, providing visual feedback on app status and activity.

## 00432 — fix(mac): show critter menubar icon
**SHA:** 0ec9c6c3cf · **Date:** 2025-12-06 00:10
**Files changed:** apps/macos/
**Tags:** `bugfix`, `ux`

Fixed the macOS menubar icon display to properly render the critter (lobster) image instead of a generic app icon.

## 00433 — feat: trimmy-style settings tabs and CLI helper bundling
**SHA:** 73a1e137e6 · **Date:** 2025-12-06 00:11
**Files changed:** apps/macos/
**Tags:** `core-feature`, `ux`

Implemented tabbed settings interface following the "trimmy" design pattern and bundled the CLI helper for seamless integration.

## 00434 — chore: add settings shortcut and restart packaging
**SHA:** 13704d9da5 · **Date:** 2025-12-06 00:14
**Files changed:** apps/macos/
**Tags:** `refactor`, `ux`

Added keyboard shortcut to open settings and integrated app restart logic into the packaging pipeline for easier updates.

## 00435 — chore: open settings from menu and restart packaged app
**SHA:** a573ea4aeb · **Date:** 2025-12-06 00:15
**Files changed:** apps/macos/
**Tags:** `refactor`, `ux`

Implemented menu item to open settings and enabled restart functionality for the packaged macOS application.

## 00436 — fix(mac): align critter legs
**SHA:** 4fe651079c · **Date:** 2025-12-06 00:24
**Files changed:** apps/macos/
**Tags:** `bugfix`, `ux`

Fixed the visual alignment of the lobster critter legs in the macOS app icon/animation.

## 00437 — mac: polish onboarding and lifecycle
**SHA:** 5d01b32c10 · **Date:** 2025-12-06 00:37
**Files changed:** apps/macos/
**Tags:** `ux`, `refactor`

Polished the macOS app onboarding experience and improved the application lifecycle management (launch, quit, restart).

## 00438 — mac: auto-show onboarding on first run
**SHA:** d031c5c7fa · **Date:** 2025-12-06 00:40
**Files changed:** apps/macos/
**Tags:** `ux`, `core-feature`

Automatically display the onboarding flow when the macOS app launches for the first time, guiding new users through initial setup.

## 00439 — mac: tighten settings layout
**SHA:** a2604a36bc · **Date:** 2025-12-06 00:42
**Files changed:** apps/macos/
**Tags:** `ux`, `refactor`

Refined the macOS settings window layout for better visual hierarchy and tighter spacing.

## 00440 — fix: harden directive handling
**SHA:** 28e0dbc02f · **Date:** 2025-12-05 23:43
**Files changed:** src/index.core.test.ts, src/index.ts
**Tags:** `bugfix`, `process-lifecycle`

Hardened directive parsing and handling logic to be more robust against edge cases and malformed directive syntax.

## 00441 — mac: match trimmy about layout
**SHA:** 1ee690e87c · **Date:** 2025-12-06 00:44
**Files changed:** apps/macos/
**Tags:** `ux`, `refactor`

Updated the macOS "About" dialog layout to match the design of the Trimmy app for visual consistency.

## 00442 — mac: lock settings window size
**SHA:** c1a64301ce · **Date:** 2025-12-06 00:46
**Files changed:** apps/macos/
**Tags:** `ux`, `refactor`

Fixed the macOS settings window to a locked size to prevent resizing and maintain consistent UI appearance.

## 00443 — feat(mac): add critter ear/leg wiggles
**SHA:** 6f27f742fe · **Date:** 2025-12-06 00:49
**Files changed:** apps/macos/
**Tags:** `core-feature`, `ux`

Implemented playful ear and leg wiggle animations for the critter character in the macOS app, adding personality and visual interest.

## 00444 — fix: bundle pi dependency and directive handling
**SHA:** ddfb76e9e0 · **Date:** 2025-12-06 00:49
**Files changed:** src/index.ts, package.json
**Tags:** `bugfix`, `dependency`, `process-lifecycle`

Bundled the Pi CLI dependency with the application and fixed directive handling to work correctly with the bundled version.

## 00445 — mac: bring onboarding layout closer to vibetunnel
**SHA:** b0ecafcb8d · **Date:** 2025-12-06 00:50
**Files changed:** apps/macos/
**Tags:** `ux`, `refactor`

Refined the macOS onboarding interface to more closely match the design and layout of the Vibetunnel app.

## 00446 — mac: tighten onboarding card layout
**SHA:** 60f4c9f5b3 · **Date:** 2025-12-06 00:52
**Files changed:** apps/macos/
**Tags:** `ux`, `refactor`

Tightened the spacing and layout of onboarding cards in the macOS app for a more polished presentation.

## 00447 — mac: trimmy-style padding and debug toggle
**SHA:** 306780780212 · **Date:** 2025-12-06 00:55
**Files changed:** apps/macos/
**Tags:** `ux`, `refactor`

Applied Trimmy-style padding conventions throughout the macOS app UI and added a debug toggle for development purposes.

## 00448 — mac: fix settings window size persistence
**SHA:** f09390a412 · **Date:** 2025-12-06 00:56
**Files changed:** apps/macos/
**Tags:** `bugfix`, `ux`

Fixed the macOS settings window to properly persist its size and position across application launches.

## 00449 — fix(mac): dim menubar icon like trimmy
**SHA:** 26e939c1eb · **Date:** 2025-12-06 01:07
**Files changed:** apps/macos/
**Tags:** `bugfix`, `ux`

Implemented dimming behavior for the macOS menubar icon to match the Trimmy app's visual style, indicating disabled or paused state.

## 00450 — chore(mac): rebuild and relaunch like trimmy
**SHA:** 12e5b8124e · **Date:** 2025-12-06 01:15
**Files changed:** apps/macos/
**Tags:** `refactor`, `ux`

Implemented app rebuild and relaunch functionality following the Trimmy pattern, enabling seamless updates without manual intervention.

