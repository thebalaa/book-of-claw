# Commit Reference: 01101–01150

A plain factual summary of every commit in the OpenClaw repository, from commit 1101 through commit 1150.

---

## 01101 — docs(readme): describe voice wake reply routing
**SHA:** ea76425f86 · **Date:** 2025-12-12 16:42
**Files changed:** README.md
**Tags:** `documentation`

Documents the voice wake reply routing system for the macOS companion app. Voice Wake sends messages into the main session and routes replies through the last-used communication surface (WhatsApp, Telegram, or WebChat), with graceful degradation if delivery fails.

---

## 01102 — fix(presence): stabilize instance identity
**SHA:** debcf19199 · **Date:** 2025-12-12 16:47
**Files changed:** README.md, apps/macos/Sources/Clawdis/GatewayChannel.swift, apps/macos/Sources/Clawdis/InstanceIdentity.swift, apps/macos/Sources/Clawdis/InstancesStore.swift, apps/macos/Sources/Clawdis/PresenceReporter.swift
**Tags:** `bugfix`

Stabilizes macOS instance identity by extracting stable instanceId and displayName into a dedicated InstanceIdentity module. Fixes presence deduplication to prioritize instanceId over hostname for consistent identification across sessions.

---

## 01103 — style(tests): format imports
**SHA:** 7a1d64fff9 · **Date:** 2025-12-12 16:47
**Files changed:** src/config/sessions.test.ts, src/gateway/server.test.ts, src/infra/gateway-lock.ts, src/web/auto-reply.test.ts
**Tags:** `cleanup`

Reformats test file imports to follow consistent ordering conventions with biome linting standards.

---

## 01104 — Merge remote-tracking branch 'origin/main'
**SHA:** b0187d7f28 · **Date:** 2025-12-12 16:47
**Files changed:** README.md
**Tags:** `process-lifecycle`

Merges latest upstream changes from the main branch to keep repository synchronized.

---

## 01105 — fix(macos): prevent gateway request double-resume
**SHA:** cd84c5ad08 · **Date:** 2025-12-12 16:52
**Files changed:** apps/macos/Sources/Clawdis/GatewayChannel.swift, apps/macos/Tests/ClawdisIPCTests/GatewayChannelRequestTests.swift
**Tags:** `bugfix`

Fixes race condition where gateway requests could double-resume on send failures. Adds test coverage for gateway channel request handling and properly manages pending request state.

---

## 01106 — fix(presence): dedupe instances via stable instanceId
**SHA:** 6a05d60f41 · **Date:** 2025-12-12 16:56
**Files changed:** apps/macos/Sources/Clawdis/InstancesStore.swift, apps/macos/Sources/Clawdis/PresenceReporter.swift
**Tags:** `bugfix`

Improves instance deduplication by prioritizing stable instanceId over hostname in presence normalization logic.

---

## 01107 — fix(mac): avoid static UserDefaults in InstanceIdentity
**SHA:** fd0314a6bd · **Date:** 2025-12-12 16:59
**Files changed:** apps/macos/Sources/Clawdis/InstanceIdentity.swift
**Tags:** `bugfix`

Removes problematic static UserDefaults usage from InstanceIdentity to prevent initialization and concurrency issues.

---

## 01108 — fix(mac): reflect agent activity in menu icon
**SHA:** c417517f43 · **Date:** 2025-12-12 17:20
**Files changed:** apps/macos/Sources/Clawdis/AppMain.swift
**Tags:** `bugfix`

Updates menu bar icon rendering to visually reflect current agent activity status.

---

## 01109 — fix(presence): hide cli sessions; use numeric mac build
**SHA:** 7dab927260 · **Date:** 2025-12-12 17:27
**Files changed:** apps/macos/Sources/Clawdis/InstancesStore.swift
**Tags:** `bugfix`

Filters out CLI sessions from presence display and switches macOS build numbering to numeric format for consistency.

---

## 01110 — fix(voice): persist WhatsApp last route
**SHA:** 6e9d3092a7 · **Date:** 2025-12-12 17:27
**Files changed:** src/web/auto-reply.test.ts
**Tags:** `bugfix`

Ensures WhatsApp last message route is persisted during voice wake auto-reply handling by updating route tracking for direct chats.

---

## 01111 — test(voice): cover gateway last-channel whatsapp
**SHA:** 957d7fbe2a · **Date:** 2025-12-12 17:29
**Files changed:** src/web/auto-reply.test.ts
**Tags:** `testing`

Adds test coverage for voice wake gateway last-channel routing when WhatsApp is the target delivery surface.

---

## 01112 — fix(mac): harden gateway frame decoding
**SHA:** 79818f73c0 · **Date:** 2025-12-12 17:30
**Files changed:** apps/macos/Sources/Clawdis/GatewayChannel.swift
**Tags:** `bugfix`

Improves robustness of gateway WebSocket frame decoding and error handling in the macOS gateway channel implementation.

---

## 01113 — fix(auto-reply): prefer Pi RPC by default
**SHA:** 0780859a4d · **Date:** 2025-12-12 17:30
**Files changed:** src/web/auto-reply.ts
**Tags:** `bugfix`

Sets Pi RPC as the preferred default backend for auto-reply command execution.

---

## 01114 — refactor(auto-reply): remove pi json fallback
**SHA:** bc618ec290 · **Date:** 2025-12-12 17:43
**Files changed:** src/web/auto-reply.ts
**Tags:** `refactor`

Removes deprecated JSON fallback for Pi RPC calls, requiring explicit RPC mode configuration.

---

## 01115 — fix(gateway): ack agent requests immediately
**SHA:** 62a7a07127 · **Date:** 2025-12-12 18:00
**Files changed:** src/gateway/dispatch.ts
**Tags:** `bugfix`

Ensures agent requests are acknowledged immediately upon receipt rather than waiting for processing completion.

---

## 01116 — fix(agent): send tau rpc prompt as string
**SHA:** e64ca7c583 · **Date:** 2025-12-12 17:46
**Files changed:** src/agents/tau.ts
**Tags:** `bugfix`

Corrects tau RPC prompt encoding to send as string type rather than object.

---

## 01117 — fix(mac): allow typing in web chat panel
**SHA:** 37eaa49e4c · **Date:** 2025-12-12 18:07
**Files changed:** apps/macos/Sources/Clawdis/WebView.swift
**Tags:** `bugfix`

Enables text input functionality in the macOS web chat panel by fixing WebView configuration.

---

## 01118 — style(test): biome format
**SHA:** 9ea697ac09 · **Date:** 2025-12-12 18:07
**Files changed:** src/web/auto-reply.test.ts
**Tags:** `cleanup`

Applies biome code formatting standards to test files.

---

## 01119 — fix(gateway): ignore stale lastTo for voice
**SHA:** 8ca240fb2c · **Date:** 2025-12-12 18:11
**Files changed:** src/gateway/dispatch.ts
**Tags:** `bugfix`

Prevents stale lastTo routing information from interfering with voice wake message delivery.

---

## 01120 — macOS: add --priority flag for time-sensitive notifications
**SHA:** c86cb4e9a5 · **Date:** 2025-12-12 18:27
**Files changed:** apps/macos/Sources/Clawdis/Notifications.swift
**Tags:** `core-feature`

Adds NotificationPriority enum with passive/active/timeSensitive levels that map to UNNotificationInterruptionLevel. timeSensitive priority breaks through Focus modes for urgent notifications.

---

## 01121 — fix(gateway): handle SIGTERM shutdown cleanly
**SHA:** 8fb3aef917 · **Date:** 2025-12-12 18:28
**Files changed:** src/gateway/server.ts
**Tags:** `bugfix`

Implements graceful SIGTERM signal handling in the gateway server to allow clean shutdown.

---

## 01122 — test(cli): verify gateway exits 0 on SIGTERM
**SHA:** 378e39d7ad · **Date:** 2025-12-12 18:30
**Files changed:** src/gateway/server.test.ts
**Tags:** `testing`

Adds test coverage verifying that the gateway exits cleanly with code 0 when receiving SIGTERM.

---

## 01123 — build(mac): enable time-sensitive notifications
**SHA:** 337ae05ed8 · **Date:** 2025-12-12 18:40
**Files changed:** apps/macos/Project.swift
**Tags:** `build`

Enables time-sensitive notification entitlements in macOS app build configuration.

---

## 01124 — refactor(mac): embed work badge in status icon
**SHA:** 241cf10bdb · **Date:** 2025-12-12 18:40
**Files changed:** apps/macos/Sources/Clawdis/IconRendering.swift
**Tags:** `refactor`

Refactors menu bar icon rendering to integrate work activity badge directly into the status icon.

---

## 01125 — fix(mac): serve webchat locally in remote mode
**SHA:** 7d37195c1a · **Date:** 2025-12-12 18:41
**Files changed:** apps/macos/Sources/Clawdis/AppMain.swift
**Tags:** `bugfix`

Enables local WebChat serving in remote control mode to support offline web chat access.

---

## 01126 — fix(mac): keep remote control tunnel alive
**SHA:** 8086c66ab8 · **Date:** 2025-12-12 18:44
**Files changed:** apps/macos/Sources/Clawdis/RemoteControl.swift
**Tags:** `bugfix`

Implements keepalive logic for remote control SSH tunnel to prevent unexpected disconnections.

---

## 01127 — fix(mac): treat timeSensitive as best-effort
**SHA:** d2158966db · **Date:** 2025-12-12 18:58
**Files changed:** apps/macos/Sources/Clawdis/Notifications.swift
**Tags:** `bugfix`

Treats time-sensitive notification priority as best-effort; gracefully degrades to active priority if not available.

---

## 01128 — fix(mac): disable restricted time-sensitive entitlement
**SHA:** e2ad0ed9f7 · **Date:** 2025-12-12 19:20
**Files changed:** apps/macos/Project.swift
**Tags:** `bugfix`

Removes overly restrictive time-sensitive notification entitlement to allow wider notification delivery.

---

## 01129 — fix(mac): ignore cancelled webchat navigations
**SHA:** 3f7fcad9ac · **Date:** 2025-12-12 19:20
**Files changed:** apps/macos/Sources/Clawdis/WebView.swift
**Tags:** `bugfix`

Prevents cancelled navigation requests from interrupting WebChat panel rendering.

---

## 01130 — fix(mac): open settings for microphone permission
**SHA:** bf41197b97 · **Date:** 2025-12-12 19:25
**Files changed:** apps/macos/Sources/Clawdis/PermissionHandler.swift
**Tags:** `bugfix`

Adds functionality to open system settings for microphone permission when voice wake requires it.

---

## 01131 — feat(mac): add overlay notification delivery
**SHA:** f1320b79ce · **Date:** 2025-12-12 19:27
**Files changed:** apps/macos/Sources/Clawdis/Notifications.swift
**Tags:** `core-feature`

Implements overlay notification delivery mechanism in macOS app for floating notification display.

---

## 01132 — Merge remote-tracking branch 'origin/main'
**SHA:** c0abab226d · **Date:** 2025-12-12 19:28
**Files changed:** multiple files
**Tags:** `process-lifecycle`

Merges latest upstream changes from origin/main branch.

---

## 01133 — feat(mac): add agent-controlled Canvas panel
**SHA:** 27a7d9f9d1 · **Date:** 2025-12-12 19:54
**Files changed:** apps/macos/Sources/Clawdis/CanvasPanel.swift
**Tags:** `core-feature`

Introduces agent-controlled Canvas panel for rendering rich content within the macOS app.

---

## 01134 — fix(mac): render Canvas HTML correctly
**SHA:** 4ecd35c275 · **Date:** 2025-12-12 20:01
**Files changed:** apps/macos/Sources/Clawdis/CanvasPanel.swift
**Tags:** `bugfix`

Fixes HTML rendering issues in Canvas panel to properly display agent-generated content.

---

## 01135 — fix(mac): add draggable/closable Canvas hover chrome
**SHA:** 893eef846d · **Date:** 2025-12-12 20:08
**Files changed:** apps/macos/Sources/Clawdis/CanvasPanel.swift
**Tags:** `bugfix`

Adds draggable title bar and close button controls to Canvas panel for improved UX.

---

## 01136 — fix(mac): keep Canvas below Voice Wake overlay
**SHA:** 08a473fb35 · **Date:** 2025-12-12 20:10
**Files changed:** apps/macos/Sources/Clawdis/AppMain.swift
**Tags:** `bugfix`

Ensures Canvas panel stays layered below Voice Wake overlay to maintain proper z-order.

---

## 01137 — fix(mac): keep voice wake listening
**SHA:** 356b6e0483 · **Date:** 2025-12-12 20:13
**Files changed:** apps/macos/Sources/Clawdis/VoiceWake.swift
**Tags:** `bugfix`

Maintains active voice wake listening state during Canvas and other UI interactions.

---

## 01138 — feat(mac): allow Canvas placement and resizing
**SHA:** 296c0a6b70 · **Date:** 2025-12-12 20:28
**Files changed:** apps/macos/Sources/Clawdis/CanvasPanel.swift
**Tags:** `core-feature`

Implements user-driven Canvas panel placement and resizing with drag and resize handles.

---

## 01139 — fix(mac): persist Canvas frame across reopen
**SHA:** 327f6e7e25 · **Date:** 2025-12-12 20:33
**Files changed:** apps/macos/Sources/Clawdis/CanvasPanel.swift
**Tags:** `bugfix`

Saves and restores Canvas panel frame position and size when reopening the application.

---

## 01140 — feat(macos): enlarge tool-use badge
**SHA:** 6b4141247e · **Date:** 2025-12-12 20:45
**Files changed:** apps/macos/Sources/Clawdis/IconRendering.swift
**Tags:** `core-feature`

Increases visual prominence of the tool-use activity badge in the menu bar icon.

---

## 01141 — fix(gateway): don't let webchat clobber last route
**SHA:** aae49f1d68 · **Date:** 2025-12-12 21:00
**Files changed:** src/gateway/dispatch.ts
**Tags:** `bugfix`

Prevents WebChat interactions from overwriting the last used message routing surface.

---

## 01142 — fix(macos): show tool-use badge glyph
**SHA:** e3b50b7d12 · **Date:** 2025-12-12 21:02
**Files changed:** apps/macos/Sources/Clawdis/IconRendering.swift
**Tags:** `bugfix`

Ensures tool-use badge glyph displays correctly in menu bar icon.

---

## 01143 — fix(gateway): treat webchat last as whatsapp
**SHA:** 211efffa10 · **Date:** 2025-12-12 21:05
**Files changed:** src/gateway/dispatch.ts
**Tags:** `bugfix`

Routes WebChat messages through WhatsApp as the default surface for message delivery consistency.

---

## 01144 — feat(mac): add rolling diagnostics log
**SHA:** b9007dc721 · **Date:** 2025-12-12 20:46
**Files changed:** apps/macos/Sources/Clawdis/DiagnosticsLog.swift
**Tags:** `core-feature`

Implements rolling diagnostic logging system in macOS app for debugging and troubleshooting.

---

## 01145 — feat(bridge): add Bonjour node bridge
**SHA:** 0b532579d8 · **Date:** 2025-12-12 21:18
**Files changed:** src/bridge/bonjour.ts
**Tags:** `core-feature`

Introduces Bonjour-based node bridge for local network discovery and communication between devices.

---

## 01146 — feat(ios): add ClawdisNode app scaffold
**SHA:** 6d6c3ad2c4 · **Date:** 2025-12-12 21:18
**Files changed:** apps/ios/Sources/ClawdisNode.swift
**Tags:** `core-feature`

Establishes basic iOS app structure and scaffolding for ClawdisNode companion application.

---

## 01147 — feat(ios): add settings UI
**SHA:** 1d41129b6c · **Date:** 2025-12-12 21:19
**Files changed:** apps/ios/Sources/SettingsView.swift
**Tags:** `core-feature`

Implements settings interface for iOS ClawdisNode app with configuration options.

---

## 01148 — fix(mac): keep voice overlay above canvas
**SHA:** ce8db12b22 · **Date:** 2025-12-12 21:26
**Files changed:** apps/macos/Sources/Clawdis/AppMain.swift
**Tags:** `bugfix`

Ensures Voice Wake overlay remains on top of all UI layers including Canvas panel.

---

## 01149 — fix(macos): share gateway websocket connection
**SHA:** e944a0239d · **Date:** 2025-12-12 21:34
**Files changed:** apps/macos/Sources/Clawdis/GatewayChannel.swift
**Tags:** `bugfix`

Optimizes gateway communication by sharing WebSocket connection across multiple components.

---

## 01150 — fix(mac): avoid double-trigger voice wake
**SHA:** de2e341947 · **Date:** 2025-12-12 21:37
**Files changed:** apps/macos/Sources/Clawdis/VoiceWake.swift
**Tags:** `bugfix`

Prevents accidental double-triggering of voice wake when voice input is detected.
