# Commit Reference: 00951–01000

A plain factual summary of every commit in the OpenClaw repository, from commit 951 through commit 1000.

---

## 00951 — mac: show local gateway path when overridden
**SHA:** 577b0dfe1d · **Date:** 2025-12-09 18:46
**Files changed:** apps/macos/Sources/Clawdis/GatewayEnvironment.swift
**Tags:** `ux`

Displays the local gateway path in the status message when a project-specific entrypoint overrides the global binary. Adds a hint showing the resolved path for debugging local gateway configurations.

---

## 00952 — fix(ptt): dismiss empty overlay immediately on key up
**SHA:** 474cb48a14 · **Date:** 2025-12-09 19:48
**Files changed:** apps/macos/Sources/Clawdis/GatewayProcessManager.swift, apps/macos/Sources/Clawdis/VoicePushToTalk.swift
**Tags:** `bugfix`, `ux`

Fixes push-to-talk behavior to dismiss the overlay immediately when the key is released if no audio was captured. Previously waited for a timeout even when no speech was recorded, causing unnecessary UI delay.

---

## 00953 — fix(overlay): dismiss on token mismatch; keep gateway log clear helper
**SHA:** 239f58b584 · **Date:** 2025-12-09 19:50
**Files changed:** apps/macos/Sources/Clawdis/GatewayProcessManager.swift, apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift
**Tags:** `bugfix`, `refactor`

Adds explicit overlay dismissal when session tokens diverge to prevent stale UI state. Retains the gateway log clear helper method that was mistakenly removed in the previous commit.

---

## 00954 — test(overlay): cover token guard outcomes
**SHA:** b11b33b63c · **Date:** 2025-12-09 19:51
**Files changed:** apps/macos/Sources/Clawdis/VoiceWakeOverlay.swift, apps/macos/Tests/ClawdisIPCTests/VoiceWakeOverlayTests.swift
**Tags:** `testing`, `refactor`

Refactors token guard logic into a testable function that returns explicit outcomes (accept, dismiss, drop). Adds unit tests covering all three token validation paths including missing active token and mismatched tokens.

---

## 00955 — feat(mac): reuse running gateway
**SHA:** 85ca2152e4 · **Date:** 2025-12-09 19:00
**Files changed:** apps/macos/Sources/Clawdis/CritterStatusLabel.swift, apps/macos/Sources/Clawdis/GatewayProcessManager.swift, apps/macos/Sources/Clawdis/GeneralSettings.swift
**Tags:** `core-feature`, `optimization`

Implements gateway reuse by attempting to connect to an existing gateway instance via health probe before spawning a new process. Adds `attachedExisting` status state showing connection details including port, link status, and auth age.

---

## 00956 — mac: fix actor call and label warnings
**SHA:** a7d39913fd · **Date:** 2025-12-09 19:00
**Files changed:** apps/macos/Sources/Clawdis/GatewayEnvironment.swift
**Tags:** `bugfix`

Fixes Swift compiler warnings by removing explicit return statements in status label switch cases. Minor cleanup of label generation code.

---

## 00957 — mac: fix local path string
**SHA:** 848180dc08 · **Date:** 2025-12-09 19:00
**Files changed:** apps/macos/Sources/Clawdis/GatewayEnvironment.swift
**Tags:** `bugfix`

Corrects string interpolation for the local gateway path hint by properly accessing the path property with fallback handling. Fixes display of project entrypoint location.

---

## 00958 — mac: fix gateway hello types
**SHA:** c41b506741 · **Date:** 2025-12-09 19:01
**Files changed:** apps/macos/Sources/Clawdis/GatewayChannel.swift, apps/macos/Sources/Clawdis/GatewayEnvironment.swift
**Tags:** `type-safety`, `refactor`

Replaces JSONSerialization with JSONEncoder/Decoder for gateway hello handshake to avoid Objective-C bridging issues. Introduces strongly-typed Hello and HelloOk structs with proper AnyCodable wrapping for protocol parameters.

---

## 00959 — gateway: enforce hello order and modern json
**SHA:** ab9b12e883 · **Date:** 2025-12-09 19:09
**Files changed:** apps/macos/Sources/Clawdis/GatewayChannel.swift, src/gateway/server.ts
**Tags:** `refactor`, `bugfix`

Ensures gateway clients are added to the broadcast list only after hello-ok is sent to prevent premature tick/presence events. Migrates request encoding to use generated protocol models instead of JSONSerialization for type safety.

---

## 00960 — gateway: log provider errors verbosely
**SHA:** c683ae69af · **Date:** 2025-12-09 19:10
**Files changed:** src/gateway/server.ts
**Tags:** `verbosity`

Adds formatError helper function that extracts detailed error information including status codes, error codes, and full JSON dumps. Improves provider exit logging for web and telegram to show actionable error details.

---

## 00961 — fix(mac): encode gateway params with protocol AnyCodable
**SHA:** 6ae4c49c1a · **Date:** 2025-12-09 19:10
**Files changed:** apps/macos/Sources/Clawdis/GatewayChannel.swift
**Tags:** `bugfix`, `type-safety`

Fixes request parameter encoding by using the protocol's AnyCodable type consistently throughout the request frame construction. Adds type alias to avoid ambiguity with the app's own AnyCodable implementation.

---

## 00962 — chore(mac): dedupe local gateway label
**SHA:** 0bf9a87293 · **Date:** 2025-12-09 19:13
**Files changed:** apps/macos/Sources/Clawdis/GatewayEnvironment.swift
**Tags:** `refactor`

Eliminates duplicate "(local)" text in gateway status messages by conditionally showing either the label or the full path hint. Improves readability when using project-local gateway binaries.

---

## 00963 — chore(mac): add divider before session toggles
**SHA:** 6329f60dff · **Date:** 2025-12-09 19:14
**Files changed:** apps/macos/Sources/Clawdis/AppMenu.swift
**Tags:** `ux`

Adds visual separator in the macOS menu before session toggle controls to improve menu organization and visual hierarchy.

---

## 00964 — fix: enforce gateway single instance
**SHA:** 5df438fd2a · **Date:** 2025-12-09 19:40
**Files changed:** apps/macos/Sources/Clawdis/GatewayProcessManager.swift, src/cli/program.ts, src/gateway/server.ts, src/infra/gateway-lock.ts
**Tags:** `bugfix`, `core-feature`

Implements Unix domain socket locking to guarantee only one gateway instance runs at a time. The macOS app acquires the same lock the CLI uses, preventing duplicate gateway processes and connection conflicts.

---

## 00965 — telegram: show name and id in envelope
**SHA:** 0de944be28 · **Date:** 2025-12-09 19:56
**Files changed:** README.md, src/telegram/bot.test.ts, src/telegram/bot.ts
**Tags:** `core-feature`, `documentation`

Enriches Telegram message envelopes to include user's full name and username alongside the numeric ID. Format changes from `[Telegram telegram:123456789]` to `[Telegram Ada Lovelace (@ada_bot) id:123456789]` for better context awareness.

---

## 00966 — gateway: improve conflict handling and logging
**SHA:** 5e5845547e · **Date:** 2025-12-09 20:07
**Files changed:** src/gateway/server.ts, src/infra/gateway-lock.ts
**Tags:** `ux`, `verbosity`

Enhances gateway lock conflict messages to suggest using the force flag and provides clearer error reporting when another instance is already bound to the port.

---

## 00967 — Menu: add more debug utilities
**SHA:** 1a0e57d926 · **Date:** 2025-12-09 21:06
**Files changed:** apps/macos/Sources/Clawdis/AppMenu.swift
**Tags:** `ux`

Expands the debug submenu with additional utilities for development and troubleshooting in the macOS menu bar app.

---

## 00968 — fix(mac): harden gateway lock and ip decoding
**SHA:** d33a3f619a · **Date:** 2025-12-09 20:12
**Files changed:** apps/macos/Sources/Clawdis/GatewayProcessManager.swift
**Tags:** `bugfix`

Improves gateway lock robustness by ensuring proper socket cleanup and adds fallback handling for IP address decoding in health snapshots.

---

## 00969 — gateway: drop ipc and simplify cli
**SHA:** 131864b940 · **Date:** 2025-12-09 20:18
**Files changed:** apps/macos/Sources/Clawdis/HealthStore.swift, apps/macos/Tests/ClawdisIPCTests/HealthDecodeTests.swift, docs/gateway.md, docs/refactor/new-arch.md, src/cli/program.ts
**Tags:** `refactor`, `documentation`

Removes IPC socket checks from health validation since the WebSocket gateway architecture no longer requires Unix domain sockets for client-gateway communication. Updates documentation to reflect simplified CLI command structure.

---

## 00970 — chore: drop gateway ipc remnants
**SHA:** a76d00a08e · **Date:** 2025-12-09 20:21
**Files changed:** src/infra/ipc.ts, src/gateway/server.ts
**Tags:** `refactor`

Completes IPC removal by deleting unused IPC infrastructure code and references from the gateway server initialization.

---

## 00971 — Menu: add icons to debug submenu
**SHA:** 8265829105 · **Date:** 2025-12-09 21:24
**Files changed:** apps/macos/Sources/Clawdis/AppMenu.swift
**Tags:** `ux`

Adds SF Symbols icons to debug submenu items in the macOS menu for improved visual identification of debug functions.

---

## 00972 — cli: gateway subcommands, drop ipc probes
**SHA:** e84ed61339 · **Date:** 2025-12-09 20:26
**Files changed:** src/cli/program.ts
**Tags:** `refactor`

Restructures gateway CLI commands into proper subcommands (health, status, send, agent, call) and removes obsolete IPC probe functionality from the command structure.

---

## 00973 — docs: refresh gateway cli params
**SHA:** c35f9c1315 · **Date:** 2025-12-09 20:28
**Files changed:** docs/gateway.md
**Tags:** `documentation`

Updates gateway documentation to reflect the new subcommand syntax and documents the spawn-gateway flag that allows CLI commands to start a local gateway when needed.

---

## 00974 — mac: left-click webchat panel
**SHA:** ad5c7d97ca · **Date:** 2025-12-09 21:29
**Files changed:** apps/macos/Sources/Clawdis/AppMenu.swift
**Tags:** `ux`

Enables left-click on the menu bar icon to toggle the webchat panel, providing quick access to the chat interface without navigating through menu items.

---

## 00975 — Debug menu: session controls and thinking/verbose
**SHA:** f34b238713 · **Date:** 2025-12-09 21:32
**Files changed:** apps/macos/Sources/Clawdis/AppMenu.swift
**Tags:** `ux`

Adds session management controls and thinking/verbose mode toggles to the debug menu for easier testing and development workflow.

---

## 00976 — web: reuse active listener for sends
**SHA:** 5a8d18edf3 · **Date:** 2025-12-09 20:33
**Files changed:** src/provider-web.ts
**Tags:** `optimization`

Optimizes web provider to reuse the existing webhook listener for send operations instead of creating new connections, reducing overhead and connection churn.

---

## 00977 — chore(mac): include os version and locale in handshake
**SHA:** 5e4f32d808 · **Date:** 2025-12-09 20:35
**Files changed:** apps/macos/Sources/Clawdis/GatewayChannel.swift
**Tags:** `core-feature`

Extends gateway hello handshake to include macOS version and locale information for improved telemetry and context awareness in the gateway connection metadata.

---

## 00978 — chore(gateway): color ws direction logs
**SHA:** a8baf0ef45 · **Date:** 2025-12-09 20:36
**Files changed:** src/gateway/server.ts
**Tags:** `verbosity`

Adds color coding to WebSocket message direction logs (send/receive) to make gateway traffic easier to trace and debug in verbose mode.

---

## 00979 — Debug menu: add sessions icon and separator
**SHA:** 9131a69983 · **Date:** 2025-12-09 21:40
**Files changed:** apps/macos/Sources/Clawdis/AppMenu.swift
**Tags:** `ux`

Adds SF Symbols icon to session controls in the debug menu and includes a visual separator to improve menu structure and usability.

---

## 00980 — mac: panel highlight when webchat open
**SHA:** 6675c273fd · **Date:** 2025-12-09 21:41
**Files changed:** apps/macos/Sources/Clawdis/AppMenu.swift, apps/macos/Sources/Clawdis/CritterStatusLabel.swift
**Tags:** `ux`

Highlights the menu bar icon when the webchat panel is open to provide visual feedback about the active state of the chat interface.

---

## 00981 — mac: harden webchat panel
**SHA:** 510552c5e6 · **Date:** 2025-12-09 21:43
**Files changed:** apps/macos/Sources/Clawdis/WebChatPanel.swift
**Tags:** `bugfix`

Improves webchat panel stability by adding null checks and proper lifecycle management to prevent crashes when the panel is opened or closed.

---

## 00982 — mac icon: render 36px retina backing
**SHA:** 06fdfc2e14 · **Date:** 2025-12-09 21:56
**Files changed:** apps/macos/Sources/Clawdis/CritterStatusLabel.swift
**Tags:** `ux`

Increases menu bar icon rendering resolution to 36px with retina backing for sharper display on high-DPI screens. Improves visual quality of the critter animation.

---

## 00983 — mac: disable status rows in menu
**SHA:** 0377d13d3d · **Date:** 2025-12-09 21:59
**Files changed:** apps/macos/Sources/Clawdis/AppMenu.swift
**Tags:** `ux`

Disables status display rows in the menu to prevent accidental clicks while still showing information. Prepares for conversion to proper disabled menu items.

---

## 00984 — mac: make status rows disabled menu items
**SHA:** a032614dc7 · **Date:** 2025-12-09 22:02
**Files changed:** apps/macos/Sources/Clawdis/AppMenu.swift
**Tags:** `ux`

Converts status rows to proper disabled menu items in SwiftUI, allowing them to display information while being non-interactive and properly styled.

---

## 00985 — mac: add gateway reconnect watchdog
**SHA:** 3ee3f7e30b · **Date:** 2025-12-09 21:07
**Files changed:** apps/macos/Sources/Clawdis/GatewayChannel.swift
**Tags:** `process-lifecycle`

Implements watchdog timer to detect and recover from stalled gateway connections. Monitors heartbeat ticks and automatically reconnects when the connection becomes unresponsive.

---

## 00986 — feat(webchat): auto-start at root
**SHA:** bd41cf377a · **Date:** 2025-12-09 21:07
**Files changed:** docs/mac/webchat.md, docs/webchat.md, src/cli/program.test.ts, src/cli/program.ts, src/webchat/server.ts
**Tags:** `core-feature`, `documentation`

Changes webchat to serve UI at the root path (/) instead of /webchat/ for cleaner URLs. Gateway now auto-starts webchat server when launched, with legacy /webchat/ paths still supported for backward compatibility.

---

## 00987 — fix(mac): keep ptt overlay until release
**SHA:** 978a24ffab · **Date:** 2025-12-09 22:06
**Files changed:** apps/macos/Sources/Clawdis/VoicePushToTalk.swift
**Tags:** `bugfix`

Fixes push-to-talk overlay dismissal timing to ensure the UI remains visible until the key is fully released, preventing premature disappearance during speech input.

---

## 00988 — fix(mac): snap critter drawing to pixels
**SHA:** 89d856a487 · **Date:** 2025-12-09 22:08
**Files changed:** apps/macos/Sources/Clawdis/CritterStatusLabel.swift
**Tags:** `bugfix`, `ux`

Aligns critter icon drawing to pixel boundaries to eliminate blurriness and rendering artifacts on retina displays. Ensures crisp icon rendering.

---

## 00989 — fix(mac): disable smoothing and await watchdog
**SHA:** 7919019b67 · **Date:** 2025-12-09 22:09
**Files changed:** apps/macos/Sources/Clawdis/CritterStatusLabel.swift, apps/macos/Sources/Clawdis/GatewayChannel.swift
**Tags:** `bugfix`

Disables image smoothing for pixel-perfect icon rendering and ensures watchdog initialization completes before connection attempts. Fixes timing issues in gateway connection lifecycle.

---

## 00990 — chore(webchat): log url on gateway start
**SHA:** be3326d0d9 · **Date:** 2025-12-09 21:10
**Files changed:** src/cli/program.ts
**Tags:** `verbosity`

Logs the webchat server URL when the gateway starts so users can easily access the web interface without guessing the port or path.

---

## 00991 — mac: respect webchat disabled for left click
**SHA:** f49934a75b · **Date:** 2025-12-09 22:11
**Files changed:** apps/macos/Sources/Clawdis/AppMenu.swift
**Tags:** `bugfix`

Prevents left-click from attempting to open the webchat panel when webchat is explicitly disabled in configuration, avoiding errors and improving UX consistency.

---

## 00992 — fix: relaunch app after debug restart
**SHA:** c191df5434 · **Date:** 2025-12-09 22:13
**Files changed:** apps/macos/Sources/Clawdis/AppDelegate.swift
**Tags:** `bugfix`

Ensures the macOS app properly relaunches itself after using the debug menu restart command, completing the full restart cycle without leaving the app in a stopped state.

---

## 00993 — mac/webchat: remove panel padding
**SHA:** 84ccde268e · **Date:** 2025-12-09 21:13
**Files changed:** apps/macos/Sources/Clawdis/WebChatPanel.swift
**Tags:** `ux`

Removes default padding from the webchat panel to maximize usable chat area and provide edge-to-edge content display in the panel window.

---

## 00994 — feat(telegram): add typing cue
**SHA:** 8489907cf5 · **Date:** 2025-12-09 21:13
**Files changed:** src/telegram/bot.test.ts, src/telegram/bot.ts
**Tags:** `core-feature`

Implements typing indicator in Telegram by sending the "typing" chat action when the agent starts processing a message. Improves user feedback by showing activity during response generation.

---

## 00995 — feat(webchat): sync theme with system
**SHA:** fce9ded30a · **Date:** 2025-12-09 21:22
**Files changed:** apps/macos/Sources/Clawdis/Resources/WebChat/bootstrap.js
**Tags:** `core-feature`, `ux`

Adds automatic theme synchronization between the webchat UI and system appearance settings. Listens for macOS theme changes and updates the UI dark/light mode in real-time.

---

## 00996 — chore: remove legacy rpc command
**SHA:** 6129924eb2 · **Date:** 2025-12-09 21:28
**Files changed:** src/cli/program.ts
**Tags:** `refactor`

Removes obsolete RPC command from the CLI that has been superseded by the gateway architecture. Completes migration away from the legacy RPC loop pattern.

---

## 00997 — chore(mac): add separator before general toggles
**SHA:** 2339f1a01d · **Date:** 2025-12-09 21:28
**Files changed:** apps/macos/Sources/Clawdis/AppMenu.swift
**Tags:** `ux`

Adds visual separator in the macOS menu before general settings toggles to improve menu organization and group related controls together.

---

## 00998 — mac: clear highlight on panel close
**SHA:** d5517ede45 · **Date:** 2025-12-09 22:40
**Files changed:** apps/macos/Sources/Clawdis/CritterStatusLabel.swift
**Tags:** `bugfix`, `ux`

Removes menu bar icon highlight when the webchat panel is closed to properly reflect the inactive state and provide accurate visual feedback.

---

## 00999 — fix(mac): keep webchat panel alive
**SHA:** f83eeac5e2 · **Date:** 2025-12-09 21:42
**Files changed:** apps/macos/Sources/Clawdis/WebChatPanel.swift
**Tags:** `bugfix`

Fixes webchat panel lifecycle to prevent premature deallocation when the panel is backgrounded or loses focus. Ensures panel stays responsive across window management operations.

---

## 01000 — fix: prevent stuck mac health checks
**SHA:** 42c3c2b804 · **Date:** 2025-12-09 21:52
**Files changed:** apps/macos/Sources/Clawdis/HealthStore.swift
**Tags:** `bugfix`

Adds timeout and error handling to health check requests to prevent the macOS app from blocking indefinitely when the gateway is unresponsive or unreachable.

---
