# Commit Reference: 00101–00150

A plain factual summary of every commit in the OpenClaw repository, from commit 101 through commit 150.

---

## 00101 — docs: add image send quickstart
**SHA:** d67bc6d195 · **Time:** 04:58
**Files changed:** README.md
**Tags:** `documentation`

Adds a new section to the README documenting the image send feature. Details how to send images via Twilio with `--media` and `--serve-media` flags for hosting up to 5 MB files, via Web provider with local paths or URLs, and configures auto-reply media attachments via `mediaUrl` in the configuration file.

---

## 00102 — chore: log web media sends
**SHA:** 35d7fe7fc7 · **Time:** 05:09
**Files changed:** src/provider-web.ts
**Tags:** `provider`, `verbosity`

Adds explicit logging when sending messages via the Web provider to indicate if media is being attached. Logs the target JID and appends "(media)" notation when a media URL is present in the send options.

---

## 00103 — chore: add connection/send logs and web error surfacing
**SHA:** a9533d0999 · **Time:** 05:10
**Files changed:** src/commands/send.ts, src/provider-web.ts
**Tags:** `provider`, `verbosity`, `ux`

Improves Web provider logging and error handling. Adds connection logging message before awaiting WhatsApp Web socket, and wraps the `sendMessageWeb` call in a `.catch()` handler to surface send failures with clear error output to the user.

---

## 00104 — ci: pin Node to 22.11.0 and print version
**SHA:** a1fab23439 · **Time:** 05:16
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Updates CI workflow to pin Node.js to version 22.11.0 instead of the floating 22 major version, and adds an explicit "Node version" step that runs `node -v` to verify the installed version before proceeding with the build.

---

## 00105 — feat: download inbound media and expose to templating
**SHA:** 6d41df2941 · **Time:** 05:17
**Files changed:** src/auto-reply/templating.ts, src/index.core.test.ts
**Tags:** `core-feature`, `testing`

Extends the template context to include media metadata fields for inbound messages: `MediaPath`, `MediaUrl`, and `MediaType`. Adds test coverage verifying that template variables correctly reference downloaded media information when auto-replies use these fields.

---

## 00106 — chore: surface media URL in command prompts and tests
**SHA:** 54c763a679 · **Time:** 05:20
**Files changed:** src/auto-reply/reply.ts, src/index.core.test.ts
**Tags:** `auto-reply`, `testing`

Extracts media URLs from command stdout using a regex pattern matching "MEDIA:" lines, and prepends a media note to command prompts so that command invocations (like Claude) receive media context. Updates tests to verify media URL extraction and proper templating with media fields.

---

## 00107 — test: cover media url extraction from command stdout
**SHA:** f4c5f2c193 · **Time:** 05:21
**Files changed:** src/index.core.test.ts
**Tags:** `testing`

Adds a specific test case validating that when a command outputs "MEDIA: <url>" on a line, warelay correctly extracts the URL and returns it as `mediaUrl` in the reply object, while stripping the media line from the text response.

---

## 00108 — fix: harden MEDIA parsing and add tests
**SHA:** 9bf35d3272 · **Time:** 05:25
**Files changed:** src/auto-reply/reply.ts, src/index.core.test.ts
**Tags:** `bugfix`, `testing`

Improves MEDIA token parsing robustness by implementing smarter validation: only accepts URLs (http/https) or file paths (absolute or relative with /./), rejects whitespace-containing tokens, and enforces a 1024-character limit. Adds test coverage for edge cases and invalid patterns.

---

## 00109 — fix: accept file/media tokens safely and improve web media send
**SHA:** 5ce869f86c · **Time:** 05:34
**Files changed:** src/auto-reply/reply.ts
**Tags:** `bugfix`, `provider`

Refines media token normalization by accepting inline MEDIA tokens (e.g., within a sentence) via a more flexible regex, introduces `normalizeMediaSource()` to strip "file://" prefixes, and validates both URLs and file paths. Improves Web provider error handling and logging around media sends with try-catch and size reporting.

---

## 00110 — ci: use available Node 22.21.1
**SHA:** 4d90270886 · **Time:** 05:35
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Updates the CI workflow Node.js version from 22.11.0 to 22.21.1, a minor update reflecting a more recent patch version available in the setup-node action manifest.

---

## 00111 — ci: pin Node to 22.9.0 (available in setup-node manifest)
**SHA:** dc0014b85d · **Time:** 05:37
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Downgrades Node.js version in CI to 22.9.0, reverting to an earlier patch that is documented as available in the setup-node manifest. Indicates a resolution to a compatibility or availability issue with later versions.

---

## 00112 — ci: fix pnpm cache path for setup-node
**SHA:** 87a42fcdce · **Time:** 05:39
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Adds the `cache-dependency-path: pnpm-lock.yaml` configuration to the setup-node action, explicitly pointing to the pnpm lock file for cache invalidation. Ensures the CI cache key is properly tied to dependency changes.

---

## 00113 — ci: fall back to Node 20.18.0 (setup-node supported)
**SHA:** 045a138b1b · **Time:** 05:40
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Downgrades Node.js to 20.18.0 as a fallback, suggesting troubleshooting with earlier Node versions to resolve CI instability or compatibility issues with newer 22.x patches.

---

## 00114 — ci: drop setup-node (use runner Node)
**SHA:** 11a486400f · **Time:** 05:42
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Removes the entire `actions/setup-node` action from the workflow, relying instead on the default Node.js pre-installed on the GitHub Actions runner. Simplifies the CI configuration by eliminating the setup step.

---

## 00115 — ci: ensure pnpm on PATH before install
**SHA:** df6954541e · **Time:** 05:45
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Modifies the install step to explicitly set PNPM_HOME and prepend it to the PATH before running `pnpm install`. Ensures pnpm is discoverable in the shell environment during the install command.

---

## 00116 — ci: rely on pnpm/action-setup defaults for PNPM_HOME
**SHA:** f2438f82ab · **Time:** 05:46
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Simplifies the install step by removing explicit PNPM_HOME and PATH export, relying instead on the pnpm/action-setup action to set sensible defaults for the environment. Reduces boilerplate in the CI configuration.

---

## 00117 — feat: add relay:tmux helper for relay watcher
**SHA:** 729ae64822 · **Time:** 05:47
**Files changed:** src/cli/program.ts, src/cli/relay_tmux.ts
**Tags:** `core-feature`, `ux`

Introduces a new CLI command `relay:tmux` that spawns and manages a dedicated tmux session called "warelay-relay" running the relay watcher with verbose output. Creates a new `relay_tmux.ts` module with session lifecycle management including spawning and killing sessions.

---

## 00118 — fix: handle inline MEDIA tokens and host webhook media
**SHA:** 6883c3ae4a · **Time:** 05:47
**Files changed:** src/auto-reply/reply.ts
**Tags:** `bugfix`, `core-feature`

Refactors MEDIA token detection to support inline usage (not just line-start) by switching from `^MEDIA:` to `\bMEDIA:` word-boundary matching. Improves validation logic to check URLs and paths upfront before processing, and enhances Web provider media send with try-catch, size logging, and fallback error handling.

---

## 00119 — ci: install pnpm via npm instead of action
**SHA:** 5291cb0dc2 · **Time:** 05:47
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Replaces the `pnpm/action-setup` action with a direct npm install command (`npm install -g pnpm@10.23.0`). Streamlines the CI by eliminating an action dependency and directly installing pnpm as a global npm package.

---

## 00120 — chore: attach when starting relay tmux session
**SHA:** bafaed37fe · **Time:** 05:48
**Files changed:** src/cli/program.ts, src/cli/relay_tmux.ts
**Tags:** `ux`

Updates the `relay:tmux` command to automatically attach to the tmux session after creating it. Modifies `spawnRelayTmux()` to accept an `attach` parameter and calls `tmux attach` if true, improving ergonomics by dropping the user directly into the session.

---

## 00121 — refactor: extract MEDIA parsing helper and tidy whitespace
**SHA:** 072998a6ab · **Time:** 05:49
**Files changed:** src/auto-reply/reply.ts
**Tags:** `refactor`

Moves MEDIA token parsing logic into a new `media/parse.ts` helper module with exported functions `normalizeMediaSource()` and `splitMediaFromOutput()`. Removes inline parsing code from reply.ts and tidies whitespace throughout, centralizing media handling logic.

---

## 00122 — feat: add relay:tmux:attach to join existing session
**SHA:** 071786fe16 · **Time:** 05:53
**Files changed:** src/cli/program.ts, src/cli/relay_tmux.ts
**Tags:** `core-feature`, `ux`

Adds a new `relay:tmux:attach` command that joins an existing warelay-relay tmux session without restarting it. Updates `spawnRelayTmux()` to accept a `restart` parameter, allowing users to re-attach to a running relay without interrupting it.

---

## 00123 — docs: compact auto-reply parameter table
**SHA:** 20cc4e0ebf · **Time:** 05:54
**Files changed:** README.md
**Tags:** `documentation`

Refactors the auto-reply configuration parameter documentation in the README to make it more compact and readable, likely consolidating lengthy descriptions or reorganizing table layout for clarity.

---

## 00124 — ci: manually install Node 22.9.0 and run pnpm
**SHA:** 865abcf1f5 · **Time:** 05:58
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Moves away from the setup-node action entirely by adding a custom step that downloads and extracts Node.js 22.9.0 from nodejs.org directly into a temp directory, then prepends it to PATH. Provides explicit version control without relying on GitHub's setup-node action.

---

## 00125 — fix: keep MEDIA tokens with punctuation and log web media failures
**SHA:** 8ea7f9b439 · **Time:** 06:02
**Files changed:** src/media/parse.ts, src/provider-web.ts
**Tags:** `bugfix`, `verbosity`

Updates the MEDIA token regex to allow optional backticks around tokens (e.g., `` MEDIA:`/tmp/pic.png` ``), capturing the core token while stripping wrapping backticks. Adds fallback error logging in the Web provider when media sends fail, improving debuggability.

---

## 00126 — test: cover MEDIA backticks and web media fallback logging
**SHA:** 9fbeb2ccd3 · **Time:** 06:04
**Files changed:** src/index.core.test.ts, src/provider-web.test.ts
**Tags:** `testing`

Adds test cases covering MEDIA tokens wrapped in backticks and validates that the core path is correctly extracted. Also tests Web provider fallback logging when auto-reply media loads fail, ensuring the error surface is tested.

---

## 00127 — fix: strip trailing punctuation from MEDIA tokens and add tests
**SHA:** ad55832cda · **Time:** 06:07
**Files changed:** src/index.core.test.ts, src/media/parse.ts
**Tags:** `bugfix`, `testing`

Refines the MEDIA token regex and validation logic to strip trailing JSON-like punctuation (e.g., `"}`) from captured tokens. Adds test coverage for tokens with trailing JSON characters, ensuring robustness when Claude or other tools output JSON with MEDIA references.

---

## 00128 — debug: log MEDIA extraction and parse Claude text for tokens
**SHA:** 49bf1fadb6 · **Time:** 06:14
**Files changed:** src/auto-reply/reply.ts
**Tags:** `verbosity`

Adds verbose logging to report whether MEDIA tokens were extracted from command stdout and details about the parse result. Improves debugging visibility when handling Claude CLI command outputs or other text that contains media references.

---

## 00129 — docs: remind to restart relay in tmux after code changes
**SHA:** d33d95318 · **Time:** 06:14
**Files changed:** README.md
**Tags:** `documentation`

Adds a reminder to the README documentation advising users to restart the relay in tmux when making code changes, since the tmux session may be running stale code. Encourages developers to kill and re-spawn the session to pick up updates.

---

## 00130 — ci: force PATH to custom Node 22.21.1 before pnpm
**SHA:** 9f952f3ab8 · **Time:** 06:17
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Updates the CI workflow to upgrade the manually-downloaded Node.js to version 22.21.1 and explicitly echoes the version before running pnpm install, ensuring the correct Node binary is used throughout the workflow.

---

## 00131 — refactor: simplify MEDIA parsing, drop invalid lines, keep valid tokens
**SHA:** d925d9849c · **Time:** 06:17
**Files changed:** src/auto-reply/reply.ts
**Tags:** `refactor`

Refactors MEDIA parsing in reply.ts to use the extracted `splitMediaFromOutput()` helper from media/parse.ts, removing the inline parsing logic. Simplifies the reply flow by delegating validation (URLs, paths, whitespace, length checks) to the dedicated helper, keeping valid tokens and dropping invalid lines.

---

## 00132 — ci: use setup-node 22.9.0 and pnpm action
**SHA:** 5b17aba4fc · **Time:** 06:21
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Returns to using the `actions/setup-node` action with Node.js 22.9.0, and brings back the `pnpm/action-setup` action for pnpm installation. Reverses the manual Node installation approach in favor of the standard GitHub Actions tools.

---

## 00133 — auto-reply: handle empty stdout gracefully
**SHA:** 716f31f17a · **Time:** 06:33
**Files changed:** src/auto-reply/reply.ts
**Tags:** `bugfix`

Improves auto-reply handling to gracefully deal with commands that produce empty stdout (empty reply text and no media). Ensures the reply flow does not crash or produce malformed output when a command returns nothing.

---

## 00134 — web: send read receipts for inbound messages
**SHA:** a331bd5ea1 · **Time:** 06:36
**Files changed:** src/provider-web.test.ts
**Tags:** `provider`, `core-feature`

Adds automatic read-receipt functionality to the Web provider. When receiving messages, warelay now calls `sock.readMessages()` to mark them as read in WhatsApp. Tests verify this behavior for both individual and group messages with proper JID formatting.

---

## 00135 — claude: prefix prompt with Clawd identity
**SHA:** 0adc0ed7a6 · **Time:** 06:41
**Files changed:** src/auto-reply/claude.ts, src/auto-reply/reply.ts
**Tags:** `auto-reply`

Introduces `CLAUDE_IDENTITY_PREFIX` constant that prepends a Clawd identity string to Claude CLI invocations. When running `claude` commands, warelay automatically injects identity and brevity constraints to improve response quality and consistency in the WhatsApp context.

---

## 00136 — web: announce available presence when relay starts
**SHA:** dc31efb7aa · **Time:** 06:42
**Files changed:** src/provider-web.ts
**Tags:** `provider`

Updates the Web provider to broadcast "available" presence when the relay listener starts. Signals to other WhatsApp clients that this warelay session is ready to send/receive messages, improving presence awareness.

---

## 00137 — claude: tell Clawd to use ~/clawd markdown scratchpad
**SHA:** 8161b7a877 · **Time:** 06:49
**Files changed:** src/auto-reply/claude.ts
**Tags:** `auto-reply`

Extends the Clawd identity prompt to instruct Claude to use a markdown scratchpad file at `~/clawd` for working through problems. Leverages the Claude CLI's scratchpad feature to improve reasoning and multi-step problem solving.

---

## 00138 — claude: expand Clawd prompt, remind 1500 char limit
**SHA:** 7e24f3ab95 · **Time:** 06:50
**Files changed:** src/auto-reply/claude.ts
**Tags:** `auto-reply`

Expands the Clawd identity prompt to include explicit reminders about the 1500-character limit for WhatsApp messages. Helps Claude stay within bounds when responding to inbound messages, reducing the need for multi-part replies.

---

## 00139 — claude: allow scratchpad markdown or images, remind length
**SHA:** da6727ffae · **Time:** 06:50
**Files changed:** src/auto-reply/claude.ts
**Tags:** `auto-reply`

Further refines the Clawd prompt to allow markdown formatting or image output in the scratchpad, while reiterating the 1500-character message length constraint. Gives Claude more flexibility in working through complex prompts.

---

## 00140 — ci: force latest Node 22 and echo versions before install
**SHA:** 39aa9d5808 · **Time:** 11:57
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Updates CI to use the latest Node 22 patch (via `check-latest: true`) and adds diagnostic output steps that echo the paths to `which node`, `node -v`, and `pnpm -v` before running install. Improves CI transparency and debugging.

---

## 00141 — Add release checklist and adjust README tagline
**SHA:** bcd22cbb2c · **Time:** 11:59
**Files changed:** (release documentation files)
**Tags:** `documentation`

Adds a release checklist to guide the release process and adjusts the README tagline to better reflect the project's positioning. Prepares release infrastructure and messaging for the upcoming 0.1.0 release.

---

## 00142 — ci: use corepack pnpm with setup-node 22
**SHA:** ab60ae4c6b · **Time:** 11:59
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Configures the CI to use corepack-managed pnpm with setup-node for Node.js 22. Leverages Node's built-in corepack feature to manage pnpm version automatically, eliminating separate pnpm setup steps.

---

## 00143 — Prepare 0.1.0 changelog and npm-focused quickstart
**SHA:** 2efbcae449 · **Time:** 12:00
**Files changed:** CHANGELOG.md, README.md
**Tags:** `documentation`

Creates a comprehensive CHANGELOG.md documenting all 0.1.0 features across CLI, webhook/funnel, auto-reply engine, media pipeline, relay, and developer ergonomics. Updates the README to focus on npm-based global installation and links to the Claude setup guide.

---

## 00144 — Tidy docs: drop '(new)' from images section
**SHA:** 6fc8803e39 · **Time:** 12:01
**Files changed:** README.md
**Tags:** `documentation`

Removes the "(new)" marker from the images/media section in the README, as the feature is no longer new. Keeps the documentation accurate and less cluttered.

---

## 00145 — ci: force PATH to setup-node bin during install
**SHA:** adad036acf · **Time:** 12:01
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Modifies the CI install step to explicitly prepend the setup-node bin directory to PATH before running pnpm install. Ensures the setup-node-installed Node binary is prioritized over any runner default.

---

## 00146 — ci: relax engine check and drop frozen lockfile
**SHA:** cee9c28dfa · **Time:** 12:02
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`

Relaxes the Node.js engine requirement check and removes the `--frozen-lockfile` flag from the pnpm install command. Allows pnpm to update the lockfile if needed, reducing CI brittleness around dependency versions.

---

## 00147 — ci: fix node path and lint warnings
**SHA:** 7e9e8fd9c9 · **Time:** 12:08
**Files changed:** .github/workflows/ci.yml
**Tags:** `dependency`, `linting`

Corrects Node.js PATH configuration in the CI workflow and addresses lint warnings. Fine-tunes the environment setup to ensure proper tool discovery and resolves any linting issues in the workflow file itself.

---

## 00148 — Docs: add Claude CLI config guide and link from README
**SHA:** 3a9fc06a23 · **Time:** 12:11
**Files changed:** README.md, docs/claude-config.md
**Tags:** `documentation`

Creates a detailed `docs/claude-config.md` guide explaining how to wire warelay with the Claude CLI for command-driven replies. Documents prerequisites, config file structure, JSON5 format, command construction, and provides example configurations. Links this guide from the main README features section.

---

## 00149 — Ignore .pnpm-store
**SHA:** ea745764d7 · **Time:** 12:11
**Files changed:** .gitignore
**Tags:** `dependency`

Adds `.pnpm-store` to the `.gitignore` file to prevent checking in pnpm's package store directory into version control, reducing unnecessary noise in git history.

---

## 00150 — chore: sync source updates
**SHA:** 800c7a1e1f · **Time:** 12:12
**Files changed:** (source files)
**Tags:** `refactor`

Performs a general sync of source code updates across the codebase. Likely includes minor fixes, dependency updates, or file reorganization to ensure consistency and alignment with the latest code standards.

---
