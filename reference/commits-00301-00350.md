# Commit Reference: 00301–00350

A plain factual summary of every commit in the OpenClaw repository, from commit 301 through commit 350.

## 00301 — chore(security): harden ipc socket
**SHA:** c9fbe2cb92 · **Time:** 16:09
**Files changed:** CHANGELOG.md, src/web/ipc.test.ts, src/web/ipc.ts
**Tags:** `process-lifecycle`, `testing`

Hardened the relay IPC socket with security improvements: relocated to `~/.warelay/ipc`, enforces 0700 directory and 0600 socket permissions, rejects symlinks and foreign-owned paths, and includes comprehensive unit tests to lock in the behavior. The IPC server now provides safer inter-process communication for relay operations.

## 00302 — chore(security): purge session store on logout
**SHA:** 88446748250 · **Time:** 16:33
**Files changed:** CHANGELOG.md, src/web/logout.test.ts, src/web/session.ts
**Tags:** `process-lifecycle`, `testing`

The `warelay logout` command now purges the shared session store (`~/.warelay/sessions.json`) alongside WhatsApp Web credentials, reducing leftover state after unlinking. This enhances security by ensuring all session data is cleaned up during logout.

## 00303 — chore(logs): rotate daily and prune after 24h
**SHA:** 26921cbe68 · **Time:** 17:11
**Files changed:** CHANGELOG.md, src/web/logger.ts, src/web/logger.test.ts
**Tags:** `verbosity`, `process-lifecycle`

Implements daily log rotation with automatic pruning after 24 hours, preventing indefinite log accumulation on the file system. This maintains logging capabilities while limiting disk usage over time.

## 00304 — Fix path traversal vulnerability in media server
**SHA:** b94b220156 · **Time:** 10:52
**Files changed:** src/web/server.ts
**Tags:** `bugfix`

Fixed a critical path traversal vulnerability in the `/media/:id` endpoint exposed via Tailscale Funnel. Attackers could previously request paths like `/media/%2e%2e%2fwarelay.json` to access sensitive files in `~/.warelay/` or escape further to the home directory. The fix validates that resolved paths stay within the media directory.

## 00305 — fix(media): block symlink traversal
**SHA:** 2cf134668c · **Time:** 18:37
**Files changed:** src/web/server.ts
**Tags:** `bugfix`

Strengthens the media server security by explicitly blocking symbolic link traversal attacks. This prevents symlinks from being used to escape the designated media directory, adding an additional layer of protection to the fix from commit 00304.

## 00306 — chore: credit media fix contributor
**SHA:** a34271adf9 · **Time:** 18:38
**Files changed:** CHANGELOG.md
**Tags:** `documentation`

Credits contributor Joao Lisboa for the media server path traversal vulnerability fix (commit 00304), acknowledging the security improvements to the codebase.

## 00307 — perf(pi): reuse tau rpc for command auto-replies
**SHA:** b172b538fc · **Time:** 20:09
**Files changed:** src/agent/pi-reply.ts, src/agent/tau-rpc.ts
**Tags:** `auto-reply`, `process-lifecycle`

Optimizes Pi agent replies by reusing the tau RPC connection for command auto-replies instead of creating new connections. This reduces overhead and improves performance for multi-turn Pi agent interactions.

## 00308 — docs: update agent guidance and changelog
**SHA:** 202eff984d · **Time:** 20:10
**Files changed:** CLAUDE.md, CHANGELOG.md
**Tags:** `documentation`

Updates CLAUDE.md agent guidance documentation and the changelog with recent improvements and clarifications about agent-specific behavior and usage patterns.

## 00309 — fix: use export type for type-only re-exports
**SHA:** 2ec919201 · **Time:** 13:20
**Files changed:** src/agent/codex-reply.ts, src/agent/opencode-reply.ts
**Tags:** `type-safety`

Fixes a build error with `isolatedModules` by using `export type` for type-only re-exports. This ensures proper module isolation and prevents compilation issues in stricter TypeScript configurations.

## 00310 — fix: media serving and id consistency
**SHA:** 2fae0a9f47 · **Time:** 13:21
**Files changed:** src/web/server.ts, src/web/store.ts
**Tags:** `bugfix`, `core-feature`

Addresses two media-related issues: replaces `sendFile` with manual `readFile+send` to fix `NotFoundError` when serving media, and updates the store to return file IDs with extensions so they match actual filenames for proper identification.

## 00311 — chore: user-agnostic Claude identity and tests
**SHA:** a86cb932cf · **Time:** 13:21
**Files changed:** src/agent/claude-reply.ts, src/agent/claude-reply.test.ts
**Tags:** `auto-reply`, `testing`

Replaces hardcoded user paths with dynamic `~/Clawd` references, adds MEDIA syntax instructions to the Claude identity prefix, and updates tests to check for 'scratchpad' instead of specific paths for better portability.

## 00312 — fix: follow redirects when downloading Twilio media
**SHA:** 06dd9b8ed8 · **Time:** 14:28
**Files changed:** src/twilio/media.ts
**Tags:** `bugfix`, `twilio-api`

Fixes media download handling: Node.js `https.request()` doesn't follow redirects by default, causing Twilio media URLs (which 302 to CDN) to save placeholder/metadata instead of actual images. The fix enables automatic redirect following.

## 00313 — fix: send Claude identity prefix on first session message
**SHA:** 73a9fdca2a · **Time:** 14:35
**Files changed:** src/agent/command-reply.ts
**Tags:** `bugfix`, `auto-reply`

Fixes a timing bug where the `systemSent` variable was set to true before being passed to `runCommandReply`, preventing the Claude identity prefix from being injected on the first message of a session.

## 00314 — style: fix biome formatting
**SHA:** 499a3e3227 · **Time:** 17:06
**Files changed:** src/web/ipc.ts, src/web/logger.ts, src/web/server.ts
**Tags:** `linting`

Applies Biome code formatter fixes to correct formatting issues across multiple web module files, ensuring consistent code style throughout the codebase.

## 00315 — style: fix biome lint errors
**SHA:** d8b1a38350 · **Time:** 17:11
**Files changed:** src/web/logger.ts, src/web/media.ts, src/web/server.ts
**Tags:** `linting`

Resolves Biome linting errors in web module files, improving code quality and adhering to the project's linting standards.

## 00316 — style: fix biome formatting
**SHA:** 793360c5bb · **Time:** 17:20
**Files changed:** src/web/session.ts, src/web/logout.ts
**Tags:** `linting`

Applies additional Biome formatting corrections to session and logout modules, maintaining consistent code formatting across the web components.

## 00317 — chore: tidy claude prompt and drop npm lock
**SHA:** 2018c90ae2 · **Time:** 21:07
**Files changed:** CLAUDE.md, package-lock.json
**Tags:** `documentation`, `refactor`

Cleans up the CLAUDE.md prompt documentation and removes the npm lock file from version control, reducing repository clutter.

## 00318 — Merge branch 'fix/media-replies'
**SHA:** ccab950d16 · **Time:** 21:07
**Files changed:** (merge commit)
**Tags:** `refactor`

Merges the `fix/media-replies` branch into main, consolidating all media handling and reply fixes into the main branch.

## 00319 — test(media): add redirect coverage and update changelog
**SHA:** a0d100490 · **Time:** 21:09
**Files changed:** src/twilio/media.test.ts, CHANGELOG.md
**Tags:** `testing`, `twilio-api`

Adds comprehensive test coverage for Twilio media redirect handling and updates the changelog to document the redirect fix improvements.

## 00320 — fix(media): clean up files after response finishes
**SHA:** 4e20a20927 · **Time:** 21:10
**Files changed:** src/web/server.ts, src/twilio/media.ts
**Tags:** `bugfix`, `process-lifecycle`

Implements cleanup logic to remove temporary media files after the response is sent, preventing disk space exhaustion from accumulated cached media files.

## 00321 — ci: fix lint and tau rpc typing
**SHA:** 96722bba08 · **Time:** 21:12
**Files changed:** src/agent/tau-rpc.ts, tsconfig.json
**Tags:** `linting`, `type-safety`

Fixes linting issues in CI and corrects tau RPC type definitions to ensure proper TypeScript compilation and code quality checks pass.

## 00322 — docs: note media cleanup and tau rpc typing
**SHA:** 716524c151 · **Time:** 21:13
**Files changed:** CHANGELOG.md, README.md
**Tags:** `documentation`

Documents the media cleanup improvements and tau RPC typing fixes in the changelog and README, helping users understand recent changes.

## 00323 — chore: cut 1.3.1 in changelog
**SHA:** 1df6373cb1 · **Time:** 21:13
**Files changed:** CHANGELOG.md, package.json
**Tags:** `dependency`

Marks version 1.3.1 release in the changelog and updates package.json to reflect the new version number.

## 00324 — revert: mark system prompt sent on first turn
**SHA:** 1df6373cb1 · **Time:** 21:23
**Files changed:** src/agent/command-reply.ts
**Tags:** `bugfix`, `auto-reply`

Reverts a previous change that marked the system prompt as sent on the first turn, rolling back a modification that had unintended side effects.

## 00325 — logging: emit agent/session meta at command start
**SHA:** 0f6157a49d · **Time:** 21:30
**Files changed:** src/relay/command-handler.ts, src/agent/command-reply.ts
**Tags:** `verbosity`, `auto-reply`

Improves logging by emitting agent and session metadata at the start of command execution, providing better observability into command processing flow.

## 00326 — auto-reply: support multi-text RPC outputs
**SHA:** cfaec9d608 · **Time:** 23:03
**Files changed:** src/agent/command-reply.ts, src/agent/tau-rpc.ts
**Tags:** `auto-reply`, `core-feature`

Extends auto-reply functionality to handle multiple text outputs from RPC responses, allowing richer reply patterns from agent execution.

## 00327 — limits: chunk replies for twilio/web
**SHA:** 10182f1182 · **Time:** 23:10
**Files changed:** src/agent/auto-reply.ts, src/twilio/reply.ts
**Tags:** `auto-reply`, `twilio-api`, `provider`

Implements reply chunking for Twilio and web providers to respect message length limits, breaking long replies into multiple messages when necessary.

## 00328 — web: handle multi-payload replies
**SHA:** ec46932259 · **Time:** 23:46
**Files changed:** src/web/relay.ts, src/agent/auto-reply.ts
**Tags:** `provider`, `auto-reply`

Updates the web relay to handle multi-payload replies, allowing multiple messages to be sent in sequence as part of a single reply operation.

## 00329 — Auto-reply: smarter chunking breaks
**SHA:** b6c45485bc · **Time:** 00:25
**Files changed:** src/agent/auto-reply.ts
**Tags:** `auto-reply`

Improves chunking logic to use smarter break points when splitting long replies, taking into account natural sentence and paragraph boundaries for better readability.

## 00330 — Auto-reply: format and lint fixes
**SHA:** ecac4dd72a · **Time:** 00:30
**Files changed:** src/agent/auto-reply.ts
**Tags:** `linting`, `auto-reply`

Applies formatting and linting fixes to the auto-reply module to maintain code style consistency and pass linting checks.

## 00331 — CI: fix command-reply payload typing
**SHA:** f519e22e6d · **Time:** 00:33
**Files changed:** src/agent/command-reply.ts, src/agent/auto-reply.ts
**Tags:** `type-safety`, `auto-reply`

Corrects type definitions for command-reply payloads in the CI environment, ensuring type safety and preventing TypeScript errors in the build pipeline.

## 00332 — Auto-reply: allow array payloads in signature
**SHA:** a7fdc7b992 · **Time:** 00:35
**Files changed:** src/agent/auto-reply.ts, src/agent/command-reply.ts
**Tags:** `auto-reply`

Updates the auto-reply handler to accept array payloads in method signatures, enabling support for batch processing of multiple reply payloads.

## 00333 — Heartbeat: normalize array replies
**SHA:** 9da5b9f4bb · **Time:** 00:40
**Files changed:** src/relay/heartbeat.ts, src/agent/auto-reply.ts
**Tags:** `auto-reply`, `process-lifecycle`

Normalizes array-based replies in the heartbeat mechanism, ensuring consistent handling of multi-message responses across the heartbeat communication protocol.

## 00334 — Heartbeat: normalize reply arrays for twilio/web
**SHA:** 0f17a7d828 · **Time:** 00:43
**Files changed:** src/relay/heartbeat.ts, src/twilio/reply.ts, src/web/relay.ts
**Tags:** `auto-reply`, `provider`

Extends heartbeat reply normalization to properly handle Twilio and web provider array replies, ensuring multi-message responses work correctly across all channels.

## 00335 — Heartbeat: guard optional heartbeatCommand
**SHA:** 38b18202fc · **Time:** 00:45
**Files changed:** src/relay/heartbeat.ts
**Tags:** `process-lifecycle`

Adds defensive checks to guard against missing or undefined `heartbeatCommand` in the heartbeat mechanism, preventing runtime errors when the command is not provided.

## 00336 — Format: align thinking helpers
**SHA:** c4b0155cc2 · **Time:** 01:02
**Files changed:** src/agent/thinking.ts, src/agent/command-reply.ts
**Tags:** `refactor`

Aligns formatting in thinking helper functions to improve code consistency and readability in the agent thinking module.

## 00337 — Changelog: heartbeat array handling
**SHA:** 4faba0fe8b · **Time:** 01:03
**Files changed:** CHANGELOG.md
**Tags:** `documentation`

Documents the improvements to heartbeat array handling and reply normalization in the changelog for release notes.

## 00338 — Auto-reply: add thinking directives
**SHA:** 58520859e5 · **Time:** 08:45
**Files changed:** src/agent/auto-reply.ts, src/agent/thinking.ts
**Tags:** `auto-reply`, `core-feature`

Introduces thinking directives to the auto-reply system, allowing agents to include internal reasoning annotations that don't appear in the final reply.

## 00339 — Docs: document thinking levels
**SHA:** 5a83a44112 · **Time:** 08:45
**Files changed:** CLAUDE.md, CHANGELOG.md
**Tags:** `documentation`

Documents the different levels of thinking directives available to agents, explaining how to use thinking annotations effectively in prompts.

## 00340 — Auto-reply: ack think directives
**SHA:** 48dfb1c8ca · **Time:** 08:54
**Files changed:** src/agent/auto-reply.ts
**Tags:** `auto-reply`

Implements acknowledgment of thinking directives in the auto-reply handler, ensuring the system correctly processes and strips thinking sections before sending replies.

## 00341 — Auto-reply: treat prefixed think directives as directive-only
**SHA:** 8ba35a2dc3 · **Time:** 08:57
**Files changed:** src/agent/auto-reply.ts
**Tags:** `auto-reply`

Refines thinking directive handling so prefixed think directives (e.g., `/think`) are treated as purely directive, with no text contribution to the final message content.

## 00342 — Auto-reply: add /verbose directives and tool result replies
**SHA:** 086dd284d6 · **Time:** 09:04
**Files changed:** src/agent/auto-reply.ts, src/agent/tool-results.ts
**Tags:** `auto-reply`, `verbosity`

Adds support for `/verbose` directives in auto-reply and implements tool result reply handling, allowing agents to request verbose output mode and send structured tool results.

## 00343 — Auto-reply: add verbose session hint
**SHA:** ae0d35c727 · **Time:** 09:07
**Files changed:** src/agent/auto-reply.ts, src/relay/command-handler.ts
**Tags:** `auto-reply`, `verbosity`

Implements verbose session hints in auto-reply to notify users when verbose mode is enabled, providing transparency about the current execution mode.

## 00344 — Docs: mention verbose hints
**SHA:** 85917d4769 · **Time:** 09:08
**Files changed:** CLAUDE.md, README.md
**Tags:** `documentation`

Updates documentation to mention verbose hints and how they inform users about verbose mode enablement.

## 00345 — Chore: format + lint fixes
**SHA:** 53c1674382 · **Time:** 09:09
**Files changed:** src/agent/auto-reply.ts, src/relay/command-handler.ts, src/agent/tool-results.ts
**Tags:** `linting`

Applies formatting and linting fixes across agent and relay modules to maintain code quality standards.

## 00346 — Auto-reply: show tool results before main reply in verbose mode
**SHA:** 16e42e6d6d · **Time:** 09:14
**Files changed:** src/agent/auto-reply.ts, src/relay/heartbeat.ts
**Tags:** `auto-reply`, `verbosity`

Reorders reply output in verbose mode to display tool results before the main reply text, helping users understand the execution context.

## 00347 — Auto-reply: stream verbose tool results via tau rpc
**SHA:** c3792db0e5 · **Time:** 09:21
**Files changed:** src/agent/auto-reply.ts, src/agent/tau-rpc.ts, src/relay/heartbeat.ts
**Tags:** `auto-reply`, `verbosity`, `process-lifecycle`

Implements streaming of verbose tool results through the tau RPC mechanism, allowing real-time display of tool execution details as they occur.

## 00348 — Docs: note streaming verbose tool results
**SHA:** 86d707ad51 · **Time:** 09:22
**Files changed:** CHANGELOG.md, README.md
**Tags:** `documentation`

Documents the new streaming verbose tool results feature in changelog and README, explaining the improved observability for tool execution.

## 00349 — Tau RPC: resolve on agent_end
**SHA:** 394c751d7d · **Time:** 09:39
**Files changed:** src/agent/tau-rpc.ts
**Tags:** `process-lifecycle`

Fixes tau RPC resolution to occur at agent completion (`agent_end`) rather than earlier, ensuring proper lifecycle management of RPC operations.

## 00350 — Verbose: send tool result metadata only
**SHA:** 318166f8b0 · **Time:** 09:40
**Files changed:** src/agent/tool-results.ts, src/relay/heartbeat.ts
**Tags:** `verbosity`

Optimizes verbose mode by sending only tool result metadata in certain contexts, reducing verbosity while maintaining observability into tool execution.
